/*
 * 
 *                  xxxxxxx      xxxxxxx
 *                   x:::::x    x:::::x 
 *                    x:::::x  x:::::x  
 *                     x:::::xx:::::x   
 *                      x::::::::::x    
 *                       x::::::::x     
 *                       x::::::::x     
 *                      x::::::::::x    
 *                     x:::::xx:::::x   
 *                    x:::::x  x:::::x  
 *                   x:::::x    x:::::x 
 *              THE xxxxxxx      xxxxxxx TOOLKIT
 *                    
 *                  http://www.goXTK.com
 *                   
 * Copyright (c) 2012 The X Toolkit Developers <dev@goXTK.com>
 *                   
 *    The X Toolkit (XTK) is licensed under the MIT License:
 *      http://www.opensource.org/licenses/mit-license.php
 * 
 *      "Free software" is a matter of liberty, not price.
 *      "Free" as in "free speech", not as in "free beer".
 *                                         - Richard M. Stallman
 * 
 * FUELED BY:
 *  - the wonderful Constructive Solid Geometry library by Evan Wallace (http://madebyevan.com)
 *    LICENSE: https://raw.github.com/xtk/X/master/lib/csg/LICENSE
 *
 *  - parts of the Google Closure Library (http://code.google.com/closure/library)
 *    LICENSE: https://raw.github.com/xtk/google-closure-library/master/LICENSE
 *
 *  - zlib.js, the ultimate gzip/zlib javascript implementation (https://github.com/imaya/zlib.js)
 *    LICENSE: https://raw.github.com/imaya/zlib.js/master/LICENSE
 *
 * MORE CREDITS: https://raw.github.com/xtk/X/master/LICENSE
 *
 */
function n(a){throw a;}var p=void 0,q=!0,t=null,u=!1;function aa(){return function(){}}function ba(a){return function(b){this[a]=b}}function v(a){return function(){return this[a]}}var w,fa=this;function ga(){}
function ha(a){var b=typeof a;if("object"==b)if(a){if(a instanceof Array)return"array";if(a instanceof Object)return b;var c=Object.prototype.toString.call(a);if("[object Window]"==c)return"object";if("[object Array]"==c||"number"==typeof a.length&&"undefined"!=typeof a.splice&&"undefined"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("splice"))return"array";if("[object Function]"==c||"undefined"!=typeof a.call&&"undefined"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("call"))return"function"}else return"null";
else if("function"==b&&"undefined"==typeof a.call)return"object";return b}function ia(a){return a!==p}function ka(a){return"array"==ha(a)}function la(a){var b=ha(a);return"array"==b||"object"==b&&"number"==typeof a.length}function ma(a){return"string"==typeof a}function x(a){return"number"==typeof a}function na(a){return"function"==ha(a)}function pa(a){var b=typeof a;return"object"==b&&a!=t||"function"==b}function qa(a){return a[ra]||(a[ra]=++sa)}var ra="closure_uid_"+(1E9*Math.random()>>>0),sa=0;
function ta(a,b,c){return a.call.apply(a.bind,arguments)}function ua(a,b,c){a||n(Error());if(2<arguments.length){var e=Array.prototype.slice.call(arguments,2);return function(){var c=Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(c,e);return a.apply(b,c)}}return function(){return a.apply(b,arguments)}}function va(a,b,c){va=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?ta:ua;return va.apply(t,arguments)}
function wa(a,b){var c=Array.prototype.slice.call(arguments,1);return function(){var b=Array.prototype.slice.call(arguments);b.unshift.apply(b,c);return a.apply(this,b)}}var xa=Date.now||function(){return+new Date};function B(a,b){var c=a.split("."),e=fa;!(c[0]in e)&&e.execScript&&e.execScript("var "+c[0]);for(var d;c.length&&(d=c.shift());)!c.length&&ia(b)?e[d]=b:e=e[d]?e[d]:e[d]={}}
function C(a,b){function c(){}c.prototype=b.prototype;a.B=b.prototype;a.prototype=new c;a.prototype.constructor=a};function ya(a,b,c){this.Xa=this.Wa=this.Va=0;3==arguments.length?(this.Va=Number(a),this.Wa=Number(b),this.Xa=Number(c)):a instanceof ya?(this.Va=Number(a.x()),this.Wa=Number(a.y()),this.Xa=Number(a.d())):(this.Va=Number(a[0]),this.Wa=Number(a[1]),this.Xa=Number(a[2]))}
ya.prototype={l:function(){return new ya(this.Va,this.Wa,this.Xa)},ac:function(a){return this.Va*a.x()+this.Wa*a.y()+this.Xa*a.d()},se:function(a,b){return za(this,Ba(Ca(a,this),b))},length:function(){return Math.sqrt(this.ac(this))},mc:function(a){return new ya(this.Wa*a.d()-this.Xa*a.y(),this.Xa*a.x()-this.Va*a.d(),this.Va*a.y()-this.Wa*a.x())},x:v("Va"),y:v("Wa"),d:v("Xa")};function Da(a){var b=a.length();return new ya(a.Va/b,a.Wa/b,a.Xa/b)}
function Ba(a,b){return new ya(a.Va*b,a.Wa*b,a.Xa*b)}function Ca(a,b){return new ya(a.Va-b.x(),a.Wa-b.y(),a.Xa-b.d())}function za(a,b){return new ya(a.Va+b.x(),a.Wa+b.y(),a.Xa+b.d())}function Ea(a){return new ya(-a.Va,-a.Wa,-a.Xa)};var D=D||{};D.xk=q;D.Ha=function(a){eval("X.DEV === undefined")||window.console.time(a)};D.Ba=function(a){eval("X.DEV === undefined")||window.console.timeEnd(a)};window["X.counter"]=new function(){this.vi=0;this.pk=function(){return this.vi++}};function Ga(a,b){for(var c in b){var e=b.__lookupGetter__(c),d=b.__lookupSetter__(c);c in a||(e||d?(e&&a.__defineGetter__(c,e),d&&a.__defineSetter__(c,d)):a[c]=b[c])}}var Ha=window.ki;
Function.prototype.bind||(Function.prototype.bind=function(a){function b(){return f.apply(this instanceof c?this:a||window,d.concat(e.call(arguments)))}function c(){}"function"!==typeof this&&n(new TypeError("Function.prototype.bind - what is trying to be bound is not callable"));var e=Array.prototype.slice,d=e.call(arguments,1),f=this;c.prototype=this.prototype;b.prototype=new c;return b});
for(var Ia=0,Ja=["ms","moz","webkit","o"],Ka=0;Ka<Ja.length&&!window.requestAnimationFrame;++Ka)window.requestAnimationFrame=window[Ja[Ka]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[Ja[Ka]+"CancelAnimationFrame"]||window[Ja[Ka]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(a){var b=Date.now(),c=Math.max(0,16-(b-Ia)),e=window.setTimeout(function(){a(b+c)},c);Ia=b+c;return e});
window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){clearTimeout(a)});
"slice"in ArrayBuffer.prototype||(ArrayBuffer.prototype.slice=function(a,b){a===p&&n(Error("Not enough arguments."));var c=b||this.byteLength;0>a&&(a=this.byteLength+a);0>c&&(c=this.byteLength+c);c<a&&(c=a=0);0>a&&(a=0);0>c&&(c=0);a>this.byteLength&&(a=this.byteLength);c>this.byteLength&&(c=this.byteLength);for(var e=new ArrayBuffer(c-a),d=new Uint8Array(this),f=new Uint8Array(e),g=a,h=0;g<c;++g,++h)f[h]=d[g];return e});B("$",Ha);B("Function.prototype.bind",Function.prototype.bind);
B("window.requestAnimationFrame",window.requestAnimationFrame);B("window.cancelAnimationFrame",window.cancelAnimationFrame);var La=0;function Ma(){}w=Ma.prototype;w.key=0;w.rc=u;w.ge=u;w.Aa=function(a,b,c,e,d,f){na(a)?this.th=q:a&&a.handleEvent&&na(a.handleEvent)?this.th=u:n(Error("Invalid listener argument"));this.bc=a;this.Oh=b;this.src=c;this.type=e;this.capture=!!d;this.tf=f;this.ge=u;this.key=++La;this.rc=u};w.handleEvent=function(a){return this.th?this.bc.call(this.tf||this.src,a):this.bc.handleEvent.call(this.bc,a)};function Na(a,b){for(var c in a)b.call(p,a[c],c,a)}function Pa(a){var b=[],c=0,e;for(e in a)b[c++]=a[e];return b}var Qa="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Sa(a,b){for(var c,e,d=1;d<arguments.length;d++){e=arguments[d];for(c in e)a[c]=e[c];for(var f=0;f<Qa.length;f++)c=Qa[f],Object.prototype.hasOwnProperty.call(e,c)&&(a[c]=e[c])}};function Ta(a){if(!Ua.test(a))return a;-1!=a.indexOf("&")&&(a=a.replace(Va,"&amp;"));-1!=a.indexOf("<")&&(a=a.replace(Wa,"&lt;"));-1!=a.indexOf(">")&&(a=a.replace(Xa,"&gt;"));-1!=a.indexOf('"')&&(a=a.replace(Ya,"&quot;"));return a}var Va=/&/g,Wa=/</g,Xa=/>/g,Ya=/\"/g,Ua=/[&<>\"]/;var Za,$a,ab,bb,cb,db,eb;function gb(){return fa.navigator?fa.navigator.userAgent:t}function hb(){return fa.navigator}bb=ab=$a=Za=u;var ib;if(ib=gb()){var jb=hb();Za=0==ib.indexOf("Opera");$a=!Za&&-1!=ib.indexOf("MSIE");ab=!Za&&-1!=ib.indexOf("WebKit");bb=!Za&&!ab&&"Gecko"==jb.product}var kb=Za,lb=$a,mb=bb,ob=ab,pb,rb=hb();pb=rb&&rb.platform||"";cb=-1!=pb.indexOf("Mac");db=-1!=pb.indexOf("Win");eb=-1!=pb.indexOf("Linux");var sb=!!hb()&&-1!=(hb().appVersion||"").indexOf("X11");
function tb(){var a=fa.document;return a?a.documentMode:p}var ub;a:{var yb="",zb;if(kb&&fa.opera)var Ab=fa.opera.version,yb="function"==typeof Ab?Ab():Ab;else if(mb?zb=/rv\:([^\);]+)(\)|;)/:lb?zb=/MSIE\s+([^\);]+)(\)|;)/:ob&&(zb=/WebKit\/(\S+)/),zb)var Bb=zb.exec(gb()),yb=Bb?Bb[1]:"";if(lb){var Cb=tb();if(Cb>parseFloat(yb)){ub=String(Cb);break a}}ub=yb}var Db={};
function Eb(a){var b;if(!(b=Db[a])){b=0;for(var c=String(ub).replace(/^[\s\xa0]+|[\s\xa0]+$/g,"").split("."),e=String(a).replace(/^[\s\xa0]+|[\s\xa0]+$/g,"").split("."),d=Math.max(c.length,e.length),f=0;0==b&&f<d;f++){var g=c[f]||"",h=e[f]||"",l=RegExp("(\\d*)(\\D*)","g"),j=RegExp("(\\d*)(\\D*)","g");do{var k=l.exec(g)||["","",""],m=j.exec(h)||["","",""];if(0==k[0].length&&0==m[0].length)break;b=((0==k[1].length?0:parseInt(k[1],10))<(0==m[1].length?0:parseInt(m[1],10))?-1:(0==k[1].length?0:parseInt(k[1],
10))>(0==m[1].length?0:parseInt(m[1],10))?1:0)||((0==k[2].length)<(0==m[2].length)?-1:(0==k[2].length)>(0==m[2].length)?1:0)||(k[2]<m[2]?-1:k[2]>m[2]?1:0)}while(0==b)}b=Db[a]=0<=b}return b}var Fb=fa.document,Gb=!Fb||!lb?p:tb()||("CSS1Compat"==Fb.compatMode?parseInt(ub,10):5);var Hb=!lb||lb&&9<=Gb,Ib=lb&&!Eb("9");!ob||Eb("528");mb&&Eb("1.9b")||lb&&Eb("8")||kb&&Eb("9.5")||ob&&Eb("528");mb&&!Eb("8")||lb&&Eb("9");var Jb=Array.prototype,Kb=Jb.indexOf?function(a,b,c){return Jb.indexOf.call(a,b,c)}:function(a,b,c){c=c==t?0:0>c?Math.max(0,a.length+c):c;if(ma(a))return!ma(b)||1!=b.length?-1:a.indexOf(b,c);for(;c<a.length;c++)if(c in a&&a[c]===b)return c;return-1},Lb=Jb.forEach?function(a,b,c){Jb.forEach.call(a,b,c)}:function(a,b,c){for(var e=a.length,d=ma(a)?a.split(""):a,f=0;f<e;f++)f in d&&b.call(c,d[f],f,a)},Nb=Jb.map?function(a,b,c){return Jb.map.call(a,b,c)}:function(a,b,c){for(var e=a.length,d=Array(e),f=
ma(a)?a.split(""):a,g=0;g<e;g++)g in f&&(d[g]=b.call(c,f[g],g,a));return d},Ob=Jb.some?function(a,b,c){return Jb.some.call(a,b,c)}:function(a,b,c){for(var e=a.length,d=ma(a)?a.split(""):a,f=0;f<e;f++)if(f in d&&b.call(c,d[f],f,a))return q;return u};function Pb(a,b){var c=Kb(a,b);0<=c&&Jb.splice.call(a,c,1)}function Qb(a,b,c){return 2>=arguments.length?Jb.slice.call(a,b):Jb.slice.call(a,b,c)};function Rb(){0!=Sb&&(this.wl=Error().stack,qa(this))}var Sb=0;function Tb(a,b){this.type=a;this.currentTarget=this.target=b}w=Tb.prototype;w.qc=u;w.defaultPrevented=u;w.xe=q;w.stopPropagation=function(){this.qc=q};w.preventDefault=function(){this.defaultPrevented=q;this.xe=u};function Ub(a){Ub[" "](a);return a}Ub[" "]=ga;function Vb(a,b){a&&this.Aa(a,b)}C(Vb,Tb);w=Vb.prototype;w.target=t;w.relatedTarget=t;w.offsetX=0;w.offsetY=0;w.clientX=0;w.clientY=0;w.screenX=0;w.screenY=0;w.button=0;w.keyCode=0;w.charCode=0;w.ctrlKey=u;w.altKey=u;w.shiftKey=u;w.metaKey=u;w.ek=u;w.ob=t;
w.Aa=function(a,b){var c=this.type=a.type;Tb.call(this,c);this.target=a.target||a.srcElement;this.currentTarget=b;var e=a.relatedTarget;if(e){if(mb){var d;a:{try{Ub(e.nodeName);d=q;break a}catch(f){}d=u}d||(e=t)}}else"mouseover"==c?e=a.fromElement:"mouseout"==c&&(e=a.toElement);this.relatedTarget=e;this.offsetX=ob||a.offsetX!==p?a.offsetX:a.layerX;this.offsetY=ob||a.offsetY!==p?a.offsetY:a.layerY;this.clientX=a.clientX!==p?a.clientX:a.pageX;this.clientY=a.clientY!==p?a.clientY:a.pageY;this.screenX=
a.screenX||0;this.screenY=a.screenY||0;this.button=a.button;this.keyCode=a.keyCode||0;this.charCode=a.charCode||("keypress"==c?a.keyCode:0);this.ctrlKey=a.ctrlKey;this.altKey=a.altKey;this.shiftKey=a.shiftKey;this.metaKey=a.metaKey;this.ek=cb?a.metaKey:a.ctrlKey;this.state=a.state;this.ob=a;a.defaultPrevented&&this.preventDefault();delete this.qc};w.stopPropagation=function(){Vb.B.stopPropagation.call(this);this.ob.stopPropagation?this.ob.stopPropagation():this.ob.cancelBubble=q};
w.preventDefault=function(){Vb.B.preventDefault.call(this);var a=this.ob;if(a.preventDefault)a.preventDefault();else if(a.returnValue=u,Ib)try{if(a.ctrlKey||112<=a.keyCode&&123>=a.keyCode)a.keyCode=-1}catch(b){}};w.Xi=v("ob");var Wb={},Xb={},Yb={},Zb={};function I(a,b,c,e,d){if(ka(b)){for(var f=0;f<b.length;f++)I(a,b[f],c,e,d);return t}a=$b(a,b,c,u,e,d);b=a.key;Wb[b]=a;return b}
function $b(a,b,c,e,d,f){b||n(Error("Invalid event type"));d=!!d;var g=Xb;b in g||(g[b]={na:0,Ma:0});g=g[b];d in g||(g[d]={na:0,Ma:0},g.na++);var g=g[d],h=qa(a),l;g.Ma++;if(g[h]){l=g[h];for(var j=0;j<l.length;j++)if(g=l[j],g.bc==c&&g.tf==f){if(g.rc)break;e||(l[j].ge=u);return l[j]}}else l=g[h]=[],g.na++;var k=ac,m=Hb?function(a){return k.call(m.src,m.bc,a)}:function(a){a=k.call(m.src,m.bc,a);if(!a)return a},j=m,g=new Ma;g.Aa(c,j,a,b,d,f);g.ge=e;j.src=a;j.bc=g;l.push(g);Yb[h]||(Yb[h]=[]);Yb[h].push(g);
a.addEventListener?(a==fa||!a.customEvent_)&&a.addEventListener(b,j,d):a.attachEvent(b in Zb?Zb[b]:Zb[b]="on"+b,j);return g}function bc(a,b,c,e,d){if(ka(b))for(var f=0;f<b.length;f++)bc(a,b[f],c,e,d);else a=$b(a,b,c,q,e,d),Wb[a.key]=a}function cc(a,b,c,e,d){if(ka(b))for(var f=0;f<b.length;f++)cc(a,b[f],c,e,d);else{e=!!e;a:{f=Xb;if(b in f&&(f=f[b],e in f&&(f=f[e],a=qa(a),f[a]))){a=f[a];break a}a=t}if(a)for(f=0;f<a.length;f++)if(a[f].bc==c&&a[f].capture==e&&a[f].tf==d){dc(a[f].key);break}}}
function dc(a){var b=Wb[a];if(!b||b.rc)return u;var c=b.src,e=b.type,d=b.Oh,f=b.capture;c.removeEventListener?(c==fa||!c.customEvent_)&&c.removeEventListener(e,d,f):c.detachEvent&&c.detachEvent(e in Zb?Zb[e]:Zb[e]="on"+e,d);c=qa(c);Yb[c]&&(d=Yb[c],Pb(d,b),0==d.length&&delete Yb[c]);b.rc=q;if(b=Xb[e][f][c])b.Fh=q,ec(e,f,c,b);delete Wb[a];return q}
function ec(a,b,c,e){if(!e.te&&e.Fh){for(var d=0,f=0;d<e.length;d++)e[d].rc?e[d].Oh.src=t:(d!=f&&(e[f]=e[d]),f++);e.length=f;e.Fh=u;0==f&&(delete Xb[a][b][c],Xb[a][b].na--,0==Xb[a][b].na&&(delete Xb[a][b],Xb[a].na--),0==Xb[a].na&&delete Xb[a])}}function fc(a,b){var c=qa(a),e=Yb[c];if(e){var d=ia(b),f=ia(p);return d&&f?(e=Xb[b],!!e&&!!e[p]&&c in e[p]):!d&&!f?q:Ob(e,function(a){return d&&a.type==b||f&&a.capture==p})}return u}
function gc(a,b,c,e,d){var f=1;b=qa(b);if(a[b]){var g=--a.Ma,h=a[b];h.te?h.te++:h.te=1;try{for(var l=h.length,j=0;j<l;j++){var k=h[j];k&&!k.rc&&(f&=hc(k,d)!==u)}}finally{a.Ma=Math.max(g,a.Ma),h.te--,ec(c,e,b,h)}}return Boolean(f)}function hc(a,b){a.ge&&dc(a.key);return a.handleEvent(b)}
function ac(a,b){if(a.rc)return q;var c=a.type,e=Xb;if(!(c in e))return q;var e=e[c],d,f;if(!Hb){var g;if(!(g=b))a:{g=["window","event"];for(var h=fa;d=g.shift();)if(h[d]!=t)h=h[d];else{g=t;break a}g=h}d=g;g=q in e;h=u in e;if(g){if(0>d.keyCode||d.returnValue!=p)return q;a:{var l=u;if(0==d.keyCode)try{d.keyCode=-1;break a}catch(j){l=q}if(l||d.returnValue==p)d.returnValue=q}}l=new Vb;l.Aa(d,this);d=q;try{if(g){for(var k=[],m=l.currentTarget;m;m=m.parentNode)k.push(m);f=e[q];f.Ma=f.na;for(var r=k.length-
1;!l.qc&&0<=r&&f.Ma;r--)l.currentTarget=k[r],d&=gc(f,k[r],c,q,l);if(h){f=e[u];f.Ma=f.na;for(r=0;!l.qc&&r<k.length&&f.Ma;r++)l.currentTarget=k[r],d&=gc(f,k[r],c,u,l)}}else d=hc(a,l)}finally{k&&(k.length=0)}return d}c=new Vb(b,this);return d=hc(a,c)}var ic=0;function jc(a){return a+"_"+ic++};function kc(){Rb.call(this);this.Al={};this.tl=this}C(kc,Rb);kc.prototype.customEvent_=q;w=kc.prototype;w.Mf=t;w.Wf=ba("Mf");w.addEventListener=function(a,b,c,e){I(this,a,b,c,e)};w.removeEventListener=function(a,b,c,e){cc(this,a,b,c,e)};
w.dispatchEvent=function(a){var b=a.type||a,c=Xb;if(b in c){if(ma(a))a=new Tb(a,this);else if(a instanceof Tb)a.target=a.target||this;else{var e=a;a=new Tb(b,this);Sa(a,e)}var e=1,d,c=c[b],b=q in c,f;if(b){d=[];for(f=this;f;f=f.Mf)d.push(f);f=c[q];f.Ma=f.na;for(var g=d.length-1;!a.qc&&0<=g&&f.Ma;g--)a.currentTarget=d[g],e&=gc(f,d[g],a.type,q,a)&&a.xe!=u}if(u in c)if(f=c[u],f.Ma=f.na,b)for(g=0;!a.qc&&g<d.length&&f.Ma;g++)a.currentTarget=d[g],e&=gc(f,d[g],a.type,u,a)&&a.xe!=u;else for(d=this;!a.qc&&
d&&f.Ma;d=d.Mf)a.currentTarget=d,e&=gc(f,d,a.type,u,a)&&a.xe!=u;a=Boolean(e)}else a=q;return a};function K(){kc.call(this);this.f="base";this.xa=window["X.counter"].pk();this.j=u}C(K,kc);K.prototype.__defineGetter__("classname",v("f"));K.prototype.__defineGetter__("id",v("xa"));B("X.base",K);function lc(a,b){this.Ua=new ya(a);this.ua=new ya(b)}lc.prototype={l:function(){return new lc(this.Ua.l(),this.ua.l())},oc:function(){this.ua=Ea(this.ua)}};function mc(a,b){this.ua=a;this.Md=b}mc.prototype={l:function(){return new mc(this.ua.l(),this.Md)},oc:function(){this.ua=Ea(this.ua);this.Md=-this.Md}};function nc(a,b){this.Kb=a;this.De=b;var c=a[0].Ua,e=a[2].Ua,e=Da(Ca(a[1].Ua,c).mc(Ca(e,c)));this.Ta=new mc(e,e.ac(c))}nc.prototype={l:function(){var a=this.Kb.map(function(a){return a.l()});return new nc(a,this.De)},oc:function(){this.Kb.reverse().map(function(a){a.oc()});this.Ta.oc()}};
function oc(a,b,c,e,d,f){for(var g=0,h=[],l=0;l<a.Kb.length;l++){var j=b.ua.ac(a.Kb[l].Ua)-b.Md,j=-1E-5>j?2:1E-5<j?1:0,g=g|j;h.push(j)}switch(g){case 0:(0<b.ua.ac(a.Ta.ua)?c:e).push(a);break;case 1:d.push(a);break;case 2:f.push(a);break;case 3:c=[];e=[];for(l=0;l<a.Kb.length;l++){var k=(l+1)%a.Kb.length,j=h[l],m=h[k],g=a.Kb[l],k=a.Kb[k];2!=j&&c.push(g);1!=j&&e.push(2!=j?g.l():g);3==(j|m)&&(j=(b.Md-b.ua.ac(g.Ua))/b.ua.ac(Ca(k.Ua,g.Ua)),j=new lc(g.Ua.se(k.Ua,j),g.ua.se(k.ua,j)),c.push(j),e.push(j.l()))}3<=
c.length&&d.push(new nc(c,a.De));3<=e.length&&f.push(new nc(e,a.De))}};function pc(a){this.ya=this.za=this.Ta=t;this.Z=[];a&&qc(this,a)}pc.prototype={l:function(){var a=new pc,b=this.Ta&&this.Ta.l();a.Ta=b;b=this.za&&this.za.l();a.za=b;b=this.ya&&this.ya.l();a.ya=b;a.Ce(this.Z.map(function(a){return a.l()}));return a},Y:function(){for(var a=0;a<this.Z.length;a++)this.Z[a].oc();this.Ta.oc();this.za&&this.za.Y();this.ya&&this.ya.Y();a=this.za;this.za=this.ya;this.ya=a},Ce:ba("Z")};
function qc(a,b){if(b.length){a.Ta||(a.Ta=b[0].Ta.l());for(var c=[],e=[],d=0;d<b.length;d++)oc(b[d],a.Ta,a.Z,a.Z,c,e);c.length&&(a.za||(a.za=new pc),qc(a.za,c));e.length&&(a.ya||(a.ya=new pc),qc(a.ya,e))}}function rc(a){var b=a.Z.slice();a.za&&(b=b.concat(rc(a.za)));a.ya&&(b=b.concat(rc(a.ya)));return b}function sc(a,b){a.Z=tc(b,a.Z);a.za&&sc(a.za,b);a.ya&&sc(a.ya,b)}
function tc(a,b){if(!a.Ta)return b.slice();for(var c=[],e=[],d=0;d<b.length;d++)oc(b[d],a.Ta,c,e,c,e);a.za&&(c=tc(a.za,c));e=a.ya?tc(a.ya,e):[];return c.concat(e)};function uc(){this.Z=[]}function vc(a){var b=new uc;b.Ce(a);return b}
uc.prototype={l:function(){var a=new uc;a.Ce(this.Z.map(function(a){return a.l()}));return a},gg:function(a){var b=new pc(this.l().Z);a=new pc(a.l().Z);sc(b,a);sc(a,b);a.Y();sc(a,b);a.Y();qc(b,rc(a));return vc(rc(b))},va:function(a){var b=new pc(this.l().Z);a=new pc(a.l().Z);b.Y();sc(b,a);sc(a,b);a.Y();sc(a,b);a.Y();qc(b,rc(a));b.Y();return vc(rc(b))},vf:function(a){var b=new pc(this.l().Z);a=new pc(a.l().Z);b.Y();sc(a,b);a.Y();sc(b,a);sc(a,b);qc(b,rc(a));b.Y();return vc(rc(b))},inverse:function(){var a=
this.l();a.Z.map(function(a){a.oc()});return a},Ce:ba("Z")};function wc(){K.call(this);this.f="indexer";this.bf=[];this.ol=[];this.Ia={}}C(wc,K);wc.prototype.add=function(a){a==t&&n(Error("Invalid object."));var b=window.JSON.stringify(a);b in this.Ia||(this.Ia[b]=this.bf.length,this.bf.push(a));return this.Ia[b]};wc.prototype.unique=v("bf");function xc(a){K.call(this);this.f="file";this.Yd=a;this.j=q}C(xc,K);function yc(){this.qb=this.r=t}yc.prototype.__defineSetter__("file",function(a){if(a==t||ka(a)&&0==a.length)this.r=t;else{if(ka(a)){if(1==a.length){this.r=new xc(a[0]);return}this.r=Nb(a,function(a){var c=new N;c.r=new xc(a);return c})}else this.r=new xc(a);this.qb=t}});yc.prototype.__defineGetter__("file",function(){return!this.r?"":ka(this.r)?this.r.map(function(a){return a.r.Yd}):this.r.Yd});
yc.prototype.__defineGetter__("filedata",function(){return ka(this.r)?this.r.map(function(a){return a.qb}):this.qb});yc.prototype.__defineSetter__("filedata",function(a){if(a==t||ka(a)&&0==a.length)this.qb=t;if(ka(a))if(1==a.length)this.qb=a[0];else{var b=this.r.length,c;for(c=0;c<b;c++)this.r[c].qb=a[c]}else this.qb=a});function zc(a){if("function"==typeof a.Ad)return a.Ad();if(ma(a))return a.split("");if(la(a)){for(var b=[],c=a.length,e=0;e<c;e++)b.push(a[e]);return b}return Pa(a)};function Ac(a,b){this.ga={};this.T=[];var c=arguments.length;if(1<c){c%2&&n(Error("Uneven number of arguments"));for(var e=0;e<c;e+=2)this.set(arguments[e],arguments[e+1])}else a&&this.df(a)}w=Ac.prototype;w.na=0;w.ig=0;w.me=v("na");w.Ad=function(){Bc(this);for(var a=[],b=0;b<this.T.length;b++)a.push(this.ga[this.T[b]]);return a};function Cc(a){for(var b=0;b<a.T.length;b++){var c=a.T[b];if(Dc(a.ga,c)&&a.ga[c]==u)return q}return u}w.clear=function(){this.ga={};this.ig=this.na=this.T.length=0};
w.remove=function(a){return Dc(this.ga,a)?(delete this.ga[a],this.na--,this.ig++,this.T.length>2*this.na&&Bc(this),q):u};function Bc(a){if(a.na!=a.T.length){for(var b=0,c=0;b<a.T.length;){var e=a.T[b];Dc(a.ga,e)&&(a.T[c++]=e);b++}a.T.length=c}if(a.na!=a.T.length){for(var d={},c=b=0;b<a.T.length;)e=a.T[b],Dc(d,e)||(a.T[c++]=e,d[e]=1),b++;a.T.length=c}}w.get=function(a,b){return Dc(this.ga,a)?this.ga[a]:b};w.set=function(a,b){Dc(this.ga,a)||(this.na++,this.T.push(a),this.ig++);this.ga[a]=b};
w.df=function(a){var b;if(a instanceof Ac)Bc(a),b=a.T.concat(),a=a.Ad();else{b=[];var c=0,e;for(e in a)b[c++]=e;a=Pa(a)}for(c=0;c<b.length;c++)this.set(b[c],a[c])};w.l=function(){return new Ac(this)};w.fg=function(){for(var a=new Ac,b=0;b<this.T.length;b++){var c=this.T[b];a.set(this.ga[c],c)}return a};function Dc(a,b){return Object.prototype.hasOwnProperty.call(a,b)};function Ec(){K.call(this);this.f="colortable";this.Ia=new Ac;Ga(this,new yc)}C(Ec,K);Ec.prototype.add=function(a,b,c,e,d,f){(!x(a)||!x(c)||!x(e)||!x(d)||!x(f))&&n(Error("Invalid color table entry."));this.Ia.set(a,[b,c,e,d,f]);this.j=q};Ec.prototype.get=function(a){return this.Ia.get(a)};B("X.colortable.prototype.get",Ec.prototype.get);function Fc(a,b,c){this.x=ia(a)?a:0;this.y=ia(b)?b:0;this.d=ia(c)?c:0}Fc.prototype.l=function(){return new Fc(this.x,this.y,this.d)};function Q(a,b,c){this.x=a;this.y=b;this.d=c}C(Q,Fc);w=Q.prototype;w.l=function(){return new Q(this.x,this.y,this.d)};w.Hb=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.d*this.d)};w.scale=function(a){this.x*=a;this.y*=a;this.d*=a;return this};w.Y=function(){this.x=-this.x;this.y=-this.y;this.d=-this.d;return this};w.normalize=function(){return this.scale(1/this.Hb())};w.add=function(a){this.x+=a.x;this.y+=a.y;this.d+=a.d;return this};
w.va=function(a){this.x-=a.x;this.y-=a.y;this.d-=a.d;return this};function Gc(a,b){var c=a.x-b.x,e=a.y-b.y,d=a.d-b.d;return Math.sqrt(c*c+e*e+d*d)}function Hc(a,b){var c=a.x-b.x,e=a.y-b.y,d=a.d-b.d;return c*c+e*e+d*d}function Ic(a,b){return new Q(a.x+b.x,a.y+b.y,a.d+b.d)}function Jc(a,b){return new Q(a.y*b.d-a.d*b.y,a.d*b.x-a.x*b.d,a.x*b.y-a.y*b.x)};D.m=Q;w=D.m.prototype;w.l=Q.prototype.l;w.Hb=Q.prototype.Hb;w.scale=Q.prototype.scale;w.Y=Q.prototype.Y;w.add=Q.prototype.add;w.va=Q.prototype.va;w.normalize=function(){var a=this.Hb();return 0==a?this.scale(0):this.scale(1/a)};D.m.ac=function(a,b){return a.x*b.x+a.y*b.y+a.d*b.d};D.m.mc=Jc;D.m.sf=Gc;D.m.se=function(a,b,c){return new Q(a.x+c*(b.x-a.x),a.y+c*(b.y-a.y),a.d+c*(b.d-a.d))};D.m.prototype.__defineGetter__("xx",v("x"));D.m.prototype.__defineGetter__("yy",v("y"));
D.m.prototype.__defineGetter__("zz",v("d"));B("X.vector",D.m);B("X.vector.prototype.clone",D.m.prototype.l);B("X.vector.prototype.magnitude",D.m.prototype.Hb);B("X.vector.prototype.scale",D.m.prototype.scale);B("X.vector.prototype.invert",D.m.prototype.Y);B("X.vector.prototype.normalize",D.m.prototype.normalize);B("X.vector.prototype.add",D.m.prototype.add);B("X.vector.prototype.subtract",D.m.prototype.va);B("X.vector.dot",D.m.ac);B("X.vector.cross",D.m.mc);B("X.vector.distance",D.m.sf);
B("X.vector.lerp",D.m.se);function Kc(a){this.length=a.length||a;for(var b=0;b<this.length;b++)this[b]=a[b]||0}Kc.prototype.BYTES_PER_ELEMENT=8;Kc.prototype.set=function(a,b){b=b||0;for(var c=0;c<a.length&&b+c<this.length;c++)this[b+c]=a[c]};Kc.prototype.toString=Array.prototype.join;if("undefined"==typeof Float64Array){try{Kc.BYTES_PER_ELEMENT=8}catch(Lc){}Kc.prototype.BYTES_PER_ELEMENT=Kc.prototype.BYTES_PER_ELEMENT;Kc.prototype.set=Kc.prototype.set;Kc.prototype.toString=Kc.prototype.toString;B("Float64Array",Kc)};function Mc(a){this.length=a.length||a;for(var b=0;b<this.length;b++)this[b]=a[b]||0}Mc.prototype.BYTES_PER_ELEMENT=4;Mc.prototype.set=function(a,b){b=b||0;for(var c=0;c<a.length&&b+c<this.length;c++)this[b+c]=a[c]};Mc.prototype.toString=Array.prototype.join;"undefined"==typeof Float32Array&&(Mc.BYTES_PER_ELEMENT=4,Mc.prototype.BYTES_PER_ELEMENT=Mc.prototype.BYTES_PER_ELEMENT,Mc.prototype.set=Mc.prototype.set,Mc.prototype.toString=Mc.prototype.toString,B("Float32Array",Mc));function Nc(){return new Float32Array(3)}function Oc(a,b,c){var e=Nc();e[0]=a;e[1]=b;e[2]=c;return e}function Pc(a,b){var c=a[0],e=a[1],d=a[2],c=1/Math.sqrt(c*c+e*e+d*d);b[0]=a[0]*c;b[1]=a[1]*c;b[2]=a[2]*c};function Qc(){return new Float32Array(4)}function Rc(a,b,c,e){var d=Qc();d[0]=a;d[1]=b;d[2]=c;d[3]=e;return d};function Sc(){return new Float32Array(16)}function Tc(){var a=Sc();a[0]=a[5]=a[10]=a[15]=1;return a}function Uc(a,b,c,e,d,f,g,h,l,j,k,m,r,s,y,z,F){a[0]=b;a[1]=c;a[2]=e;a[3]=d;a[4]=f;a[5]=g;a[6]=h;a[7]=l;a[8]=j;a[9]=k;a[10]=m;a[11]=r;a[12]=s;a[13]=y;a[14]=z;a[15]=F;return a}function Vc(a,b,c){b*=4;a[b]=c[0];a[b+1]=c[1];a[b+2]=c[2];a[b+3]=c[3]}function Wc(a,b,c){b*=4;c[0]=a[b];c[1]=a[b+1];c[2]=a[b+2];c[3]=a[b+3]}function S(a,b,c,e,d,f){a[b]=c;a[b+4]=e;a[b+8]=d;a[b+12]=f}
function Xc(a,b,c){a[b]=c[0];a[b+4]=c[1];a[b+8]=c[2];a[b+12]=c[3]}function Yc(a,b,c){c[0]=a[b];c[1]=a[b+4];c[2]=a[b+8];c[3]=a[b+12]}
function Zc(a,b,c){var e=a[0],d=a[1],f=a[2],g=a[3],h=a[4],l=a[5],j=a[6],k=a[7],m=a[8],r=a[9],s=a[10],y=a[11],z=a[12],F=a[13],G=a[14];a=a[15];var J=b[0],A=b[1],E=b[2],L=b[3],O=b[4],R=b[5],P=b[6],U=b[7],ca=b[8],da=b[9],M=b[10],oa=b[11],H=b[12],Oa=b[13],Fa=b[14];b=b[15];c[0]=e*J+h*A+m*E+z*L;c[1]=d*J+l*A+r*E+F*L;c[2]=f*J+j*A+s*E+G*L;c[3]=g*J+k*A+y*E+a*L;c[4]=e*O+h*R+m*P+z*U;c[5]=d*O+l*R+r*P+F*U;c[6]=f*O+j*R+s*P+G*U;c[7]=g*O+k*R+y*P+a*U;c[8]=e*ca+h*da+m*M+z*oa;c[9]=d*ca+l*da+r*M+F*oa;c[10]=f*ca+j*da+s*
M+G*oa;c[11]=g*ca+k*da+y*M+a*oa;c[12]=e*H+h*Oa+m*Fa+z*b;c[13]=d*H+l*Oa+r*Fa+F*b;c[14]=f*H+j*Oa+s*Fa+G*b;c[15]=g*H+k*Oa+y*Fa+a*b;return c}
function $c(a,b){var c=a[0],e=a[1],d=a[2],f=a[3],g=a[4],h=a[5],l=a[6],j=a[7],k=a[8],m=a[9],r=a[10],s=a[11],y=a[12],z=a[13],F=a[14],G=a[15],J=c*h-e*g,A=c*l-d*g,E=c*j-f*g,L=e*l-d*h,O=e*j-f*h,R=d*j-f*l,P=k*z-m*y,U=k*F-r*y,ca=k*G-s*y,da=m*F-r*z,M=m*G-s*z,oa=r*G-s*F,H=J*oa-A*M+E*da+L*ca-O*U+R*P;if(0==H)return u;H=1/H;b[0]=(h*oa-l*M+j*da)*H;b[1]=(-e*oa+d*M-f*da)*H;b[2]=(z*R-F*O+G*L)*H;b[3]=(-m*R+r*O-s*L)*H;b[4]=(-g*oa+l*ca-j*U)*H;b[5]=(c*oa-d*ca+f*U)*H;b[6]=(-y*R+F*E-G*A)*H;b[7]=(k*R-r*E+s*A)*H;b[8]=(g*
M-h*ca+j*P)*H;b[9]=(-c*M+e*ca-f*P)*H;b[10]=(y*O-z*E+G*J)*H;b[11]=(-k*O+m*E-s*J)*H;b[12]=(-g*da+h*U-l*P)*H;b[13]=(c*da-e*U+d*P)*H;b[14]=(-y*L+z*A-F*J)*H;b[15]=(k*L-m*A+r*J)*H;return q}function ad(a,b,c){var e=b[0],d=b[1];b=b[2];c[0]=e*a[0]+d*a[4]+b*a[8]+a[12];c[1]=e*a[1]+d*a[5]+b*a[9]+a[13];c[2]=e*a[2]+d*a[6]+b*a[10]+a[14]}
function cd(a,b,c){var e=b[0],d=b[1],f=b[2];b=b[3];c[0]=e*a[0]+d*a[4]+f*a[8]+b*a[12];c[1]=e*a[1]+d*a[5]+f*a[9]+b*a[13];c[2]=e*a[2]+d*a[6]+f*a[10]+b*a[14];c[3]=e*a[3]+d*a[7]+f*a[11]+b*a[15];return c}function dd(a,b,c,e){var d=a[1]*b+a[5]*c+a[9]*e+a[13],f=a[2]*b+a[6]*c+a[10]*e+a[14],g=a[3]*b+a[7]*c+a[11]*e+a[15];a[12]=a[0]*b+a[4]*c+a[8]*e+a[12];a[13]=d;a[14]=f;a[15]=g;return a}new Float64Array(3);new Float64Array(3);new Float64Array(4);new Float64Array(4);new Float64Array(4);new Float64Array(16);D.g={};D.g.xh=function(a,b,c,e){c=c.va(b);c.normalize();e=D.m.mc(c,e);e.normalize();var d=D.m.mc(e,c);d.normalize();c.Y();S(a,0,e.x,e.y,e.d,0);S(a,1,d.x,d.y,d.d,0);S(a,2,c.x,c.y,c.d,0);dd(a,-b.x,-b.y,-b.d);return a};D.g.aa=function(a,b,c,e){var d=1/(b*a[3]+c*a[7]+e*a[11]+a[15]);return new D.m((b*a[0]+c*a[4]+e*a[8]+a[12])*d,(b*a[1]+c*a[5]+e*a[9]+a[13])*d,(b*a[2]+c*a[6]+e*a[10]+a[14])*d)};
D.g.nk=function(a,b,c){var e=new Float32Array(4),d=new Float32Array(4);Yc(a,b,e);Yc(a,c,d);Xc(a,b,d);Xc(a,c,e);return a};D.g.mk=function(a,b,c){var e=new Float32Array(4),d=new Float32Array(4);Wc(a,b,e);Wc(a,c,d);Vc(a,b,d);Vc(a,c,e);return a};D.g.Bd=Tc;D.g.l=function(a){var b=Sc();b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=a[12];b[13]=a[13];b[14]=a[14];b[15]=a[15];return b};
D.g.fg=function(a,b){if(b==a){var c=a[1],e=a[2],d=a[3],f=a[6],g=a[7],h=a[11];b[1]=a[4];b[2]=a[8];b[3]=a[12];b[4]=c;b[6]=a[9];b[7]=a[13];b[8]=e;b[9]=f;b[11]=a[14];b[12]=d;b[13]=g;b[14]=h}else b[0]=a[0],b[1]=a[4],b[2]=a[8],b[3]=a[12],b[4]=a[1],b[5]=a[5],b[6]=a[9],b[7]=a[13],b[8]=a[2],b[9]=a[6],b[10]=a[10],b[11]=a[14],b[12]=a[3],b[13]=a[7],b[14]=a[11],b[15]=a[15];return b};
D.g.Mi=function(a){var b=a[0],c=a[1],e=a[2],d=a[3],f=a[4],g=a[5],h=a[6],l=a[7],j=a[8],k=a[9],m=a[10],r=a[11],s=a[12],y=a[13],z=a[14];a=a[15];return(b*g-c*f)*(m*a-r*z)-(b*h-e*f)*(k*a-r*y)+(b*l-d*f)*(k*z-m*y)+(c*h-e*g)*(j*a-r*s)-(c*l-d*g)*(j*z-m*s)+(e*l-d*h)*(j*y-k*s)};D.g.Y=$c;D.g.yf=function(a,b,c,e,d){var f=b/2;b=d-e;var g=Math.sin(f);if(0==b||0==g||0==c)return a;f=Math.cos(f)/g;return Uc(a,f/c,0,0,0,0,f,0,0,0,0,-(d+e)/b,-1,0,0,-(2*e*d)/b,0)};
D.g.mj=function(a,b,c,e,d,f,g){return Uc(a,2*f/(c-b),0,0,0,0,2*f/(d-e),0,0,(c+b)/(c-b),(d+e)/(d-e),-(g+f)/(g-f),-1,0,0,-(2*g*f)/(g-f),0)};D.g.nj=function(a,b,c,e,d,f,g){return Uc(a,2/(c-b),0,0,0,0,2/(d-e),0,0,0,0,-2/(g-f),0,-(c+b)/(c-b),-(d+e)/(d-e),-(g+f)/(g-f),1)};D.g.multiply=Zc;D.g.Bh=cd;D.g.translate=dd;D.g.scale=function(a,b,c,e){return Uc(a,a[0]*b,a[1]*b,a[2]*b,a[3]*b,a[4]*c,a[5]*c,a[6]*c,a[7]*c,a[8]*e,a[9]*e,a[10]*e,a[11]*e,a[12],a[13],a[14],a[15])};
D.g.rotate=function(a,b,c,e,d){var f=a[0],g=a[1],h=a[2],l=a[3],j=a[4],k=a[5],m=a[6],r=a[7],s=a[8],y=a[9],z=a[10],F=a[11],G=Math.cos(b),J=Math.sin(b),A=1-G;b=c*c*A+G;var E=c*e*A+d*J,L=c*d*A-e*J,O=c*e*A-d*J,R=e*e*A+G,P=e*d*A+c*J,U=c*d*A+e*J;c=e*d*A-c*J;d=d*d*A+G;return Uc(a,f*b+j*E+s*L,g*b+k*E+y*L,h*b+m*E+z*L,l*b+r*E+F*L,f*O+j*R+s*P,g*O+k*R+y*P,h*O+m*R+z*P,l*O+r*R+F*P,f*U+j*c+s*d,g*U+k*c+y*d,h*U+m*c+z*d,l*U+r*c+F*d,a[12],a[13],a[14],a[15])};
D.g.ye=function(a,b){var c=a[4],e=a[5],d=a[6],f=a[7],g=a[8],h=a[9],l=a[10],j=a[11],k=Math.cos(b),m=Math.sin(b);a[4]=c*k+g*m;a[5]=e*k+h*m;a[6]=d*k+l*m;a[7]=f*k+j*m;a[8]=c*-m+g*k;a[9]=e*-m+h*k;a[10]=d*-m+l*k;a[11]=f*-m+j*k;return a};D.g.ze=function(a,b){var c=a[0],e=a[1],d=a[2],f=a[3],g=a[8],h=a[9],l=a[10],j=a[11],k=Math.cos(b),m=Math.sin(b);a[0]=c*k+g*-m;a[1]=e*k+h*-m;a[2]=d*k+l*-m;a[3]=f*k+j*-m;a[8]=c*m+g*k;a[9]=e*m+h*k;a[10]=d*m+l*k;a[11]=f*m+j*k;return a};
D.g.Ae=function(a,b){var c=a[0],e=a[1],d=a[2],f=a[3],g=a[4],h=a[5],l=a[6],j=a[7],k=Math.cos(b),m=Math.sin(b);a[0]=c*k+g*m;a[1]=e*k+h*m;a[2]=d*k+l*m;a[3]=f*k+j*m;a[4]=c*-m+g*k;a[5]=e*-m+h*k;a[6]=d*-m+l*k;a[7]=f*-m+j*k;return a};B("X.matrix.identity",D.g.Bd);B("X.matrix.clone",D.g.l);B("X.matrix.transpose",D.g.fg);B("X.matrix.determinant",D.g.Mi);B("X.matrix.invert",D.g.Y);B("X.matrix.multiply",D.g.multiply);B("X.matrix.multiplyByVector",D.g.aa);B("X.matrix.multiplyByVec4",D.g.Bh);
B("X.matrix.makePerspective",D.g.yf);B("X.matrix.makeFrustum",D.g.mj);B("X.matrix.makeOrtho",D.g.nj);B("X.matrix.makeLookAt",D.g.xh);B("X.matrix.translate",D.g.translate);B("X.matrix.scale",D.g.scale);B("X.matrix.rotate",D.g.rotate);B("X.matrix.rotateX",D.g.ye);B("X.matrix.rotateY",D.g.ze);B("X.matrix.rotateZ",D.g.Ae);B("X.matrix.swapRows",D.g.nk);B("X.matrix.swapCols",D.g.mk);function ed(){K.call(this);this.f="transform";this.R=D.g.Bd()}C(ed,K);ed.prototype.__defineGetter__("matrix",v("R"));ed.prototype.__defineSetter__("matrix",function(a){(a==t||!(a instanceof Float32Array))&&n(Error("Invalid matrix."));this.R=a;this.q()});w=ed.prototype;w.ye=function(a){(!x(a)||-360>a||360<a)&&n(Error("Invalid angle."));D.g.ye(this.R,a*Math.PI/180);this.q()};w.ze=function(a){(!x(a)||-360>a||360<a)&&n(Error("Invalid angle."));D.g.ze(this.R,a*Math.PI/180);this.q()};
w.Ae=function(a){(!x(a)||-360>a||360<a)&&n(Error("Invalid angle."));D.g.Ae(this.R,a*Math.PI/180);this.q()};w.ci=function(a){x(a)||n(Error("Invalid distance."));D.g.translate(this.R,a,0,0);this.q()};w.di=function(a){x(a)||n(Error("Invalid distance."));D.g.translate(this.R,0,a,0);this.q()};w.ei=function(a){x(a)||n(Error("Invalid distance."));D.g.translate(this.R,0,0,a);this.q()};function fd(a,b,c){a.R[b+4*c]*=-1;a.q()}w.Si=function(){fd(this,0,0)};w.Ti=function(){fd(this,1,1)};
w.Ui=function(){fd(this,2,2)};w.q=function(){this.j=q};B("X.transform",ed);B("X.transform.prototype.rotateX",ed.prototype.ye);B("X.transform.prototype.rotateY",ed.prototype.ze);B("X.transform.prototype.rotateZ",ed.prototype.Ae);B("X.transform.prototype.translateX",ed.prototype.ci);B("X.transform.prototype.translateY",ed.prototype.di);B("X.transform.prototype.translateZ",ed.prototype.ei);B("X.transform.prototype.flipX",ed.prototype.Si);B("X.transform.prototype.flipY",ed.prototype.Ti);
B("X.transform.prototype.flipZ",ed.prototype.Ui);B("X.transform.prototype.modified",ed.prototype.q);function gd(){K.call(this);this.f="texture";this.Wb=this.rb=this.r=t;this.We=this.Xe=0;this.sg=u;Ga(this,new yc)}C(gd,K);gd.prototype.__defineSetter__("rawData",function(a){this.Wb=a;this.j=q});gd.prototype.__defineSetter__("rawDataHeight",function(a){this.We=a;this.j=q});gd.prototype.__defineSetter__("rawDataWidth",function(a){this.Xe=a;this.j=q});gd.prototype.__defineSetter__("grayscale",function(a){this.sg=a;this.j=q});B("X.texture",gd);function T(a,b){K.call(this);this.f="triplets";this.ib=Infinity;this.fb=-Infinity;this.jb=Infinity;this.gb=-Infinity;this.kb=Infinity;this.hb=-Infinity;this.Od=[0,0,0];this.rg=q;this.D=0;this.ca=new Float32Array(a);b!=t&&(this.ca=b.ca.subarray(0,b.ca.length),this.D=this.ca.length,this.ib=b.ib,this.fb=b.fb,this.jb=b.jb,this.gb=b.gb,this.kb=b.kb,this.hb=b.hb,this.Od=b.Od.slice(),this.rg=u)}C(T,K);w=T.prototype;
w.add=function(a,b,c){this.ib=Math.min(this.ib,a);this.fb=Math.max(this.fb,a);this.jb=Math.min(this.jb,b);this.gb=Math.max(this.gb,b);this.kb=Math.min(this.kb,c);this.hb=Math.max(this.hb,c);this.Od=[(this.ib+this.fb)/2,(this.jb+this.gb)/2,(this.kb+this.hb)/2];this.rg=u;this.j=q;this.ca[this.D++]=a;this.ca[this.D++]=b;this.ca[this.D++]=c;return this.D/3};w.Ib=function(){if(this.D!=this.ca.length){var a=new Float32Array(this.D);a.set(this.ca.subarray(0,this.D));this.ca=a}};
w.get=function(a){a*=3;return[this.ca[a],this.ca[a+1],this.ca[a+2]]};w.remove=function(){n(Error("Not implemented."))};w.clear=function(){this.ca=new Float32Array(this.ca.length);this.j=q};T.prototype.__defineGetter__("count",function(){this.Ib();return this.ca.length/3});T.prototype.__defineGetter__("length",function(){this.Ib();return this.ca.length});B("X.triplets",T);B("X.triplets.prototype.add",T.prototype.add);B("X.triplets.prototype.resize",T.prototype.Ib);B("X.triplets.prototype.get",T.prototype.get);
B("X.triplets.prototype.remove",T.prototype.remove);B("X.triplets.prototype.clear",T.prototype.clear);function hd(){this.Ga=id;this.ka=new ed;this.w=[1,1,1];this.Qc=this.H=this.pa=this.n=this.h=t;this.Jc=[];this.P=q;this.Hc=this.md=1;this.yc=t;this.cd=u;this.ta=1;this.wa=0;this.ld=q}var id="TRIANGLES";hd.prototype.__defineSetter__("type",function(a){return this.Ga=a});hd.prototype.__defineGetter__("type",v("Ga"));hd.prototype.__defineGetter__("texture",function(){this.H||(this.H=new gd);return this.H});hd.prototype.__defineGetter__("transform",v("ka"));hd.prototype.__defineGetter__("points",v("h"));
hd.prototype.__defineSetter__("points",ba("h"));hd.prototype.__defineGetter__("normals",v("n"));hd.prototype.__defineSetter__("normals",ba("n"));hd.prototype.__defineGetter__("colors",v("pa"));hd.prototype.__defineSetter__("colors",ba("pa"));hd.prototype.__defineGetter__("color",v("w"));hd.prototype.__defineSetter__("color",function(a){(a==t||!ka(a)||3!=a.length)&&n(Error("Invalid color."));for(var b=this.c,c=b.length,e=0,e=0;e<c;e++)b[e].color=a;this.w=a;this.j=q});
hd.prototype.__defineGetter__("opacity",v("ta"));hd.prototype.__defineSetter__("opacity",function(a){(!x(a)||1<a||0>a)&&n(Error("Invalid opacity."));for(var b=this.c,c=b.length,e=0,e=0;e<c;e++)b[e]!=t&&(b[e].opacity=a);this.ta=a;this.j=q});hd.prototype.__defineGetter__("caption",v("yc"));hd.prototype.__defineSetter__("caption",function(a){this.yc=a;this.j=q});hd.prototype.__defineGetter__("visible",v("P"));
hd.prototype.__defineSetter__("visible",function(a){for(var b=this.c,c=b.length,e=0,e=0;e<c;e++)b[e]!=t&&(b[e].visible=a);this.P=a;this.j=q});hd.prototype.__defineGetter__("pointsize",v("md"));hd.prototype.__defineSetter__("pointsize",function(a){x(a)||n(Error("Invalid point size."));this.md=a;this.j=q});hd.prototype.__defineGetter__("magicmode",v("cd"));hd.prototype.__defineSetter__("magicmode",function(a){"boolean"!=typeof a&&n(Error("Invalid magic mode setting."));this.cd=a;this.j=q});
hd.prototype.__defineGetter__("linewidth",v("Hc"));hd.prototype.__defineSetter__("linewidth",function(a){x(a)||n(Error("Invalid line width."));this.Hc=a;this.j=q});hd.prototype.__defineGetter__("pickable",v("ld"));hd.prototype.__defineSetter__("pickable",function(a){"boolean"!=typeof a&&n(Error("Invalid pickable setting."));this.ld=a;this.j=q});hd.prototype.__defineGetter__("textureCoordinateMap",v("Qc"));hd.prototype.__defineSetter__("textureCoordinateMap",ba("rl"));function jd(){this.Ja=Infinity;this.V=this.ja=-Infinity;this.W=Infinity;this.Rb=[0,0,0];this.Pb=[1,1,1]}jd.prototype.__defineGetter__("lowerThreshold",v("V"));jd.prototype.__defineSetter__("lowerThreshold",ba("V"));jd.prototype.__defineGetter__("upperThreshold",v("W"));jd.prototype.__defineSetter__("upperThreshold",ba("W"));jd.prototype.__defineGetter__("min",v("Ja"));jd.prototype.__defineGetter__("max",v("ja"));jd.prototype.__defineGetter__("minColor",v("Rb"));
jd.prototype.__defineSetter__("minColor",function(a){(a==t||!ka(a)||3!=a.length)&&n(Error("Invalid min. color."));this.Rb=a});jd.prototype.__defineGetter__("maxColor",v("Pb"));jd.prototype.__defineSetter__("maxColor",function(a){(a==t||!ka(a)||3!=a.length)&&n(Error("Invalid max. color."));this.Pb=a});function kd(){K.call(this);this.f="scalars";this.$c=this.J=t;this.Fg=q;this.Le=0;Ga(this,new yc);Ga(this,new jd);this.Rb=[0,1,0];this.Pb=[1,0,0]}C(kd,K);kd.prototype.__defineGetter__("array",v("J"));kd.prototype.__defineSetter__("array",function(a){this.$c=this.J=a;this.j=q});kd.prototype.__defineGetter__("interpolation",v("Le"));kd.prototype.__defineSetter__("interpolation",ba("Le"));B("X.scalars",kd);function V(a){K.call(this);this.f="object";this.c=[];this.K=this.Da=t;Ga(this,new hd);a!=t&&this.lc(a)}C(V,K);
V.prototype.lc=function(a){this.Ga=a.Ga;this.ka=new ed;this.ka.R=new Float32Array(a.ka.R);this.w=a.w.slice();a.h&&(this.h=new T(a.h.length,a.h));a.n&&(this.n=new T(a.n.length,a.n));a.pa&&(this.pa=new T(a.pa.length,a.pa));this.H=a.H;this.Qc=a.Qc;a.r&&(this.r=new xc((new String(a.r.Yd)).toString()));this.ta=a.ta;this.c.length=0;var b=a.c;if(b)for(var c=b.length,e=0,e=0;e<c;e++)this.c.push(new D[b[e].f](b[e]));this.P=a.P;this.md=a.md;this.Hc=a.Hc;a.yc&&(this.yc=(new String(a.yc)).toString());this.cd=
a.cd;this.ld=a.ld;this.Jc=a.Jc.slice();this.j=q};V.prototype.__defineGetter__("colortable",function(){this.Da||(this.Da=new Ec);return this.Da});V.prototype.__defineGetter__("scalars",function(){this.K||(this.K=new kd);return this.K});V.prototype.__defineGetter__("children",v("c"));V.prototype.q=function(){var a=new ld;a.F=this;this.dispatchEvent(a)};V.prototype.remove=function(){var a=new md;a.F=this;this.dispatchEvent(a)};
function nd(a,b){(a==t||b==t||!(a instanceof V)||!(b instanceof V))&&n(Error("Fatal: Two valid X.objects are required for comparison."));return 1==a.ta?-1:1==b.ta?1:a.wa!=t&&b.wa!=t&&a.wa>b.wa?-1:1}B("X.object",V);B("X.object.prototype.modified",V.prototype.q);B("X.object.prototype.remove",V.prototype.remove);function od(){}function pd(a){for(var b=a.h.count,c=[],e=0,e=0;e<b;e+=3){var d=a.h.get(e),f=a.h.get(e+1),g=a.h.get(e+2),h=a.n.get(e),l=a.n.get(e+1),j=a.n.get(e+2),k=a.w;a.pa&&0<a.pa.length&&(k=a.pa.get(e));var m=[];m.push(new lc(d,h));m.push(new lc(f,l));m.push(new lc(g,j));c.push(new nc(m,k))}return vc(c)}
function qd(a,b){(b==t||!(b instanceof uc))&&n(Error("Invalid CSG object."));var c=new wc,e=[];Nb(b.Z,function(a){var b=[],g=a.De,b=Nb(a.Kb,function(a){a.color=g;return c.add(a)});for(a=a=2;a<b.length;a++)e.push([b[0],b[a-1],b[a]])}.bind(a));a.ui=Nb(c.unique(),function(a){return[a.Ua.x(),a.Ua.y(),a.Ua.d()]});a.ti=Nb(c.unique(),function(a){return[a.ua.x(),a.ua.y(),a.ua.d()]});a.si=Nb(c.unique(),function(a){return!a.color?t:[a.color[0],a.color[1],a.color[2]]});a.h=new T(9*e.length);a.n=new T(9*e.length);
a.pa=new T(9*e.length);Nb(e,function(a){var b=a[0],c=a[1];a=a[2];var e=this.ui,l=this.ti,j=this.si;this.h.add(e[b][0],e[b][1],e[b][2]);this.h.add(e[c][0],e[c][1],e[c][2]);this.h.add(e[a][0],e[a][1],e[a][2]);this.n.add(l[b][0],l[b][1],l[b][2]);this.n.add(l[c][0],l[c][1],l[c][2]);this.n.add(l[a][0],l[a][1],l[a][2]);j[b]&&this.pa.add(j[b][0],j[b][1],j[b][2]);j[c]&&this.pa.add(j[c][0],j[c][1],j[c][2]);j[a]&&this.pa.add(j[a][0],j[a][1],j[a][2])}.bind(a));0==a.pa.D&&(a.pa=t);a.Ga=id}
od.prototype.gg=function(a){(a==t||!(a instanceof uc)&&!(a instanceof V))&&n(Error("Invalid object."));var b=a;a instanceof V&&(b=pd(b));a=new V;Ga(a,new od);qd(a,pd(this).gg(b));return a};od.prototype.va=function(a){(a==t||!(a instanceof uc)&&!(a instanceof V))&&n(Error("Invalid object."));var b=a;a instanceof V&&(b=pd(b));a=new V;Ga(a,new od);qd(a,pd(this).va(b));return a};
od.prototype.vf=function(a){(a==t||!(a instanceof uc)&&!(a instanceof V))&&n(Error("Invalid object."));var b=a;a instanceof V&&(b=pd(b));a=new V;Ga(a,new od);qd(a,pd(this).vf(b));return a};od.prototype.inverse=function(){var a=new V;Ga(a,new od);qd(a,pd(this).inverse());return a};B("X.constructable",od);B("X.constructable.prototype.intersect",od.prototype.vf);B("X.constructable.prototype.inverse",od.prototype.inverse);B("X.constructable.prototype.subtract",od.prototype.va);
B("X.constructable.prototype.union",od.prototype.gg);function rd(a){Tb.call(this,a);this.f="event"}C(rd,Tb);var sd=jc("pan"),td=jc("rotate"),ud=jc("zoom"),vd=jc("scroll");jc("render");var wd=jc("resetview"),xd=jc("windowlevel"),yd=jc("modified"),zd=jc("remove"),Ad=jc("progress"),Bd=jc("hover"),Cd=jc("hover_end"),Dd=jc("computing"),Ed=jc("computing_end"),Fd=jc("computing_progress");function Gd(){rd.call(this,xd);this.Qe=this.cf=0}C(Gd,rd);function Hd(){rd.call(this,sd);this.wa=new D.m(0,0,0)}C(Hd,rd);
function Id(){rd.call(this,td);this.wa=new D.m(0,0,0)}C(Id,rd);function Jd(){rd.call(this,ud);this.eb=this.sb=u}C(Jd,rd);function Kd(){rd.call(this,vd);this.da=u}C(Kd,rd);function Ld(){rd.call(this,Bd);this.ee=this.de=0}C(Ld,rd);function Md(){rd.call(this,Cd)}C(Md,rd);function Nd(){rd.call(this,wd)}C(Nd,rd);function ld(){rd.call(this,yd);this.u=this.F=t}C(ld,rd);function md(){rd.call(this,zd);this.u=this.F=t}C(md,rd);function Od(){rd.call(this,Ad);this.wd=0}C(Od,rd);
function Pd(){rd.call(this,Dd);this.F=t}C(Pd,rd);function Qd(){rd.call(this,Fd);this.wd=0}C(Qd,rd);function Rd(){rd.call(this,Ed);this.F=t}C(Rd,rd);B("X.event.events.PAN",sd);B("X.event.events.ROTATE",td);B("X.event.events.ZOOM",ud);B("X.event.events.SCROLL",vd);function Sd(a,b,c){a==t&&n(Error("Invalid GL Buffer."));b==t&&n(Error("Invalid number of items."));c==t&&n(Error("Invalid item size."));K.call(this);this.f="buffer";this.Q=a;this.Nb=b;this.Ob=c}C(Sd,K);var Td;function Ud(a,b){var c;c=a.className;c=ma(c)&&c.match(/\S+/g)||[];for(var e=Qb(arguments,1),d=c.length+e.length,f=c,g=0;g<e.length;g++)0<=Kb(f,e[g])||f.push(e[g]);a.className=c.join(" ");return c.length==d};function Vd(a,b){this.width=a;this.height=b}w=Vd.prototype;w.l=function(){return new Vd(this.width,this.height)};w.ceil=function(){this.width=Math.ceil(this.width);this.height=Math.ceil(this.height);return this};w.floor=function(){this.width=Math.floor(this.width);this.height=Math.floor(this.height);return this};w.round=function(){this.width=Math.round(this.width);this.height=Math.round(this.height);return this};w.scale=function(a,b){var c=x(b)?b:a;this.width*=a;this.height*=c;return this};var Wd=!lb||lb&&9<=Gb;!mb&&!lb||lb&&lb&&9<=Gb||mb&&Eb("1.9.1");lb&&Eb("9");function Xd(a,b){this.x=ia(a)?a:0;this.y=ia(b)?b:0}w=Xd.prototype;w.l=function(){return new Xd(this.x,this.y)};function Yd(a,b){return new Xd(a.x-b.x,a.y-b.y)}w.ceil=function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);return this};w.floor=function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);return this};w.round=function(){this.x=Math.round(this.x);this.y=Math.round(this.y);return this};
w.translate=function(a,b){a instanceof Xd?(this.x+=a.x,this.y+=a.y):(this.x+=a,x(b)&&(this.y+=b));return this};w.scale=function(a,b){var c=x(b)?b:a;this.x*=a;this.y*=c;return this};function Zd(a){return a?new $d(ae(a)):Td||(Td=new $d)}function be(a){return ma(a)?document.getElementById(a):a}var ce={cellpadding:"cellPadding",cellspacing:"cellSpacing",colspan:"colSpan",frameborder:"frameBorder",height:"height",maxlength:"maxLength",role:"role",rowspan:"rowSpan",type:"type",usemap:"useMap",valign:"vAlign",width:"width"};function de(a,b,c){return ee(document,arguments)}
function ee(a,b){var c=b[0],e=b[1];if(!Wd&&e&&(e.name||e.type)){c=["<",c];e.name&&c.push(' name="',Ta(e.name),'"');if(e.type){c.push(' type="',Ta(e.type),'"');var d={};Sa(d,e);delete d.type;e=d}c.push(">");c=c.join("")}var f=a.createElement(c);e&&(ma(e)?f.className=e:ka(e)?Ud.apply(t,[f].concat(e)):Na(e,function(a,b){"style"==b?f.style.cssText=a:"class"==b?f.className=a:"for"==b?f.htmlFor=a:b in ce?f.setAttribute(ce[b],a):0==b.lastIndexOf("aria-",0)||0==b.lastIndexOf("data-",0)?f.setAttribute(b,a):
f[b]=a}));if(2<b.length){e=function(b){b&&f.appendChild(ma(b)?a.createTextNode(b):b)};for(c=2;c<b.length;c++){var g=b[c];if(la(g)&&!(pa(g)&&0<g.nodeType)){var d=Lb,h;a:{if((h=g)&&"number"==typeof h.length){if(pa(h)){h="function"==typeof h.item||"string"==typeof h.item;break a}if(na(h)){h="function"==typeof h.item;break a}}h=u}if(h)if(h=g.length,0<h){for(var l=Array(h),j=0;j<h;j++)l[j]=g[j];g=l}else g=[];d(g,e)}else e(g)}}return f}function fe(a){a&&a.parentNode&&a.parentNode.removeChild(a)}
function ge(a){for(;a&&1!=a.nodeType;)a=a.nextSibling;return a}function he(a,b){if(a.contains&&1==b.nodeType)return a==b||a.contains(b);if("undefined"!=typeof a.compareDocumentPosition)return a==b||Boolean(a.compareDocumentPosition(b)&16);for(;b&&a!=b;)b=b.parentNode;return b==a}function ae(a){return 9==a.nodeType?a:a.ownerDocument||a.document}function $d(a){this.la=a||fa.document||document}w=$d.prototype;w.ne=Zd;w.s=function(a){return ma(a)?this.la.getElementById(a):a};w.ki=$d.prototype.s;
w.Tc=function(a,b,c){return ee(this.la,arguments)};w.createElement=function(a){return this.la.createElement(a)};w.createTextNode=function(a){return this.la.createTextNode(String(a))};function ie(a){return"CSS1Compat"==a.la.compatMode}function je(a){var b=a.la;a=!ob&&"CSS1Compat"==b.compatMode?b.documentElement:b.body;b=b.parentWindow||b.defaultView;return lb&&Eb("10")&&b.pageYOffset!=a.scrollTop?new Xd(a.scrollLeft,a.scrollTop):new Xd(b.pageXOffset||a.scrollLeft,b.pageYOffset||a.scrollTop)}
w.appendChild=function(a,b){a.appendChild(b)};w.contains=he;function ke(a,b,c,e){this.top=a;this.right=b;this.bottom=c;this.left=e}w=ke.prototype;w.l=function(){return new ke(this.top,this.right,this.bottom,this.left)};w.contains=function(a){return!this||!a?u:a instanceof ke?a.left>=this.left&&a.right<=this.right&&a.top>=this.top&&a.bottom<=this.bottom:a.x>=this.left&&a.x<=this.right&&a.y>=this.top&&a.y<=this.bottom};
w.ceil=function(){this.top=Math.ceil(this.top);this.right=Math.ceil(this.right);this.bottom=Math.ceil(this.bottom);this.left=Math.ceil(this.left);return this};w.floor=function(){this.top=Math.floor(this.top);this.right=Math.floor(this.right);this.bottom=Math.floor(this.bottom);this.left=Math.floor(this.left);return this};w.round=function(){this.top=Math.round(this.top);this.right=Math.round(this.right);this.bottom=Math.round(this.bottom);this.left=Math.round(this.left);return this};
w.translate=function(a,b){a instanceof Xd?(this.left+=a.x,this.right+=a.x,this.top+=a.y,this.bottom+=a.y):(this.left+=a,this.right+=a,x(b)&&(this.top+=b,this.bottom+=b));return this};w.scale=function(a,b){var c=x(b)?b:a;this.left*=a;this.right*=a;this.top*=c;this.bottom*=c;return this};function le(a,b,c,e){this.left=a;this.top=b;this.width=c;this.height=e}w=le.prototype;w.l=function(){return new le(this.left,this.top,this.width,this.height)};w.sh=function(a){var b=Math.max(this.left,a.left),c=Math.min(this.left+this.width,a.left+a.width);if(b<=c){var e=Math.max(this.top,a.top);a=Math.min(this.top+this.height,a.top+a.height);if(e<=a)return this.left=b,this.top=e,this.width=c-b,this.height=a-e,q}return u};
w.contains=function(a){return a instanceof le?this.left<=a.left&&this.left+this.width>=a.left+a.width&&this.top<=a.top&&this.top+this.height>=a.top+a.height:a.x>=this.left&&a.x<=this.left+this.width&&a.y>=this.top&&a.y<=this.top+this.height};function me(a,b){var c=b.x<a.left?a.left-b.x:Math.max(b.x-(a.left+a.width),0),e=b.y<a.top?a.top-b.y:Math.max(b.y-(a.top+a.height),0);return c*c+e*e}w.sf=function(a){return Math.sqrt(me(this,a))};
w.ceil=function(){this.left=Math.ceil(this.left);this.top=Math.ceil(this.top);this.width=Math.ceil(this.width);this.height=Math.ceil(this.height);return this};w.floor=function(){this.left=Math.floor(this.left);this.top=Math.floor(this.top);this.width=Math.floor(this.width);this.height=Math.floor(this.height);return this};w.round=function(){this.left=Math.round(this.left);this.top=Math.round(this.top);this.width=Math.round(this.width);this.height=Math.round(this.height);return this};
w.translate=function(a,b){a instanceof Xd?(this.left+=a.x,this.top+=a.y):(this.left+=a,x(b)&&(this.top+=b));return this};w.scale=function(a,b){var c=x(b)?b:a;this.left*=a;this.width*=a;this.top*=c;this.height*=c;return this};function ne(a,b){var c=ae(a);return c.defaultView&&c.defaultView.getComputedStyle&&(c=c.defaultView.getComputedStyle(a,t))?c[b]||c.getPropertyValue(b)||"":""}function oe(a,b){return ne(a,b)||(a.currentStyle?a.currentStyle[b]:t)||a.style&&a.style[b]}function pe(a){a=a?ae(a):document;return lb&&!(lb&&9<=Gb)&&!ie(Zd(a))?a.body:a.documentElement}
function qe(a){var b=a.getBoundingClientRect();lb&&(a=a.ownerDocument,b.left-=a.documentElement.clientLeft+a.body.clientLeft,b.top-=a.documentElement.clientTop+a.body.clientTop);return b}
function re(a){if(lb&&!(lb&&8<=Gb))return a.offsetParent;var b=ae(a),c=oe(a,"position"),e="fixed"==c||"absolute"==c;for(a=a.parentNode;a&&a!=b;a=a.parentNode)if(c=oe(a,"position"),e=e&&"static"==c&&a!=b.documentElement&&a!=b.body,!e&&(a.scrollWidth>a.clientWidth||a.scrollHeight>a.clientHeight||"fixed"==c||"absolute"==c||"relative"==c))return a;return t}
function se(a){for(var b=new ke(0,Infinity,Infinity,0),c=Zd(a),e=c.la.body,d=c.la.documentElement,f=!ob&&"CSS1Compat"==c.la.compatMode?c.la.documentElement:c.la.body;a=re(a);)if((!lb||0!=a.clientWidth)&&(!ob||0!=a.clientHeight||a!=e)&&a!=e&&a!=d&&"visible"!=oe(a,"overflow")){var g=te(a),h;h=a;if(mb&&!Eb("1.9")){var l=parseFloat(ne(h,"borderLeftWidth"));if(ue(h))var j=h.offsetWidth-h.clientWidth-l-parseFloat(ne(h,"borderRightWidth")),l=l+j;h=new Xd(l,parseFloat(ne(h,"borderTopWidth")))}else h=new Xd(h.clientLeft,
h.clientTop);g.x+=h.x;g.y+=h.y;b.top=Math.max(b.top,g.y);b.right=Math.min(b.right,g.x+a.clientWidth);b.bottom=Math.min(b.bottom,g.y+a.clientHeight);b.left=Math.max(b.left,g.x)}e=f.scrollLeft;f=f.scrollTop;b.left=Math.max(b.left,e);b.top=Math.max(b.top,f);c=(c.la.parentWindow||c.la.defaultView||window).document;c="CSS1Compat"==c.compatMode?c.documentElement:c.body;c=new Vd(c.clientWidth,c.clientHeight);b.right=Math.min(b.right,e+c.width);b.bottom=Math.min(b.bottom,f+c.height);return 0<=b.top&&0<=b.left&&
b.bottom>b.top&&b.right>b.left?b:t}
function te(a){var b,c=ae(a),e=oe(a,"position"),d=mb&&c.getBoxObjectFor&&!a.getBoundingClientRect&&"absolute"==e&&(b=c.getBoxObjectFor(a))&&(0>b.screenX||0>b.screenY),f=new Xd(0,0),g=pe(c);if(a==g)return f;if(a.getBoundingClientRect)b=qe(a),a=je(Zd(c)),f.x=b.left+a.x,f.y=b.top+a.y;else if(c.getBoxObjectFor&&!d)b=c.getBoxObjectFor(a),a=c.getBoxObjectFor(g),f.x=b.screenX-a.screenX,f.y=b.screenY-a.screenY;else{b=a;do{f.x+=b.offsetLeft;f.y+=b.offsetTop;b!=a&&(f.x+=b.clientLeft||0,f.y+=b.clientTop||0);
if(ob&&"fixed"==oe(b,"position")){f.x+=c.body.scrollLeft;f.y+=c.body.scrollTop;break}b=b.offsetParent}while(b&&b!=a);if(kb||ob&&"absolute"==e)f.y-=c.body.offsetTop;for(b=a;(b=re(b))&&b!=c.body&&b!=g;)if(f.x-=b.scrollLeft,!kb||"TR"!=b.tagName)f.y-=b.scrollTop}return f}
function ve(a){var b=new Xd;if(1==a.nodeType){if(a.getBoundingClientRect){var c=qe(a);b.x=c.left;b.y=c.top}else{var c=je(Zd(a)),e=te(a);b.x=e.x-c.x;b.y=e.y-c.y}if(mb&&!Eb(12)){var d;lb?d="-ms-transform":ob?d="-webkit-transform":kb?d="-o-transform":mb&&(d="-moz-transform");var f;d&&(f=oe(a,d));f||(f=oe(a,"transform"));f?(a=f.match(we),a=!a?new Xd(0,0):new Xd(parseFloat(a[1]),parseFloat(a[2]))):a=new Xd(0,0);b=new Xd(b.x+a.x,b.y+a.y)}}else d=na(a.Xi),f=a,a.targetTouches?f=a.targetTouches[0]:d&&a.ob.targetTouches&&
(f=a.ob.targetTouches[0]),b.x=f.clientX,b.y=f.clientY;return b}function xe(a,b){"number"==typeof a&&(a=(b?Math.round(a):a)+"px");return a}function ye(a){if("none"!=oe(a,"display"))return ze(a);var b=a.style,c=b.display,e=b.visibility,d=b.position;b.visibility="hidden";b.position="absolute";b.display="inline";a=ze(a);b.display=c;b.position=d;b.visibility=e;return a}
function ze(a){var b=a.offsetWidth,c=a.offsetHeight,e=ob&&!b&&!c;return(!ia(b)||e)&&a.getBoundingClientRect?(a=qe(a),new Vd(a.right-a.left,a.bottom-a.top)):new Vd(b,c)}function Ae(a,b){a.style.display=b?"":"none"}function ue(a){return"rtl"==oe(a,"direction")}function Be(a,b){if(/^\d+px?$/.test(b))return parseInt(b,10);var c=a.style.left,e=a.runtimeStyle.left;a.runtimeStyle.left=a.currentStyle.left;a.style.left=b;var d=a.style.pixelLeft;a.style.left=c;a.runtimeStyle.left=e;return d}
function Ce(a,b){var c=a.currentStyle?a.currentStyle[b]:t;return c?Be(a,c):0}var De={thin:2,medium:4,thick:6};function Ee(a,b){if("none"==(a.currentStyle?a.currentStyle[b+"Style"]:t))return 0;var c=a.currentStyle?a.currentStyle[b+"Width"]:t;return c in De?De[c]:Be(a,c)}var we=/matrix\([0-9\.\-]+, [0-9\.\-]+, [0-9\.\-]+, [0-9\.\-]+, ([0-9\.\-]+)p?x?, ([0-9\.\-]+)p?x?\)/;function Fe(a,b){kc.call(this);this.I=a;var c=pa(this.I)&&1==this.I.nodeType?this.I:this.I?this.I.body:t;this.kj=!!c&&ue(c);this.Hl=I(this.I,mb?"DOMMouseScroll":"mousewheel",this,b)}C(Fe,kc);
Fe.prototype.handleEvent=function(a){var b=0,c=0,e=0;a=a.ob;if("mousewheel"==a.type){c=1;if(lb||ob&&(db||Eb("532.0")))c=40;e=Ge(-a.wheelDelta,c);ia(a.wheelDeltaX)?(b=Ge(-a.wheelDeltaX,c),c=Ge(-a.wheelDeltaY,c)):c=e}else e=a.detail,100<e?e=3:-100>e&&(e=-3),ia(a.axis)&&a.axis===a.HORIZONTAL_AXIS?b=e:c=e;x(this.yh)&&(b=Math.min(Math.max(b,-this.yh),this.yh));x(this.zh)&&(c=Math.min(Math.max(c,-this.zh),this.zh));this.kj&&(b=-b);b=new He(e,a,b,c);this.dispatchEvent(b)};
function Ge(a,b){return ob&&(cb||eb)&&0!=a%b?a:a/b}function He(a,b,c,e){b&&this.Aa(b,p);this.type="mousewheel";this.detail=a;this.xl=c;this.Uc=e}C(He,Vb);lb||ob&&Eb("525");function Ie(a){K.call(this);this.f="interactor";this.Na=a;this.Re=this.zg=this.yg=this.Ag=this.xg=this.Bg=t;this.Wd=q;this.Xb=this.Qb=this.tb=u;this.sa=[0,0];this.Me=new D.m(0,0,0);this.ad=new D.m(0,0,0);this.uh=0;this.Ig=this.Td=t;this.Hg=u;this.S={MOUSEWHEEL_ENABLED:q,MOUSECLICKS_ENABLED:q,KEYBOARD_ENABLED:q,HOVERING_ENABLED:q,CONTEXTMENU_ENABLED:u,TOUCH_ENABLED:q,TOUCH_BOUNCING_ENABLED:u}}C(Ie,K);Ie.prototype.__defineGetter__("config",v("S"));Ie.prototype.__defineGetter__("leftButtonDown",v("tb"));
Ie.prototype.__defineGetter__("middleButtonDown",v("Qb"));Ie.prototype.__defineGetter__("rightButtonDown",v("Xb"));
Ie.prototype.Aa=function(){this.S.MOUSEWHEEL_ENABLED?(this.Re=new Fe(this.Na),this.Bg=I(this.Re,"mousewheel",this.Hd.bind(this))):(dc(this.Bg),this.Re=t);this.S.MOUSECLICKS_ENABLED?(this.xg=I(this.Na,"mousedown",this.Ej.bind(this)),this.Ag=I(this.Na,"mouseup",this.Jj.bind(this))):(dc(this.xg),dc(this.Ag));this.Na.oncontextmenu=this.S.CONTEXTMENU_ENABLED?t:function(){return u};window.onkeydown=this.S.KEYBOARD_ENABLED?this.Ih.bind(this):t;this.S.TOUCH_ENABLED?(this.S.TOUCH_BOUNCING_ENABLED||document.body.addEventListener("touchmove",
function(a){a.preventDefault()},u),this.Ci=I(this.Na,"touchstart",this.Yj.bind(this)),this.Bi=I(this.Na,"touchmove",this.Wj.bind(this)),this.Ai=I(this.Na,"touchend",this.Sj.bind(this))):(dc(this.Ci),dc(this.Bi),dc(this.Ai));dc(this.yg);dc(this.zg);this.yg=I(this.Na,"mousemove",this.Gj.bind(this));this.zg=I(this.Na,"mouseout",this.Hj.bind(this))};
Ie.prototype.Ej=function(a){0==a.button?this.tb=q:1==a.button?this.Qb=q:2==a.button&&(this.Xb=q);eval("this.onMouseDown("+this.tb+","+this.Qb+","+this.Xb+")");Je(this);a.preventDefault()};Ie.prototype.Dj=aa();Ie.prototype.Jj=function(a){0==a.button?this.tb=u:1==a.button?this.Qb=u:2==a.button&&(this.Xb=u);eval("this.onMouseUp("+this.tb+","+this.Qb+","+this.Xb+")");Je(this);a.preventDefault()};Ie.prototype.__defineGetter__("mousePosition",v("sa"));w=Ie.prototype;w.Ij=aa();
w.Hj=function(a){this.Wd=u;this.S.KEYBOARD_ENABLED&&(window.onkeydown=t);this.Xb=this.Qb=this.tb=u;Je(this);this.Me=new D.m(0,0,0);a.preventDefault()};w.Fj=aa();w.Yj=function(a){a.preventDefault();a.Aa(a.ob.targetTouches[0],a.currentTarget);eval("this.onTouchStart("+a.clientX+","+a.clientY+")");this.ad=new D.m(a.clientX,a.clientY,0);this.Ig=setTimeout(this.Uj.bind(this,a),500)};w.Xj=aa();
w.Uj=function(a){eval("this.onTouchHover("+a.clientX+","+a.clientY+")");a=new Jd;a.sb=q;a.eb=this instanceof Ke;this.dispatchEvent(a);this.$d=q};w.Tj=aa();function Le(a){clearTimeout(a.Ig);if(a.$d){var b=new Jd;b.sb=u;b.eb=a instanceof Ke;a.dispatchEvent(b)}a.$d=u}w.Sj=function(a){a.preventDefault();eval("this.onTouchEnd()");Le(this)};w.Rj=aa();
w.Wj=function(a){a.preventDefault();this.$d||Le(this);this.touchmoveEvent=a=a.ob;eval("this.onTouchMove(this['touchmoveEvent'])");var b=a.targetTouches;if(1==b.length){a=b[0];var c=[a.clientX,a.clientY];a=new D.m(c[0],c[1],0);var b=c[0]>3*this.Na.clientWidth/4,e=c[0]<this.Na.clientWidth/4,d=c[1]<this.Na.clientHeight/4,c=c[1]>3*this.Na.clientHeight/4,c=!b&&!e&&!d&&!c,d=this.ad.va(a);this.ad=a.l();if(this.$d)a=new Hd,5<d.x?d.x=1:-5>d.x&&(d.x=-1),5<d.y?d.y=1:-5>d.y&&(d.y=-1),a.wa=d,this.dispatchEvent(a);
else if(this instanceof Me&&(b||e))a=new Kd,a.da=0>d.y,this.dispatchEvent(a);else if(this instanceof Ke||c)d.scale(3),a=new Id,a.wa=d,this.dispatchEvent(a)}else 2==b.length&&(a=b[0],b=b[1],a=[a.clientX,a.clientY],b=[b.clientX,b.clientY],a=new D.m(a[0],a[1],0),b=new D.m(b[0],b[1],0),d=Hc(a,b),b=d-this.uh,this.uh=d,this.ad.va(a),this.ad=a.l(),10<Math.abs(b)&&(a=new Jd,a.sb=0<b,a.eb=this instanceof Ke,this.dispatchEvent(a)))};w.Vj=aa();
w.Gj=function(a){this.mousemoveEvent=a;eval("this.onMouseMove(this['mousemoveEvent'])");this.Wd=q;this.S.KEYBOARD_ENABLED&&window.onkeydown==t&&(window.onkeydown=this.Ih.bind(this));a.preventDefault();var b=a.shiftKey;this.Hg=b;this.sa=[a.offsetX,a.offsetY];var c=new D.m(this.sa[0],this.sa[1],0);a=this.Me.va(c);this.Me=c.l();this.S.HOVERING_ENABLED&&((0<Math.abs(a.x)||0<Math.abs(a.y)||this.Qb||this.tb||this.Xb)&&Je(this),this.Td=setTimeout(function(){Je(this);var a=new Ld;a.de=c.x;a.ee=c.y;this.dispatchEvent(a);
this.Td=t}.bind(this),300));0!=a.Hb()&&(this.tb&&!b?(b=new Id,a.scale(3),b.wa=a,this.dispatchEvent(b)):this.Qb||this.tb&&b?(b=new Hd,b.wa=a,this.dispatchEvent(b)):this.Xb&&(b=new Jd,b.sb=0<a.y,b.eb=u,this.dispatchEvent(b)))};function Je(a){a.Td&&clearTimeout(a.Td);a.dispatchEvent(new Md)}w.Kj=aa();w.Hd=function(a){this.mouseWheelEvent=a;eval("this.onMouseWheel(this['mouseWheelEvent'])");Je(this);a.preventDefault()};w.Bj=aa();
w.Ih=function(a){if(this.Wd){this.keyEvent=a;eval("this.onKey(this['keyEvent'])");Je(this);var b=a.altKey,c=a.ctrlKey,e=a.metaKey,d=a.shiftKey,f=a.keyCode;82==f&&!b&&!c&&!e&&!d?(a.preventDefault(),a=new Nd,this.dispatchEvent(a)):37<=f&&40>=f&&(a.preventDefault(),d?a=new Hd:b?a=new Jd:(a=new Id,this instanceof Me&&(a=new Kd)),a&&(c=new D.m(0,0,0),37==f?(c.x=5,a.da=u,b&&(a.da=q,a.sb=q,a.eb=u)):39==f?(c.x=-5,a.da=q,b&&(a.sb=u,a.eb=u)):38==f?(c.y=5,a.da=q,b&&(a.sb=q,a.eb=q)):40==f&&(c.y=-5,a.da=u,b&&
(a.sb=u,a.eb=q)),a.wa=c,this.dispatchEvent(a)))}};B("X.interactor",Ie);B("X.interactor.prototype.init",Ie.prototype.Aa);B("X.interactor.prototype.onMouseDown",Ie.prototype.Dj);B("X.interactor.prototype.onMouseUp",Ie.prototype.Ij);B("X.interactor.prototype.onMouseMove",Ie.prototype.Fj);B("X.interactor.prototype.onMouseWheel",Ie.prototype.Kj);B("X.interactor.prototype.onKey",Ie.prototype.Bj);B("X.interactor.prototype.onTouchStart",Ie.prototype.Xj);B("X.interactor.prototype.onTouchMove",Ie.prototype.Vj);
B("X.interactor.prototype.onTouchEnd",Ie.prototype.Rj);B("X.interactor.prototype.onTouchHover",Ie.prototype.Tj);function Me(a){Ie.call(this,a);this.f="interactor2D"}C(Me,Ie);Me.prototype.Hd=function(a){Me.B.Hd.call(this,a);var b=new Kd;a.Uc==t&&(a.Uc=0);b.da=0>a.Uc;this.dispatchEvent(b)};function Ne(a,b){(!x(a)||!x(b))&&n(Error("A camera needs valid width and height values."));K.call(this);this.f="camera";this.gc=new D.m(0,100,0);this.Ac=new D.m(0,0,0);this.da=new D.m(0,0,1);this.G=a;this.v=b;this.o=this.ue(this.gc,this.Ac)}C(Ne,K);Ne.prototype.observe=function(a){(a==t||!(a instanceof Ie))&&n(Error("Could not observe the interactor."));I(a,td,this.Oj.bind(this));I(a,sd,this.Lj.bind(this));I(a,ud,this.ak.bind(this))};
Ne.prototype.Oj=function(a){a instanceof Id||n(Error("Received no valid rotate event."));this.rotate(a.wa)};Ne.prototype.ak=function(a){a instanceof Jd||n(Error("Received no valid zoom event."));a.sb?this.kg(a.eb):this.lg(a.eb)};Ne.prototype.Lj=function(a){a instanceof Hd||n(Error("Received no valid pan event."));this.Lf(a.wa)};Ne.prototype.__defineGetter__("view",v("o"));
Ne.prototype.__defineSetter__("view",function(a){(a==t||!(a instanceof Float32Array))&&n(Error("Invalid view matrix."));this.o=a});Ne.prototype.__defineGetter__("position",function(){return[this.gc.x,this.gc.y,this.gc.d]});Ne.prototype.__defineSetter__("position",function(a){(a==t||!ka(a)||3!=a.length)&&n(Error("Invalid position."));this.gc=new D.m(a[0],a[1],a[2]);this.reset()});Ne.prototype.__defineGetter__("focus",function(){return[this.Ac.x,this.Ac.y,this.Ac.d]});
Ne.prototype.__defineSetter__("focus",function(a){(a==t||!ka(a)||3!=a.length)&&n(Error("Invalid focus"));this.Ac=new D.m(a[0],a[1],a[2]);this.reset()});Ne.prototype.__defineGetter__("up",function(){return[this.da.x,this.da.y,this.da.d]});Ne.prototype.__defineSetter__("up",function(a){(a==t||!ka(a)||3!=a.length)&&n(Error("Invalid up vector."));this.da=new D.m(a[0],a[1],a[2]);this.reset()});w=Ne.prototype;w.reset=function(){this.o=this.ue(this.gc,this.Ac)};
w.rotate=function(a){ka(a)&&2==a.length?a=new D.m(a[0],a[1],0):a instanceof D.m||n(Error("Invalid distance vector for rotate operation."));return a};w.Lf=function(a){ka(a)&&2==a.length?a=new D.m(a[0],a[1],0):a instanceof D.m||n(Error("Invalid distance vector for pan operation."));this.o[12]-=a.x;this.o[13]+=a.y};w.kg=function(a){var b=20;a!=t&&!a&&(b=1);this.o[14]+=b};w.lg=function(a){var b=20;a!=t&&!a&&(b=1);this.o[14]-=b};
w.ue=function(a,b){(!(a instanceof D.m)||!(b instanceof D.m))&&n(Error("3D vectors required for calculating the view."));return D.g.Bd()};B("X.camera",Ne);B("X.camera.prototype.pan",Ne.prototype.Lf);B("X.camera.prototype.rotate",Ne.prototype.rotate);B("X.camera.prototype.zoomIn",Ne.prototype.kg);B("X.camera.prototype.zoomOut",Ne.prototype.lg);function Oe(a,b){Ne.call(this,a,b);this.f="camera3D";this.pg=45;this.Ve=D.g.yf(D.g.Bd(),this.pg,a/b,1,1E4)}C(Oe,Ne);Oe.prototype.rotate=function(a){a=Oe.B.rotate.call(this,a);var b=-a.x/5*Math.PI/180;a=-a.y/5*Math.PI/180;var c=new D.m(this.o[1],this.o[5],this.o[9]),e=new D.m(this.o[0],this.o[4],this.o[8]);c.normalize();e.normalize();D.g.rotate(this.o,b,c.x,c.y,c.d);D.g.rotate(this.o,a,e.x,e.y,e.d)};Oe.prototype.ue=function(a,b){var c=Oe.B.ue.call(this,a,b);D.g.xh(c,a,b,this.da);return c};
function Pe(a,b,c,e){var d=new Float32Array(4),f=new Float32Array(4),g=new Float32Array(16),h=new Float32Array(16);new Float32Array(16);D.g.multiply(a.Ve,a.o,h);D.g.Y(h,g);d[0]=b;d[1]=c;d[2]=2*e-1;d[3]=1;D.g.Bh(g,d,f);f[3]=1/f[3];f[0]*=f[3];f[1]*=f[3];f[2]*=f[3];return f}B("X.camera3D",Oe);function Qe(){K.call(this);this.f="parser";this.O=t;this.D=0;this.yi=0<(new Int8Array((new Int16Array([1])).buffer))[0];this.Ic=q;this.ql=-Infinity;this.pl=Infinity}C(Qe,K);Qe.prototype.parse=function(){n(Error("The function parse() should be overloaded."))};function Re(a){for(var b=Infinity,c=-Infinity,e=a.length,d=0,d=0;d<e;d++)if(!isNaN(a[d]))var f=a[d],b=Math.min(b,f),c=Math.max(c,f);return[b,c]}
function Se(a,b,c){b===p&&(b=0);c===p&&(c=a.length);for(var e="",d=0,d=b;d<c;++d)e+=String.fromCharCode(a[d]);return e}
function W(a,b,c){c!=t||(c=1);var e=1,d=Uint8Array;switch(b){case "schar":d=Int8Array;break;case "ushort":d=Uint16Array;e=2;break;case "sshort":d=Int16Array;e=2;break;case "uint":d=Uint32Array;e=4;break;case "sint":d=Int32Array;e=4;break;case "float":d=Float32Array;e=4;break;case "complex":d=Float64Array;e=8;break;case "double":d=Float64Array,e=8}b=new d(a.O.slice(a.D,a.D+=c*e));if(a.yi!=a.Ic){a=b;b=new Uint8Array(a.buffer,a.byteOffset,a.byteLength);for(d=0;d<a.byteLength;d+=e)for(var f=d+e-1,g=d;f>
g;f--,g++){var h=b[g];b[g]=b[f];b[f]=h}b=a}return 1==c?b[0]:b}
function Te(a,b){var c=[Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,-Number.MAX_VALUE],e=Rc(0,0,0,1),d=Qc();cd(a,e,d);c[0]=d[0]<c[0]?d[0]:c[0];c[1]=d[0]>c[1]?d[0]:c[1];c[2]=d[1]<c[2]?d[1]:c[2];c[3]=d[1]>c[3]?d[1]:c[3];c[4]=d[2]<c[4]?d[2]:c[4];c[5]=d[2]>c[5]?d[2]:c[5];e=Rc(0,0,b[2]-1,1);cd(a,e,d);c[0]=d[0]<c[0]?d[0]:c[0];c[1]=d[0]>c[1]?d[0]:c[1];c[2]=d[1]<c[2]?d[1]:c[2];c[3]=d[1]>c[3]?d[1]:c[3];c[4]=d[2]<c[4]?d[2]:c[4];c[5]=d[2]>c[5]?d[2]:c[5];e=Rc(0,b[1]-
1,0,1);cd(a,e,d);c[0]=d[0]<c[0]?d[0]:c[0];c[1]=d[0]>c[1]?d[0]:c[1];c[2]=d[1]<c[2]?d[1]:c[2];c[3]=d[1]>c[3]?d[1]:c[3];c[4]=d[2]<c[4]?d[2]:c[4];c[5]=d[2]>c[5]?d[2]:c[5];e=Rc(b[0]-1,0,0,1);cd(a,e,d);c[0]=d[0]<c[0]?d[0]:c[0];c[1]=d[0]>c[1]?d[0]:c[1];c[2]=d[1]<c[2]?d[1]:c[2];c[3]=d[1]>c[3]?d[1]:c[3];c[4]=d[2]<c[4]?d[2]:c[4];c[5]=d[2]>c[5]?d[2]:c[5];e=Rc(b[0]-1,b[1]-1,0,1);cd(a,e,d);c[0]=d[0]<c[0]?d[0]:c[0];c[1]=d[0]>c[1]?d[0]:c[1];c[2]=d[1]<c[2]?d[1]:c[2];c[3]=d[1]>c[3]?d[1]:c[3];c[4]=d[2]<c[4]?d[2]:c[4];
c[5]=d[2]>c[5]?d[2]:c[5];e=Rc(b[0]-1,0,b[2]-1,1);cd(a,e,d);c[0]=d[0]<c[0]?d[0]:c[0];c[1]=d[0]>c[1]?d[0]:c[1];c[2]=d[1]<c[2]?d[1]:c[2];c[3]=d[1]>c[3]?d[1]:c[3];c[4]=d[2]<c[4]?d[2]:c[4];c[5]=d[2]>c[5]?d[2]:c[5];e=Rc(0,b[1]-1,b[2]-1,1);cd(a,e,d);c[0]=d[0]<c[0]?d[0]:c[0];c[1]=d[0]>c[1]?d[0]:c[1];c[2]=d[1]<c[2]?d[1]:c[2];c[3]=d[1]>c[3]?d[1]:c[3];c[4]=d[2]<c[4]?d[2]:c[4];c[5]=d[2]>c[5]?d[2]:c[5];e=Rc(b[0]-1,b[1]-1,b[2]-1,1);cd(a,e,d);c[0]=d[0]<c[0]?d[0]:c[0];c[1]=d[0]>c[1]?d[0]:c[1];c[2]=d[1]<c[2]?d[1]:
c[2];c[3]=d[1]>c[3]?d[1]:c[3];c[4]=d[2]<c[4]?d[2]:c[4];c[5]=d[2]>c[5]?d[2]:c[5];return c}
function Ue(a,b){var c=Tc();if(!(a.length==b.length&&a[0]==b[0]&&a[1]==b[1]&&a[2]==b[2])){var e=Math.acos(a[2]),d=Nc(),f=a[0],g=a[1],h=a[2],l=b[0],j=b[1],k=b[2];d[0]=g*k-h*j;d[1]=h*l-f*k;d[2]=f*j-g*l;Pc(d,d);f=Math.cos(e/2);g=Math.sin(e/2)*d[0];h=Math.sin(e/2)*d[1];e=Math.sin(e/2)*d[2];S(c,0,f*f+g*g-h*h-e*e,2*(g*h-f*e),2*(g*e+f*h),0);S(c,1,2*(g*h+f*e),f*f+h*h-g*g-e*e,2*(h*e-f*g),0);S(c,2,2*(g*e-f*h),2*(h*e+f*g),f*f+e*e-h*h-g*g,0)}e=Sc();$c(c,e);return[c,e]}
function Ve(a,b,c,e,d,f,g,h,l){var j=new We;Pc(c,c);for(var k=[],m=[],r=0;6>r;r++)for(var s=Math.floor(r/2),y=(s+1)%3,z=(s+2)%3,F=(4+2*s)%6,G=0;2>G;G++){var J=(2+G+2*s)%6,A=-(c[s]*(d[r]-a[s])+c[y]*(d[J]-a[y]))/c[z]+a[z];if(A>=d[F]&&A<=d[F+1]||A<=d[F]&&A>=d[F+1]){var E=[];E[s]=d[r];E[y]=d[J];E[z]=A;k.push(E)}else E=[],E[s]=d[r],E[y]=d[J],E[z]=A,m.push(E)}a=Oc(0,0,1);a=Ue(c,a);d=a[0];a=a[1];s=[];for(m=0;m<k.length;++m)r=Rc(k[m][0],k[m][1],k[m][2],1),y=Qc(),cd(d,r,y),s.push([y[0],y[1],y[2]]);d=Oc(1,
0,0);k=Nc();ad(a,d,k);m=Oc(0,1,0);d=Nc();ad(a,m,d);r=[Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,-Number.MAX_VALUE];for(m=m=0;m<s.length;++m)s[m][0]<r[0]&&(r[0]=s[m][0]),s[m][0]>r[1]&&(r[1]=s[m][0]),s[m][1]<r[2]&&(r[2]=s[m][1]),s[m][1]>r[3]&&(r[3]=s[m][1]),s[m][2]<r[4]&&(r[4]=s[m][2]),s[m][2]>r[5]&&(r[5]=s[m][2]);m=Rc(r[0]+(r[1]-r[0])/2,r[2]+(r[3]-r[2])/2,r[4]+(r[5]-r[4])/2,0);s=Qc();Zc(a,m,s);y=Math.floor(r[0]);z=Math.ceil(r[1]);y==z&&z++;F=z-y;G=Math.floor(r[2]);
J=Math.ceil(r[3]);G==J&&J++;A=J-G;E=b[0];b=b[1];var m=Math.ceil(F/E),L=Math.ceil(A/b),O=new Uint8Array(4*m*L),R=new gd;R.Xe=m;R.We=L;var L=Qc(),P=Rc(0,0,r[4],1),U=Sc();Zc(g.pi,a,U);for(var ca=J-1E-7,da=z-1E-7,M=0,oa=0,H=0,Oa=G,Oa=G;Oa<=ca;Oa+=b){H++;oa=0;P[1]=Oa;for(m=y;m<=da;m+=E){oa++;P[0]=m;cd(U,P,L);var Fa=4*M,vb=Math.floor(L[2]),wb=Math.floor(L[1]),xb=Math.floor(L[0]);if(0<=xb&&xb<g.ba[0]&&0<=wb&&wb<g.ba[1]&&0<=vb&&vb<g.ba[2]){var nb=f[vb][wb][xb],bd=xb=wb=vb=0;l?((nb=l.get(nb))||(nb=[0,0.61,
0,0,1]),vb=255*nb[1],wb=255*nb[2],xb=255*nb[3],bd=255*nb[4]):(vb=wb=xb=255*(nb/g.ja),bd=255);O[Fa]=vb;O[++Fa]=wb;O[++Fa]=xb;O[++Fa]=bd}else O[Fa]=0,O[++Fa]=0,O[++Fa]=0,O[++Fa]=0;M++}}R.Wb=O;j.H=R;j.Ei=r;j.ri=a;j.qi=U;j.xi=G;j.nl=J;j.Di=y;j.sl=z;j.ug=oa;j.tg=H;j.Sc=E;j.G=F;j.Cc=b;j.v=A;j.C=[s[0],s[1],s[2]];j.Bc=[c[0],c[1],c[2]];j.Zd=[k[0],k[1],k[2]];j.da=[d[0],d[1],d[2]];j.P=u;j.Eb=g;j.zb=g.Eb!=t&&!h?u:q;j.xc=e;j.Fb();j.P=u;return j}
function Xe(a,b,c,e){var d;d=e.oa;for(var f=[],g=[],h=0;6>h;h++){var l=Math.floor(h/2),j=(l+1)%3,k=(l+2)%3,m=(2+2*l)%6,r=(4+2*l)%6,s=(d[h]-b[l])*(1/c[l]);if(Infinity!=s&&-Infinity!=s){var y=b[j]+c[j]*s,s=b[k]+c[k]*s;y>=d[m]&&y<=d[m+1]&&s>=d[r]&&s<=d[r+1]?(m=[],m[l]=d[h],m[j]=y,m[k]=s,f.push(m)):(m=[],m[l]=d[h],m[j]=y,m[k]=s,g.push(m))}}d=[f,g];b=d[0];e.b[a].k=d;d=Gc(new Q(b[0][0],b[0][1],b[0][2]),new Q(b[1][0],b[1][1],b[1][2]));e.b[a].ml=d;f=Oc(0,0,1);g=Ue(c,f)[0];h=Rc(e.Ie[0],e.Ie[1],e.Ie[2],0);
f=Qc();cd(g,h,f);g=Qc();h=f[2];g[0]=c[0]*h;g[1]=c[1]*h;g[2]=c[2]*h;g[3]=c[3]*h;0.5>Math.abs(f[0])&&(f[0]=0.5);0.5>Math.abs(f[1])&&(f[1]=0.5);e.b[a].Fa=[Math.abs(f[0]),Math.abs(f[1])];e.b[a].Nc=f[2];e.b[a].z=g;d=Math.floor(Math.abs(d/f[2]));e.od[a]=d+1;e.b[a].p=d+1;e.b[a].k[0][0][0]>e.b[a].k[0][1][0]?0<g[0]&&(d=e.b[a].k[0][0],e.b[a].k[0][0]=e.b[a].k[0][1],e.b[a].k[0][1]=d):e.b[a].k[0][0][0]<e.b[a].k[0][1][0]?0>g[0]&&(d=e.b[a].k[0][0],e.b[a].k[0][0]=e.b[a].k[0][1],e.b[a].k[0][1]=d):e.b[a].k[0][0][1]>
e.b[a].k[0][1][1]?0<g[1]&&(d=e.b[a].k[0][0],e.b[a].k[0][0]=e.b[a].k[0][1],e.b[a].k[0][1]=d):e.b[a].k[0][0][1]<e.b[a].k[0][1][1]?0>g[1]&&(d=e.b[a].k[0][0],e.b[a].k[0][0]=e.b[a].k[0][1],e.b[a].k[0][1]=d):e.b[a].k[0][0][2]>e.b[a].k[0][1][2]?0<g[2]&&(d=e.b[a].k[0][0],e.b[a].k[0][0]=e.b[a].k[0][1],e.b[a].k[0][1]=d):e.b[a].k[0][0][2]<e.b[a].k[0][1][2]&&0>g[2]&&(d=e.b[a].k[0][0],e.b[a].k[0][0]=e.b[a].k[0][1],e.b[a].k[0][1]=d);e.b[a].Te=-(c[0]*b[0][0]+c[1]*b[0][1]+c[2]*b[0][2])}
function Ye(a,b){var c;c=b.O;for(var e=b.ba,d=b.ja,f=b.Ja,g=Array(e[2]),h=Array(e[2]),l=e[1]*e[0],j=0,k=0,m=0,r=0,s=0,r=0;r<e[2];r++){var y=c.subarray(r*l,(r+1)*l),s=0;h[r]=Array(e[1]);g[r]=Array(e[1]);for(m=0;m<e[1];m++){h[r][m]=new c.constructor(e[0]);g[r][m]=new c.constructor(e[0]);for(k=0;k<e[0];k++)j=y[s],h[r][m][k]=255*((j-f)/(d-f)),g[r][m][k]=j,s++}}c=[g,h];b.ia=c[0];b.kl=c[1];D.Ha(a.f+".reslice");b.L=b.e!=t;b.Da&&(b.Zc=b.Da.Ia);b.Ql=[0,0,0];b.t=[b.Ca[0]+(b.yb[0]-1)/2,b.Ca[1]+(b.yb[1]-1)/2,
b.Ca[2]+(b.yb[2]-1)/2];b.oa=[Math.min(b.Ca[0],b.Ca[0]+b.yb[0]-1),Math.max(b.Ca[0],b.Ca[0]+b.yb[0]-1),Math.min(b.Ca[1],b.Ca[1]+b.yb[1]-1),Math.max(b.Ca[1],b.Ca[1]+b.yb[1]-1),Math.min(b.Ca[2],b.Ca[2]+b.yb[2]-1),Math.max(b.Ca[2],b.Ca[2]+b.yb[2]-1)];b.b=[{},{},{}];c=Oc(b.t[0],b.t[1],b.t[2]);b.b[0].pd=c;e=Oc(1,0,0);Pc(e,e);b.b[0].i=e;d=[1,0,0];b.b[0].w=d;Xe(0,c,e,b);b.c[0].c=Array(b.b[0].p);c[0]=b.b[0].k[0][0][0]+b.b[0].z[0]*Math.floor(b.b[0].p/2);c[1]=b.b[0].k[0][0][1]+b.b[0].z[1]*Math.floor(b.b[0].p/
2);c[2]=b.b[0].k[0][0][2]+b.b[0].z[2]*Math.floor(b.b[0].p/2);c=Ve(c,b.b[0].Fa,b.b[0].i,b.b[0].w,b.oa,b.ia,b,b.L,b.Zc);b.L&&(c.e=b.e.c[0].c[Math.floor(b.b[0].p/2)].H);b.c[0].c[Math.floor(b.b[0].p/2)]=c;b.Ab=Math.floor(b.b[0].p/2);b.Dc=Math.floor(b.b[0].p/2);c=Oc(b.t[0],b.t[1],b.t[2]);b.b[1].pd=c;e=Oc(0,1,0);Pc(e,e);b.b[1].i=e;d=[0,1,0];b.b[1].w=d;Xe(1,c,e,b);b.c[1].c=Array(b.b[1].p);c[0]=b.b[1].k[0][0][0]+b.b[1].z[0]*Math.floor(b.b[1].p/2);c[1]=b.b[1].k[0][0][1]+b.b[1].z[1]*Math.floor(b.b[1].p/2);
c[2]=b.b[1].k[0][0][2]+b.b[1].z[2]*Math.floor(b.b[1].p/2);c=Ve(c,b.b[1].Fa,b.b[1].i,b.b[1].w,b.oa,b.ia,b,b.L,b.Zc);b.L&&(c.e=b.e.c[1].c[Math.floor(b.b[1].p/2)].H);b.c[1].c[Math.floor(b.b[1].p/2)]=c;b.Bb=Math.floor(b.b[1].p/2);b.Ec=Math.floor(b.b[1].p/2);c=Oc(b.t[0],b.t[1],b.t[2]);b.b[2].pd=c;e=Oc(0,0,1);Pc(e,e);b.b[2].i=e;d=[0,0.392,0.804];b.b[2].w=d;Xe(2,c,e,b);b.c[2].c=Array(b.b[2].p);c[0]=b.b[2].k[0][0][0]+b.b[2].z[0]*Math.floor(b.b[2].p/2);c[1]=b.b[2].k[0][0][1]+b.b[2].z[1]*Math.floor(b.b[2].p/
2);c[2]=b.b[2].k[0][0][2]+b.b[2].z[2]*Math.floor(b.b[2].p/2);c=Ve(c,b.b[2].Fa,b.b[2].i,b.b[2].w,b.oa,b.ia,b,b.L,b.Zc);b.L&&(c.e=b.e.c[2].c[Math.floor(b.b[2].p/2)].H);b.c[2].c[Math.floor(b.b[2].p/2)]=c;b.Cb=Math.floor(b.b[2].p/2);b.Fc=Math.floor(b.b[2].p/2);D.Ba(a.f+".reslice");return b.ia};function af(){Qe.call(this);this.f="parserIMAGE"}C(af,Qe);af.prototype.parse=function(a,b,c,e){c instanceof ArrayBuffer||n(Error());for(var d=new Uint8Array(c),f=d.length,g=Array(f);f--;)g[f]=String.fromCharCode(d[f]);d=window.btoa(g.join(""));f=new Image;bc(f,"load",this.ck.bind(this,f,a,b,c,e));f.src="data:image/"+e+";base64,"+d};af.prototype.ck=function(a,b,c){b.rb=a;b.Wb=t;a=new ld;a.F=c;a.u=b;this.dispatchEvent(a)};B("X.parserIMAGE",af);B("X.parserIMAGE.prototype.parse",af.prototype.parse);function bf(a,b){Ne.call(this,a,b);this.f="camera2D"}C(bf,Ne);bf.prototype.rotate=function(a){a=bf.B.rotate.call(this,a);var b=new Gd;0<a.x?b.cf--:0>a.x&&b.cf++;0<a.y?b.Qe++:0>a.y&&b.Qe--;this.dispatchEvent(b)};bf.prototype.kg=function(a){var b=20;a!=t&&!a&&(b=0.02);this.o[14]+=b};bf.prototype.lg=function(a){var b=20;a!=t&&!a&&(b=0.02);this.o[14]-=b};
bf.prototype.Lf=function(a){ka(a)&&2==a.length?a=new D.m(a[0],a[1],0):a instanceof D.m||n(Error("Invalid distance vector for pan operation."));this.o[12]-=a.x/this.o[14];this.o[13]+=a.y/this.o[14]};function cf(){K.call(this);this.f="shaders";this.ae="";var a;a="precision mediump float;\n\n";a+="attribute vec3 vertexPosition;\n";a+="attribute vec3 vertexNormal;\n";a+="attribute vec3 vertexColor;\n";a+="attribute vec2 vertexTexturePos;\n";a+="attribute float vertexScalar;\n";a+="\n";a+="uniform mat4 view;\n";a+="uniform mat4 perspective;\n";a+="uniform vec3 center;\n";a+="uniform mat4 objectTransform;\n";a+="uniform bool useObjectColor;\n";a+="uniform bool useScalars;\n";a+="uniform bool scalarsReplaceMode;\n";
a+="uniform float scalarsMin;\n";a+="uniform float scalarsMax;\n";a+="uniform vec3 scalarsMinColor;\n";a+="uniform vec3 scalarsMaxColor;\n";a+="uniform float scalarsMinThreshold;\n";a+="uniform float scalarsMaxThreshold;\n";a+="uniform int scalarsInterpolation;\n";a+="uniform vec3 objectColor;\n";a+="uniform float pointSize;\n";a+="\n";a+="varying float fDiscardNow;\n";a+="varying vec4 fVertexPosition;\n";a+="varying vec3 fragmentColor;\n";a+="varying vec2 fragmentTexturePos;\n";a+="varying vec3 fVertexNormal;\n";
a+="varying vec3 fTransformedVertexNormal;\n";a+="\n";a+="void main(void) {\n";a+="  fTransformedVertexNormal = mat3(view[0].xyz,view[1].xyz,view[2].xyz) * ";a+="mat3(objectTransform[0].xyz,objectTransform[1].xyz,objectTransform[2].xyz) * ";a+="vertexNormal;\n";a+="  fVertexNormal = vertexNormal;\n";a+="  fDiscardNow = 0.0;\n";a+="  vec3 vertexPosition2 = vertexPosition - center;\n";a+="  fVertexPosition = view * objectTransform * vec4(vertexPosition2, 1.0);\n";a+="  fragmentTexturePos = vertexTexturePos;\n";
a+="  if (useScalars) {\n";a+="    float scalarValue = vertexScalar;\n";a+="    if (scalarValue < scalarsMinThreshold || scalarValue > scalarsMaxThreshold) {\n";a+="      if (scalarsReplaceMode) {\n";a+="        fragmentColor = objectColor;\n";a+="      } else {\n";a+="        fDiscardNow = 1.0;\n";a+="      }\n";a+="    } else {\n";a+="      if (scalarsReplaceMode) {\n";a+="        if (scalarsInterpolation == 1) {\n";a+="            vec3 zeroMaxColor;\n";a+="            vec3 zeroMinColor;\n";a+=
"            zeroMaxColor[0] = scalarsMaxColor[0]*0.33;\n";a+="            zeroMaxColor[1] = scalarsMaxColor[1]*0.33;\n";a+="            zeroMaxColor[2] = scalarsMaxColor[2]*0.33;\n";a+="            zeroMinColor[0] = scalarsMinColor[0]*0.33;\n";a+="            zeroMinColor[1] = scalarsMinColor[1]*0.33;\n";a+="            zeroMinColor[2] = scalarsMinColor[2]*0.33;\n";a+="            if(scalarValue < 0.0) {fragmentColor = scalarValue/(scalarsMin) * scalarsMinColor + (1.0 - scalarValue/(scalarsMin)) * (zeroMinColor);}\n";
a+="            else {fragmentColor = scalarValue/(scalarsMax) * scalarsMaxColor + (1.0 - scalarValue/(scalarsMax)) * (zeroMaxColor);}\n";a+="        } else {\n";a+="            fragmentColor = scalarValue * scalarsMaxColor + (1.0 - scalarValue) * scalarsMinColor;\n";a+="          }\n";a+="      } else {\n";a+="        fragmentColor = vertexColor;\n";a+="      }\n";a+="    }\n";a+="  } else if (useObjectColor) {\n";a+="    fragmentColor = objectColor;\n";a+="  } else {\n";a+="    fragmentColor = vertexColor;\n";
a+="  }\n";a+="  gl_PointSize = pointSize;\n";a+="  gl_Position = perspective * fVertexPosition;\n";this.ae=a+="}\n";this.Rd="";a="precision mediump float;\n\n";a+="uniform bool usePicking;\n";a+="uniform bool useTexture;\n";a+="uniform bool volumeTexture;\n";a+="uniform bool useLabelMapTexture;\n";a+="uniform sampler2D textureSampler;\n";a+="uniform sampler2D textureSampler2;\n";a+="uniform float objectOpacity;\n";a+="uniform float labelmapOpacity;\n";a+="uniform vec4 labelmapColor;\n";a+="uniform float volumeLowerThreshold;\n";
a+="uniform float volumeUpperThreshold;\n";a+="uniform float volumeScalarMin;\n";a+="uniform float volumeScalarMax;\n";a+="uniform vec3 volumeScalarMinColor;\n";a+="uniform vec3 volumeScalarMaxColor;\n";a+="uniform float volumeWindowLow;\n";a+="uniform float volumeWindowHigh;\n";a+="\n";a+="varying float fDiscardNow;\n";a+="varying vec4 fVertexPosition;\n";a+="varying vec3 fragmentColor;\n";a+="varying vec2 fragmentTexturePos;\n";a+="varying vec3 fVertexNormal;\n";a+="varying vec3 fTransformedVertexNormal;\n";
a+="\n";a+="void main(void) {\n";a+=" if (fDiscardNow > 0.0) {\n";a+="   discard;\n";a+=" }\n";a+=" if (usePicking) {\n";a+="   gl_FragColor = vec4(fragmentColor, 1.0);\n";a+=" } else if (useTexture) {\n";a+="   vec4 texture1 = texture2D(textureSampler,fragmentTexturePos);\n";a+="   vec4 textureSum = texture1;\n";a+="   if (volumeTexture) {\n";a+="     float _windowLow = (volumeWindowLow / volumeScalarMax);\n";a+="     float _windowHigh = (volumeWindowHigh / volumeScalarMax);\n";a+="     vec3 _minrange = vec3(_windowLow,_windowLow,_windowLow);\n";
a+="     vec3 _maxrange = vec3(_windowHigh,_windowHigh,_windowHigh);\n";a+="     vec3 fac = _maxrange - _minrange;\n";a+="     textureSum = vec4((textureSum.r - _minrange)/fac,1);\n";a+="     textureSum = textureSum.r * vec4(volumeScalarMaxColor,1) + (1.0 - textureSum.r) * vec4(volumeScalarMinColor,1);\n";a+="   }\n";a+="   if (useLabelMapTexture) {\n";a+="     vec4 texture2 = texture2D(textureSampler2,fragmentTexturePos);\n";a+="     if (texture2.a > 0.0) {\n";a+="         if (labelmapColor.a != -255.0) {\n";
a+="           if (all(equal(floor(texture2 * vec4(255)), labelmapColor))) {\n";a+="             if (labelmapOpacity < 1.0) {\n";a+="               textureSum = mix(texture2, textureSum, 1.0 - labelmapOpacity);\n";a+="             } else {\n";a+="               textureSum = texture2;\n";a+="             }\n";a+="           }\n";a+="         } else {\n";a+="           if (labelmapOpacity < 1.0) {\n";a+="             textureSum = mix(texture2, textureSum, 1.0 - labelmapOpacity);\n";a+="           } else {\n";
a+="             textureSum = texture2;\n";a+="           }\n";a+="         }\n";a+="     }\n";a+="   }\n";a+="   if (volumeTexture) {\n";a+="     float _volumeLowerThreshold = (volumeLowerThreshold / volumeScalarMax);\n";a+="     float _volumeUpperThreshold = (volumeUpperThreshold / volumeScalarMax);\n";a+="     if (texture1.r < _volumeLowerThreshold ||\n";a+="         texture1.r > _volumeUpperThreshold ||\n";a+="         texture1.a == 0.0 ) {\n";a+="       discard;\n";a+="     };\n";a+="   };\n";
a+="   gl_FragColor = textureSum;\n";a+="   gl_FragColor.a = objectOpacity;\n";a+=" } else {\n";a+="   vec3 nNormal = normalize(fTransformedVertexNormal);\n";a+="   if (fVertexNormal == vec3(0.0,0.0,0.0)) {\n";a+="     gl_FragColor = vec4(fragmentColor,1.0);\n";a+="     return;\n";a+="   }\n";a+="   vec3 light = vec3(0.0, 0.0, 1.0);\n";a+="   vec3 lightDirection = vec3(0,0,-10);\n";a+="   lightDirection = normalize(lightDirection);\n";a+="   vec3 eyeDirection = normalize(-fVertexPosition.xyz);\n";
a+="   vec3 reflectionDirection = reflect(-lightDirection, nNormal);\n";a+="   float specular = pow(max(dot(reflectionDirection, eyeDirection), 0.0), 10.0);\n";a+="   float diffuse = 0.8 * max(dot(nNormal, light), 0.0);\n";a+="   float ambient = 0.3;\n";a+="   gl_FragColor = vec4(fragmentColor * ambient +\n";a+="                       fragmentColor * diffuse +\n";a+="                       vec3(0.2, 0.2, 0.2) * specular,\n";a+="                       objectOpacity);\n";a+=" }\n";this.Rd=a+="}\n"}
C(cf,K);
var df={Yk:"vertexPosition",Xk:"vertexNormal",Wk:"vertexColor",$k:"vertexTexturePos",Zk:"vertexScalar"},ef={al:"view",Fk:"perspective",wk:"center",Ek:"objectTransform",Sk:"useObjectColor",Ck:"objectColor",Uk:"useScalars",Ok:"scalarsReplaceMode",Lk:"scalarsMin",Ik:"scalarsMax",Mk:"scalarsMinColor",Jk:"scalarsMaxColor",Nk:"scalarsMinThreshold",Kk:"scalarsMaxThreshold",Hk:"scalarsInterpolation",Gk:"pointSize",Dk:"objectOpacity",Bk:"normal",Tk:"usePicking",Vk:"useTexture",Rk:"useLabelMapTexture",zk:"labelmapOpacity",
yk:"labelmapColor",Pk:"textureSampler",Qk:"textureSampler2",bl:"volumeLowerThreshold",hl:"volumeUpperThreshold",el:"volumeScalarMin",cl:"volumeScalarMax",fl:"volumeScalarMinColor",dl:"volumeScalarMaxColor",jl:"volumeWindowLow",il:"volumeWindowHigh",gl:"volumeTexture"};function We(a){V.call(this);this.f="slice";this.C=[0,0,0];this.Bc=[0,0,1];this.da=[0,1,0];this.Zd=[1,0,0];this.v=this.G=10;this.Qc=[0,1,0,0,1,1,1,1,1,0,0,0];this.e=this.Eb=t;this.zb=q;this.xc=[1,1,1];a!=t&&this.lc(a)}C(We,V);We.prototype.lc=function(a){this.C=a.C.slice();this.Bc=a.Bc.slice();this.da=a.da.slice();this.G=a.G;this.v=a.v;this.Eb=a.Eb;this.e=a.e;this.zb=a.zb;this.xc=a.xc;this.wi=a.wi;We.B.lc.call(this,a)};We.prototype.__defineSetter__("height",ba("v"));
We.prototype.__defineSetter__("width",ba("G"));We.prototype.create=function(){this.Fb()};
We.prototype.Fb=function(){var a=(new Q(this.Bc[0],this.Bc[1],this.Bc[2])).normalize(),b=new Q(this.da[0],this.da[1],this.da[2]),c=new Q(this.Zd[0],this.Zd[1],this.Zd[2]),e=new Q(this.C[0],this.C[1],this.C[2]),d=Ic(c.l().Y().scale(this.G/2),b.l().Y().scale(this.v/2)),f=new Q(d.x+e.x,d.y+e.y,d.d+e.d),d=Ic(c.l().Y().scale(this.G/2),b.l().scale(this.v/2)),g=new Q(d.x+e.x,d.y+e.y,d.d+e.d),d=Ic(c.l().scale(this.G/2),b.l().Y().scale(this.v/2)),h=new Q(d.x+e.x,d.y+e.y,d.d+e.d),d=Ic(c.l().scale(this.G/2),
b.l().scale(this.v/2)),b=new Q(d.x+e.x,d.y+e.y,d.d+e.d);this.h=new T(18);this.n=new T(18);this.h.add(f.x,f.y,f.d);this.h.add(g.x,g.y,g.d);this.h.add(h.x,h.y,h.d);this.h.add(h.x,h.y,h.d);this.h.add(b.x,b.y,b.d);this.h.add(g.x,g.y,g.d);this.n.add(a.x,a.y,a.d);this.n.add(a.x,a.y,a.d);this.n.add(a.x,a.y,a.d);this.n.add(a.x,a.y,a.d);this.n.add(a.x,a.y,a.d);this.n.add(a.x,a.y,a.d);this.zb&&(a=new V,a.h=new T(24),a.n=new T(24),a.h.add(f.x,f.y,f.d),a.h.add(g.x,g.y,g.d),a.h.add(g.x,g.y,g.d),a.h.add(b.x,b.y,
b.d),a.h.add(b.x,b.y,b.d),a.h.add(h.x,h.y,h.d),a.h.add(h.x,h.y,h.d),a.h.add(f.x,f.y,f.d),a.n.add(0,0,0),a.n.add(0,0,0),a.n.add(0,0,0),a.n.add(0,0,0),a.n.add(0,0,0),a.n.add(0,0,0),a.n.add(0,0,0),a.n.add(0,0,0),a.w=[this.xc[0],this.xc[1],this.xc[2]],a.Ga="LINES",a.Hc=2,this.c.push(a))};B("X.slice",We);B("X.slice.prototype.create",We.prototype.create);function N(a){V.call(this);this.f="volume";this.C=[0,0,0];this.ba=[10,10,10];this.oa=[1,1,1];this.od=[10,10,10];this.Yb=[1,1,1];this.rb=[];this.Fc=this.Cb=this.Ec=this.Bb=this.Dc=this.Ab=0;this.qd=new V;this.rd=new V;this.sd=new V;this.ce=this.Qa=u;this.X=-1;this.be=[];this.e=t;this.zb=q;this.fa=Infinity;this.ea=-Infinity;this.Gg=q;this.ja=0;this.O=t;Ga(this,new yc);Ga(this,new jd);a!=t&&this.lc(a)}C(N,V);
N.prototype.lc=function(a){this.C=a.C.slice();this.ba=a.ba.slice();this.Yb=a.Yb.slice();this.Ab=a.Ab;this.Dc=a.Dc;this.Bb=a.Bb;this.Ec=a.Ec;this.Cb=a.Cb;this.Fc=a.Fc;this.og=a.og.slice();this.qd=new V(a.qd);this.rd=new V(a.rd);this.sd=new V(a.sd);this.ja=a.ja;this.O=a.O;this.Qa=a.Qa;this.ce=a.ce;this.X=a.X;this.e=a.e;this.zb=a.zb;N.B.lc.call(this,a)};
N.prototype.Fb=function(a){this.c.length=0;this.qd.c.length=0;this.rd.c.length=0;this.sd.c.length=0;this.c.push(this.qd);this.c.push(this.rd);this.c.push(this.sd);this.Ca=a.uc;this.Ie=a.vc;this.yb=a.tc;this.wc=a.ab;this.pi=a.cb;this.ja=a.max;this.O=a.data;this.j=q};
N.prototype.q=function(a){a="undefined"!==typeof a?a:q;if(0<this.c.length){this.Qa!=this.ce&&(!this.Qa&&-1!=this.X&&(this.c[this.X].visible=u),this.j=q,this.ce=this.Qa);if(!this.P)return;for(var b=0,b=0;3>b;b++){var c=this.c[b],e=0,d=0;0==b?(e=this.Ab,d=this.Dc,this.Dc=this.Ab):1==b?(e=this.Bb,d=this.Ec,this.Ec=this.Bb):2==b&&(e=this.Cb,d=this.Fc,this.Fc=this.Cb);if(this.c[b].c[parseInt(e,10)]==t){var f=Nc();f[0]=this.b[b].k[0][0][0]+this.b[b].z[0]*parseInt(e,10);f[1]=this.b[b].k[0][0][1]+this.b[b].z[1]*
parseInt(e,10);f[2]=this.b[b].k[0][0][2]+this.b[b].z[2]*parseInt(e,10);if(this.L){var g=Ve(f,this.b[b].Fa,this.b[b].i,this.b[b].w,this.oa,this.e.ia,this.e,this.e.L,this.e.Da.Ia);this.e.c[b].c[parseInt(e,10)]=g;this.e.c[b].q(q)}f=Ve(f,this.b[b].Fa,this.b[b].i,this.b[b].w,this.oa,this.ia,this,q,t);this.L&&(f.e=f.H,f.e=this.e.c[b].c[parseInt(e,10)].H);c.c[parseInt(e,10)]=f;this.c[b].q(q)}d=c.c[parseInt(d,10)];this.Qa||(d.visible=u);c=c.c[parseInt(e,10)];c.visible=q;c.ta=1;this.Qa&&(c.c[0].P=u,b!=this.X&&
(c.visible=u,c.ta=0))}this.Qa&&-1!=this.X&&ff(this,this.X)}a&&N.B.q.call(this)};N.prototype.__defineGetter__("dimensions",v("ba"));N.prototype.__defineSetter__("dimensions",ba("ba"));N.prototype.__defineGetter__("spacing",v("Yb"));N.prototype.__defineSetter__("spacing",ba("Yb"));N.prototype.__defineGetter__("bbox",v("oa"));N.prototype.__defineGetter__("range",v("od"));N.prototype.__defineGetter__("dimensionsRAS",v("og"));N.prototype.__defineGetter__("volumeRendering",v("Qa"));
N.prototype.__defineSetter__("volumeRendering",function(a){this.Qa=a;this.q(u)});N.prototype.__defineGetter__("visible",v("P"));N.prototype.__defineSetter__("visible",function(a){if(a)this.P=a,this.q(u);else{for(var b=this.c,c=b.length,e=0,e=0;e<c;e++)b[e].visible=a;this.P=a;this.j=q}});N.prototype.__defineGetter__("center",v("C"));N.prototype.__defineSetter__("center",function(a){(a==t||!ka(a)||3!=a.length)&&n(Error("Invalid center."));this.C=a});
N.prototype.__defineGetter__("volumeRenderingCache",v("be"));N.prototype.__defineSetter__("volumeRenderingCache",function(a){(a==t||!ka(a)||!(3>=a.length))&&n(Error("Invalid volumeRederingCache."));this.be=a});N.prototype.__defineGetter__("image",v("rb"));N.prototype.__defineGetter__("labelmap",function(){this.e||(this.e=new gf(this));return this.e});N.prototype.__defineGetter__("indexX",v("Ab"));N.prototype.__defineSetter__("indexX",function(a){x(a)&&(0<=a&&a<this.qd.c.length)&&(this.Ab=a,this.q(u))});
N.prototype.__defineGetter__("indexY",v("Bb"));N.prototype.__defineSetter__("indexY",function(a){x(a)&&(0<=a&&a<this.rd.c.length)&&(this.Bb=a,this.q(u))});N.prototype.__defineGetter__("indexZ",v("Cb"));N.prototype.__defineSetter__("indexZ",function(a){x(a)&&(0<=a&&a<this.sd.c.length)&&(this.Cb=a,this.q(u))});N.prototype.__defineGetter__("windowLow",v("fa"));N.prototype.__defineSetter__("windowLow",ba("fa"));N.prototype.__defineGetter__("windowHigh",v("ea"));
N.prototype.__defineSetter__("windowHigh",ba("ea"));N.prototype.__defineGetter__("borders",v("zb"));N.prototype.__defineSetter__("borders",ba("zb"));N.prototype.__defineGetter__("reslicing",v("Gg"));N.prototype.__defineSetter__("reslicing",ba("Gg"));N.prototype.__defineSetter__("xNormX",function(a){this.b[0].i[0]=a});N.prototype.__defineGetter__("xNormX",function(){return this.b[0].i[0]});N.prototype.__defineSetter__("xNormY",function(a){this.b[0].i[1]=a});N.prototype.__defineGetter__("xNormY",function(){return this.b[0].i[1]});
N.prototype.__defineSetter__("xNormZ",function(a){this.b[0].i[2]=a});N.prototype.__defineGetter__("xNormZ",function(){return this.b[0].i[2]});N.prototype.__defineSetter__("xColor",function(a){this.b[0].w=a});N.prototype.__defineGetter__("xColor",function(){return this.b[0].w});N.prototype.__defineSetter__("yNormX",function(a){this.b[1].i[0]=a});N.prototype.__defineGetter__("yNormX",function(){return this.b[1].i[0]});N.prototype.__defineSetter__("yNormY",function(a){this.b[1].i[1]=a});
N.prototype.__defineGetter__("yNormY",function(){return this.b[1].i[1]});N.prototype.__defineSetter__("yNormZ",function(a){this.b[1].i[2]=a});N.prototype.__defineGetter__("yNormZ",function(){return this.b[1].i[2]});N.prototype.__defineSetter__("yColor",function(a){this.b[1].w=a});N.prototype.__defineGetter__("yColor",function(){return this.b[1].w});N.prototype.__defineSetter__("zNormX",function(a){this.b[2].i[0]=a});N.prototype.__defineGetter__("zNormX",function(){return this.b[2].i[0]});
N.prototype.__defineSetter__("zNormY",function(a){this.b[2].i[1]=a});N.prototype.__defineGetter__("zNormY",function(){return this.b[2].i[1]});N.prototype.__defineSetter__("zNormZ",function(a){this.b[2].i[2]=a});N.prototype.__defineGetter__("zNormZ",function(){return this.b[2].i[2]});N.prototype.__defineSetter__("zColor",function(a){this.b[2].w=a});N.prototype.__defineGetter__("zColor",function(){return this.b[2].w});
N.prototype.kk=function(a){this.c[a].visible=u;for(var b=0;b<this.c[a].c.length;b++)"undefined"!=typeof this.c[a].c[b]&&(this.L&&(this.e.c[a].c[b].remove(),this.e.c[a].c[b]=t),this.c[a].c[b].remove(),this.c[a].c[b]=t);Pc(this.b[a].i,this.b[a].i);Xe(a,this.b[a].pd,this.b[a].i,this);this.c[a].c=[];this.c[a].c=Array(this.b[a].p);this.L&&(b=Ve(this.b[a].pd,this.b[a].Fa,this.b[a].i,this.b[a].w,this.oa,this.e.ia,this.e,this.e.L,this.e.Da.Ia),this.e.c[a].c=[],this.e.c[a].c=Array(this.b[a].p),this.e.c[a].c[Math.floor(this.b[a].p/
2)]=b,this.e.c[a].q());b=Ve(this.b[a].pd,this.b[a].Fa,this.b[a].i,this.b[a].w,this.oa,this.ia,this,q,t);this.L&&(b.e=b.H,b.e=this.e.c[a].c[Math.floor(this.b[a].p/2)].H);this.c[a].c[Math.floor(this.b[a].p/2)]=b;0==a?(this.Ab=Math.floor(this.b[a].p/2),this.Dc=Math.floor(this.b[a].p/2)):1==a?(this.Bb=Math.floor(this.b[a].p/2),this.Ec=Math.floor(this.b[a].p/2)):(this.Cb=Math.floor(this.b[a].p/2),this.Fc=Math.floor(this.b[a].p/2));this.c[a].q();this.c[a].c[Math.floor(this.b[a].p/2)].P=q};
function ff(a,b){if(!a.Pd)if(!a.Qa||!a.j&&b==a.X)a.X=b;else if(-1==a.be.indexOf(b)){a.be.push(b);a.Pd=q;var c=new Pd;c.F=a;a.dispatchEvent(c);a.onComputing(b);setTimeout(function(){var a=t;0<=this.X&&(a=this.c[this.X],a.visible=u);var a=this.c[b],c=a.c.length,d=Math.floor(c/4),e;for(e=0;e<1*d;e++){if(a.c[e]==t){var j=Nc();j[0]=this.b[b].k[0][0][0]+this.b[b].z[0]*e;j[1]=this.b[b].k[0][0][1]+this.b[b].z[1]*e;j[2]=this.b[b].k[0][0][2]+this.b[b].z[2]*e;if(this.L){var k=Ve(j,this.b[b].Fa,this.b[b].i,this.b[b].w,
this.oa,this.e.ia,this.e,this.e.L,this.e.Da.Ia);this.e.c[b].c[e]=k;this.e.c[b].q(q)}j=Ve(j,this.b[b].Fa,this.b[b].i,this.b[b].w,this.oa,this.ia,this,q,t);j.c[0].P=u;this.L&&(j.e=j.H,j.e=this.e.c[b].c[e].H);a.c[e]=j}a.c[e].P=q}hf(this,0.25);setTimeout(function(){for(;e<2*d;e++){if(a.c[e]==t){var j=Nc();j[0]=this.b[b].k[0][0][0]+this.b[b].z[0]*e;j[1]=this.b[b].k[0][0][1]+this.b[b].z[1]*e;j[2]=this.b[b].k[0][0][2]+this.b[b].z[2]*e;if(this.L){var k=Ve(j,this.b[b].Fa,this.b[b].i,this.b[b].w,this.oa,this.e.ia,
this.e,this.e.L,this.e.Da.Ia);this.e.c[b].c[e]=k;this.e.c[b].q(q)}j=Ve(j,this.b[b].Fa,this.b[b].i,this.b[b].w,this.oa,this.ia,this,q,t);j.c[0].P=u;this.L&&(j.e=j.H,j.e=this.e.c[b].c[e].H);a.c[e]=j}a.c[e].P=q}hf(this,0.5);setTimeout(function(){for(;e<3*d;e++){if(a.c[e]==t){var j=Nc();j[0]=this.b[b].k[0][0][0]+this.b[b].z[0]*e;j[1]=this.b[b].k[0][0][1]+this.b[b].z[1]*e;j[2]=this.b[b].k[0][0][2]+this.b[b].z[2]*e;if(this.L){var k=Ve(j,this.b[b].Fa,this.b[b].i,this.b[b].w,this.oa,this.e.ia,this.e,this.e.L,
this.e.Da.Ia);this.e.c[b].c[e]=k;this.e.c[b].q(q)}j=Ve(j,this.b[b].Fa,this.b[b].i,this.b[b].w,this.oa,this.ia,this,q,t);j.c[0].P=u;this.L&&(j.e=j.H,j.e=this.e.c[b].c[e].H);a.c[e]=j}a.c[e].P=q}hf(this,0.75);setTimeout(function(){for(e=3*d;e<c;e++){if(a.c[e]==t){var j=Nc();j[0]=this.b[b].k[0][0][0]+this.b[b].z[0]*e;j[1]=this.b[b].k[0][0][1]+this.b[b].z[1]*e;j[2]=this.b[b].k[0][0][2]+this.b[b].z[2]*e;if(this.L){var k=Ve(j,this.b[b].Fa,this.b[b].i,this.b[b].w,this.oa,this.e.ia,this.e,this.e.L,this.e.Da.Ia);
this.e.c[b].c[e]=k;this.e.c[b].q(q)}j=Ve(j,this.b[b].Fa,this.b[b].i,this.b[b].w,this.oa,this.ia,this,q,t);j.c[0].P=u;this.L&&(j.e=j.H,j.e=this.e.c[b].c[e].H);a.c[e]=j}a.c[e].P=q}hf(this,1);setTimeout(function(){this.Pd&&this.c[b].q(q);this.X=b;this.j=u;if(this.Pd){var a=new Rd;a.F=this;this.dispatchEvent(a);this.onComputingEnd(b)}this.Pd=u}.bind(this),10)}.bind(this),10)}.bind(this),10)}.bind(this),10)}.bind(a),10)}else{c=a.c[a.X];c.visible=u;var c=a.c[b],e=c.c.length,d;for(d=0;d<e;d++)c.c[d].P=q;
a.X=b;a.j=u}}function hf(a,b){var c=new Qd;c.wd=b;a.dispatchEvent(c);a.onComputingProgress(100*b)}N.prototype.Ef=aa();N.prototype.Gf=aa();N.prototype.Ff=aa();B("X.volume",N);B("X.volume.prototype.modified",N.prototype.q);B("X.volume.prototype.sliceInfoChanged",N.prototype.kk);B("X.volume.prototype.onComputing",N.prototype.Ef);B("X.volume.prototype.onComputingProgress",N.prototype.Gf);B("X.volume.prototype.onComputingEnd",N.prototype.Ff);function jf(){Qe.call(this);this.f="parserOFF"}C(jf,Qe);
jf.prototype.parse=function(a,b,c){function e(){l===d&&n(Error("End of file reached unexpectedly."));for(var a=l;a<d;++a)if(10===f[a]){var b=Se(f,l,a);l=a+1;return b}l=d;return Se(f,l,d-1)}D.Ha(this.f+".parse");this.O=c;var d=c.byteLength,f=W(this,"uchar",d);c=[];b.h=new T(d);b.n=new T(d);for(var g=b.h,h=b.n,l=0,j=e(),j=("OFF"===j?e():j).split(" "),k=j[0],j=j[1];k--;){var m=e(),m=m.split(" ");c.push([parseFloat(m[0]),parseFloat(m[1]),parseFloat(m[2])])}for(;j--;){var m=e(),m=m.split(" "),r=c[parseInt(m[1],
10)],k=c[parseInt(m[2],10)],m=c[parseInt(m[3],10)];g.add(r[0],r[1],r[2]);g.add(k[0],k[1],k[2]);g.add(m[0],m[1],m[2]);r=new Q(r[0],r[1],r[2]);m=new Q(m[0],m[1],m[2]);k=Jc((new Q(k[0],k[1],k[2])).va(r),m.va(r));k.normalize();h.add(k.x,k.y,k.d);h.add(k.x,k.y,k.d);h.add(k.x,k.y,k.d)}D.Ba(this.f+".parse");c=new ld;c.F=b;c.u=a;this.dispatchEvent(c)};B("X.parserOFF",jf);B("X.parserOFF.prototype.parse",jf.prototype.parse);function kf(){Qe.call(this);this.f="parserDCM"}C(kf,Qe);
kf.prototype.parse=function(a,b,c){b.sc={};b.sc.xf=0;this.pc(c,b);if(b.r.length==t||b.qa.length==b.r.length){b.sc.xf=b.r.length;var e={};c={};for(var d=0;d<b.qa.length;d++)e.hasOwnProperty(b.qa[d].series_instance_uid)||(e[b.qa[d].series_instance_uid]=[],c[b.qa[d].series_instance_uid]={}),c[b.qa[d].series_instance_uid].hasOwnProperty(b.qa[d].sop_instance_uid)||(c[b.qa[d].series_instance_uid][b.qa[d].sop_instance_uid]=q,e[b.qa[d].series_instance_uid].push(b.qa[d]));var f=Object.keys(e)[0],d=e[f],g=
d.length;c={};var h="image_position_patient";1==g?(h="image_position_patient",e[f][0].dist=0):d[0].image_position_patient[0]!=d[1].image_position_patient[0]||d[0].image_position_patient[1]!=d[1].image_position_patient[1]||d[0].image_position_patient[2]!=d[1].image_position_patient[2]?(h="image_position_patient",e=new Q(d[0].image_orientation_patient[0],d[0].image_orientation_patient[1],d[0].image_orientation_patient[2]),f=new Q(d[0].image_orientation_patient[3],d[0].image_orientation_patient[4],d[0].image_orientation_patient[5]),
e=Jc(e,f),d.map(function(a,b){b.dist=b.image_position_patient[0]*a.x+b.image_position_patient[1]*a.y+b.image_position_patient[2]*a.d;return b}.bind(t,e)),d.sort(function(a,b){return a.dist-b.dist})):d[0].instance_number!=d[1].instance_number?(h="instance_number",d.sort(function(a,b){return a.instance_number-b.instance_number})):window.console.log("Could not resolve the ordering mode");isNaN(d[0].pixel_spacing[0])&&(d[0].pixel_spacing[0]=1);isNaN(d[0].pixel_spacing[1])&&(d[0].pixel_spacing[1]=1);if(1<
g)switch(h){case "image_position_patient":var l=d[0].image_position_patient,e=d[1].image_position_patient,f=e[0]-l[0],j=e[1]-l[1],k=e[2]-l[2];d[0].pixel_spacing[2]=Math.sqrt(f*f+j*j+k*k);break;case "instance_number":d[0].pixel_spacing[2]=1;break;default:window.console.log("Unkown ordering mode - returning: "+h)}else d[0].pixel_spacing[2]=1;e=1;switch(h){case "image_position_patient":var l=d[0].image_position_patient,m=d[g-1].image_position_patient,f=m[0]-l[0],j=m[1]-l[1],k=m[2]-l[2],f=Math.sqrt(f*
f+j*j+k*k),e=e+Math.round(f/d[0].pixel_spacing[2]);break;case "instance_number":e+=Math.abs(d[g-1].instance_number-d[0].instance_number);break;default:window.console.log("Unkown ordering mode - returning: "+h)}l=d[0].columns*d[0].rows;f=l*e;m=t;switch(d[0].gf){case 8:m=new Uint8Array(f);break;case 16:m=new Uint16Array(f);break;case 32:m=new Uint32Array(f);default:window.console.log("Unknown number of bits allocated - using default: 32 bits")}b.Yb=d[0].pixel_spacing;for(var r=0;r<g;r++){var s=d[r].data,
f=0;switch(h){case "image_position_patient":f=d[r].image_position_patient[0]-d[0].image_position_patient[0];j=d[r].image_position_patient[1]-d[0].image_position_patient[1];k=d[r].image_position_patient[2]-d[0].image_position_patient[2];f=Math.sqrt(f*f+j*j+k*k)/d[0].pixel_spacing[2];break;case "instance_number":f=d[r].instance_number-d[0].instance_number;break;default:window.console.log("Unkown ordering mode - returning: "+h)}m.set(s,f*l)}c.data=m;b.O=m;b.ba=[d[0].columns,d[0].rows,e];c.yl=b.ba;e=
Re(m);g=e[0];e=e[1];c.min=b.Ja=b.fa=g;c.max=b.ja=b.ea=e;-Infinity==b.V&&(b.V=g);Infinity==b.W&&(b.W=e);j=d[0].image_position_patient;g=Sc();switch(h){case "image_position_patient":e=new Q(d[0].image_orientation_patient[0],d[0].image_orientation_patient[1],d[0].image_orientation_patient[2]);f=new Q(d[0].image_orientation_patient[3],d[0].image_orientation_patient[4],d[0].image_orientation_patient[5]);e=Jc(e,f);S(g,0,-d[0].image_orientation_patient[0]*d[0].pixel_spacing[0],-d[0].image_orientation_patient[3]*
d[0].pixel_spacing[1],-e.x*d[0].pixel_spacing[2],-j[0]);S(g,1,-d[0].image_orientation_patient[1]*d[0].pixel_spacing[0],-d[0].image_orientation_patient[4]*d[0].pixel_spacing[1],-e.y*d[0].pixel_spacing[2],-j[1]);S(g,2,d[0].image_orientation_patient[2]*d[0].pixel_spacing[0],d[0].image_orientation_patient[5]*d[0].pixel_spacing[1],e.d*d[0].pixel_spacing[2],j[2]);S(g,3,0,0,0,1);break;case "instance_number":S(g,0,-1,0,0,-j[0]);S(g,1,-0,-1,-0,-j[1]);S(g,2,0,0,1,j[2]);S(g,3,0,0,0,1);break;default:window.console.log("Unkown ordering mode - returning: "+
h)}c.ab=g;c.cb=Sc();$c(c.ab,c.cb);h=Rc(0,0,0,1);d=Qc();cd(g,h,d);h=Rc(1,1,1,1);e=Qc();cd(g,h,e);c.vc=[e[0]-d[0],e[1]-d[1],e[2]-d[2]];d=Te(g,[b.ba[0],b.ba[1],b.ba[2]]);c.tc=[d[1]-d[0]+1,d[3]-d[2]+1,d[5]-d[4]+1];c.uc=[d[0],d[2],d[4]];b.Fb(c);b.rb=Ye(this,b)}c=new ld;c.F=b;c.u=a;this.dispatchEvent(c)};
function lf(a,b,c,e){switch(c){case 16975:case 20819:case 20053:case 22351:c=function(a){for(var b="",c=128;1<=c;c/=2)b+=a&c?"1":"0";return b};e=a[b++];a=a[b++];e=parseInt(c((a&65280)>>8)+c(a&255)+(c((e&65280)>>8)+c(e&255)),2);4294967295==e&&(e=0);b+=e/2;break;default:b+=e/2}return b}
kf.prototype.pc=function(a,b){this.O=a;if("undefined"==typeof b.qa||b.qa==t)b.qa=[];for(var c={pixel_spacing:[0.1,0.1,Infinity],image_orientation_patient:[1,0,0,0,1,0],image_position_patient:[0,0,0],transfer_syntax_uid:"no_transfer_syntax_uid"},e=W(this,"ushort",this.O.byteLength),d=66,f=t,g=t,h=t,l=t;d<e.length;)switch(f=e[d++],g=e[d++],h=e[d++],l=e[d++],"1.2.840.10008.1.2"==c.transfer_syntax_uid&&0==l&&(l=h),f){case 2:switch(g){case 16:for(var j="",f=f=0;f<l/2;f++)h=e[d++],g=h&255,h=(h&65280)>>
8,j+=String.fromCharCode(g),j+=String.fromCharCode(h);c.transfer_syntax_uid=j.replace(/\0/g,"");break;default:d=lf(e,d,h,l)}break;case 40:switch(g){case 16:c.rows=e[d];d+=l/2;break;case 17:c.columns=e[d];d+=l/2;break;case 256:c.gf=e[d];d+=l/2;break;case 257:c.bits_stored=e[d];d+=l/2;break;case 2:c.number_of_images=e[d];d+=l/2;break;case 48:j="";for(f=0;f<l/2;f++)h=e[d++],g=h&255,h=(h&65280)>>8,j+=String.fromCharCode(g),j+=String.fromCharCode(h);j=j.split("\\");c.pixel_spacing=[parseFloat(j[0]),parseFloat(j[1]),
Infinity];break;default:d=lf(e,d,h,l)}break;case 32:switch(g){case 14:c.series_instance_uid="";for(f=0;f<l/2;f++)h=e[d++],g=h&255,h=(h&65280)>>8,c.series_instance_uid+=String.fromCharCode(g),c.series_instance_uid+=String.fromCharCode(h);break;case 19:j="";for(f=0;f<l/2;f++)h=e[d++],g=h&255,h=(h&65280)>>8,j+=String.fromCharCode(g),j+=String.fromCharCode(h);c.instance_number=parseInt(j,10);break;case 50:j="";for(f=0;f<l/2;f++)h=e[d++],g=h&255,h=(h&65280)>>8,j+=String.fromCharCode(g),j+=String.fromCharCode(h);
j=j.split("\\");c.image_position_patient=[parseFloat(j[0]),parseFloat(j[1]),parseFloat(j[2])];break;case 55:j="";for(f=0;f<l/2;f++)h=e[d++],g=h&255,h=(h&65280)>>8,j+=String.fromCharCode(g),j+=String.fromCharCode(h);j=j.split("\\");c.image_orientation_patient=[parseFloat(j[0]),parseFloat(j[1]),parseFloat(j[2]),parseFloat(j[3]),parseFloat(j[4]),parseFloat(j[5])];break;default:d=lf(e,d,h,l)}break;case 65534:switch(g){default:l=0,d+=l/2}break;case 8:switch(g){case 24:c.sop_instance_uid="";for(f=0;f<l/
2;f++)h=e[d++],g=h&255,h=(h&65280)>>8,c.sop_instance_uid+=String.fromCharCode(g),c.sop_instance_uid+=String.fromCharCode(h);break;default:d=lf(e,d,h,l)}break;case 16:switch(g){case 8720:for(f=0;f<l/2;f++)d++;break;default:d=lf(e,d,h,l)}break;default:d=lf(e,d,h,l)}switch(c.gf){case 8:c.data=new Uint8Array(c.columns*c.rows);break;case 16:c.data=new Uint16Array(c.columns*c.rows);break;case 32:c.data=new Uint32Array(c.columns*c.rows)}this.D=this.O.byteLength-2*c.columns*c.rows;e=t;switch(c.gf){case 8:e=
W(this,"uchar",c.columns*c.rows);break;case 16:e=W(this,"ushort",c.columns*c.rows);break;case 32:e=W(this,"uint",c.columns*c.rows)}c.data=e;b.qa.push(c);return b};B("X.parserDCM",kf);B("X.parserDCM.prototype.parse",kf.prototype.parse);function mf(){Qe.call(this);this.f="parserVTK"}C(mf,Qe);
mf.prototype.parse=function(a,b,c){D.Ha(this.f+".parse");var e=b.h,d=b.n,f=new Uint8Array(c),g="";b.h=e=new T(c.byteLength);b.n=d=new T(c.byteLength);c=0;for(var h=f.length;c<h;c+=32768)g+=Se(f,c,Math.min(c+32768,h));f=g.split("\n");g=f.length;this.ud=this.vd=t;this.fc=[];this.Oa=id;this.Se=this.Tb=this.Mb=this.Ub=u;c=0;for(h=g%8;h--;)nf(this,f[c]),c++;for(h=0.125*g^0;h--;)nf(this,f[c]),c++,nf(this,f[c]),c++,nf(this,f[c]),c++,nf(this,f[c]),c++,nf(this,f[c]),c++,nf(this,f[c]),c++,nf(this,f[c]),c++,
nf(this,f[c]),c++;c=this.vd;var f=this.ud,g=f.length,l=h=this.fc.length;do{var j=this.fc[h-l],k=j.length,m;for(m=0;m<k&&!("LINES"==this.Oa&&m+1>=k);m++){var r=parseInt(j[m],10),s=c.get(r);e.add(s[0],s[1],s[2]);var y=r,z=s;"LINES"==this.Oa?(y=parseInt(j[m+1],10),z=c.get(y),e.add(z[0],z[1],z[2])):"TRIANGLE_STRIPS"==this.Oa&&(0==m||m==k-1)&&e.add(s[0],s[1],s[2]);r<g?(z=f.get(r),d.add(z[0],z[1],z[2]),"LINES"==this.Oa?(y=f.get(y),d.add(y[0],y[1],y[2])):"TRIANGLE_STRIPS"==this.Oa&&(0==m||m==k-1)&&d.add(z[0],
z[1],z[2])):(y=new Q(s[0],s[1],s[2]),y.normalize(),d.add(y.x,y.y,y.d),"LINES"==this.Oa?(y=new Q(z[0],z[1],z[2]),y.normalize(),d.add(y.x,y.y,y.d)):"TRIANGLE_STRIPS"==this.Oa&&(0==m||m==k-1)&&d.add(y.x,y.y,y.d))}l--}while(0<l);b.Ga=this.Oa;D.Ba(this.f+".parse");e=new ld;e.F=b;e.u=a;this.dispatchEvent(e)};
function nf(a,b){b=b.replace(/^\s+|\s+$/g,"");var c=b.split(" "),e=c.length,d=c[0];switch(d){case "POINTS":a.Ub=q;a.Mb=u;a.Tb=u;c=parseInt(c[1],10);a.vd=new T(3*c);a.ud=new T(3*c);return;case "VERTICES":a.Mb=q;a.Ub=u;a.Tb=u;c=parseInt(c[1],10);3<=c?a.Oa=id:1==c?a.Oa="POINTS":n(Error("This VTK file is not supported!"));a.fc=[];return;case "TRIANGLE_STRIPS":a.Mb=q;a.Ub=u;a.Tb=u;a.Oa="TRIANGLE_STRIPS";a.fc=[];return;case "LINES":a.Mb=q;a.Ub=u;a.Tb=u;a.Oa="LINES";a.fc=[];return;case "POLYGONS":a.Mb=q;
a.Ub=u;a.Tb=u;a.Oa="POLYGONS";a.fc=[];return;case "POINT_DATA":a.Tb=q;a.Ub=u;a.Mb=u;return}if(a.Ub)if(1==e||isNaN(parseFloat(d)))a.Ub=u;else{if(3<=e){var d=parseFloat(c[0]),f=parseFloat(c[1]),g=parseFloat(c[2]);a.vd.add(d,f,g)}6<=e&&(d=parseFloat(c[3]),f=parseFloat(c[4]),g=parseFloat(c[5]),a.vd.add(d,f,g));9<=e&&(e=parseFloat(c[6]),d=parseFloat(c[7]),c=parseFloat(c[8]),a.vd.add(e,d,c))}else a.Mb?1==e||isNaN(parseFloat(d))?a.Mb=u:(c=c.slice(1),a.fc.push(c)):a.Tb&&("NORMALS"==d?a.Se=q:1==e||isNaN(parseFloat(d))?
(a.Tb=u,a.Se=u):a.Se&&(3<=e&&(d=parseFloat(c[0]),f=parseFloat(c[1]),g=parseFloat(c[2]),a.ud.add(d,f,g)),6<=e&&(d=parseFloat(c[3]),f=parseFloat(c[4]),g=parseFloat(c[5]),a.ud.add(d,f,g)),9<=e&&(e=parseFloat(c[6]),d=parseFloat(c[7]),c=parseFloat(c[8]),a.ud.add(e,d,c))))}B("X.parserVTK",mf);B("X.parserVTK.prototype.parse",mf.prototype.parse);function of(){Qe.call(this);this.f="parserFSM";this.Ic=u}C(of,Qe);
of.prototype.parse=function(a,b,c){D.Ha(this.f+".parse");this.O=c;var e=b.h,d=b.n;b.Jc=[];var f=b.Jc;c=0;var g;do g=W(this,"uchar"),c++;while(200>c&&10!=g);W(this,"uchar");d=W(this,"uint");c=W(this,"uint");var h=W(this,"float",3*d);g=W(this,"uint",3*c);var l=new Uint32Array(d),j=new Float32Array(9*c);b.h=e=new T(9*c);b.n=d=new T(9*c);var k;for(k=0;k<c;k++){var m=3*k,r=g[m],s=g[m+1],y=g[m+2];f.push(r);f.push(s);f.push(y);l[r]+=1;l[s]+=1;l[y]+=1;var m=3*r,z=3*s,F=3*y,G=h[m],J=h[m+1],A=h[m+2],s=h[z],
y=h[z+1],r=h[z+2],E=h[F],L=h[F+1],O=h[F+2];e.add(G,J,A);e.add(s,y,r);e.add(E,L,O);G=new Q(G,J,A);E=new Q(E,L,O);s=(new Q(s,y,r)).l().va(G);y=E.l().va(G);s=Jc(s,y).normalize();j[m]+=s.x;j[m+1]+=s.y;j[m+2]+=s.d;j[z]+=s.x;j[z+1]+=s.y;j[z+2]+=s.d;j[F]+=s.x;j[F+1]+=s.y;j[F+2]+=s.d}for(k=0;k<c;k++)m=3*k,r=g[m],s=g[m+1],y=g[m+2],m=3*r,z=3*s,F=3*y,f=new Q(j[z],j[z+1],j[z+2]),h=new Q(j[F],j[F+1],j[F+2]),m=(new Q(j[m],j[m+1],j[m+2])).scale(1/l[r]).normalize(),f=f.scale(1/l[s]).normalize(),h=h.scale(1/l[y]).normalize(),
d.add(m.x,m.y,m.d),d.add(f.x,f.y,f.d),d.add(h.x,h.y,h.d);c=W(this,"uchar",this.O.byteLength-this.D);g=t;for(m=0;m<c.length;m++)if(99==c[m]&&114==c[m+1]&&97==c[m+2]&&115==c[m+3]){for(d=g=m+9;10!=c[m]&&m<c.length;)d++,m++;g=Se(c.subarray(g,d)).split(" ");break}g&&(b.ka.ci(parseFloat(g[0])),b.ka.di(parseFloat(g[1])),b.ka.ei(parseFloat(g[2])));b.Ga=id;D.Ba(this.f+".parse");c=new ld;c.F=b;c.u=a;this.dispatchEvent(c)};B("X.parserFSM",of);B("X.parserFSM.prototype.parse",of.prototype.parse);var pf={lf:function(a,b,c){return pf.update(a,0,b,c)},update:function(a,b,c,e){var d=pf.li,f="number"===typeof c?c:c=0;e="number"===typeof e?e:a.length;b^=4294967295;for(f=e&7;f--;++c)b=b>>>8^d[(b^a[c])&255];for(f=e>>3;f--;c+=8)b=b>>>8^d[(b^a[c])&255],b=b>>>8^d[(b^a[c+1])&255],b=b>>>8^d[(b^a[c+2])&255],b=b>>>8^d[(b^a[c+3])&255],b=b>>>8^d[(b^a[c+4])&255],b=b>>>8^d[(b^a[c+5])&255],b=b>>>8^d[(b^a[c+6])&255],b=b>>>8^d[(b^a[c+7])&255];return(b^4294967295)>>>0}};
pf.li=new Uint32Array([0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,
3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,
366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,
3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,
1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,
1088359270,936918E3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117]);function qf(a){var b=a.length,c=0,e=Number.POSITIVE_INFINITY,d,f,g,h,l,j,k,m,r;for(m=0;m<b;++m)a[m]>c&&(c=a[m]),a[m]<e&&(e=a[m]);d=1<<c;f=new Uint32Array(d);g=1;h=0;for(l=2;g<=c;){for(m=0;m<b;++m)if(a[m]===g){j=0;k=h;for(r=0;r<g;++r)j=j<<1|k&1,k>>=1;for(r=j;r<d;r+=l)f[r]=g<<16|m;++h}++g;h<<=1;l<<=1}return[f,c,e]};function rf(a,b){this.hf=[];this.jf=32768;this.nb=this.xd=this.M=this.eg=0;this.input=new Uint8Array(a);this.Lg=u;this.kf=sf;this.Ib=u;if(b||!(b={}))b.index&&(this.M=b.index),b.bufferSize&&(this.jf=b.bufferSize),b.bufferType&&(this.kf=b.bufferType),b.resize&&(this.Ib=b.resize);switch(this.kf){case tf:this.ma=32768;this.Sa=new Uint8Array(32768+this.jf+258);break;case sf:this.ma=0;this.Sa=new Uint8Array(this.jf);this.nc=this.Pi;this.Rg=this.Ii;this.qf=this.Li;break;default:n(Error("invalid inflate mode"))}}
var tf=0,sf=1;
rf.prototype.Zb=function(){for(;!this.Lg;){var a=uf(this,3);a&1&&(this.Lg=q);a>>>=1;switch(a){case 0:var a=this.input,b=this.M,c=this.Sa,e=this.ma,d=p,f=p,g=p,h=c.length,d=p;this.nb=this.xd=0;d=a[b++];d===p&&n(Error("invalid uncompressed block header: LEN (first byte)"));f=d;d=a[b++];d===p&&n(Error("invalid uncompressed block header: LEN (second byte)"));f|=d<<8;d=a[b++];d===p&&n(Error("invalid uncompressed block header: NLEN (first byte)"));g=d;d=a[b++];d===p&&n(Error("invalid uncompressed block header: NLEN (second byte)"));g|=
d<<8;f===~g&&n(Error("invalid uncompressed block header: length verify"));b+f>a.length&&n(Error("input buffer is broken"));switch(this.kf){case tf:for(;e+f>c.length;)d=h-e,f-=d,c.set(a.subarray(b,b+d),e),e+=d,b+=d,this.ma=e,c=this.nc(),e=this.ma;break;case sf:for(;e+f>c.length;)c=this.nc({ah:2});break;default:n(Error("invalid inflate mode"))}c.set(a.subarray(b,b+f),e);e+=f;this.M=b+=f;this.ma=e;this.Sa=c;break;case 1:this.qf(vf,wf);break;case 2:xf(this);break;default:n(Error("unknown BTYPE: "+a))}}return this.Rg()};
var yf=new Uint16Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),zf=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258]),Af=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0]),Bf=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577]),Cf=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),Df=new Uint8Array(288),
Ef,Ff;Ef=0;for(Ff=Df.length;Ef<Ff;++Ef)Df[Ef]=143>=Ef?8:255>=Ef?9:279>=Ef?7:8;var vf=qf(Df),Gf=new Uint8Array(30),Hf,If;Hf=0;for(If=Gf.length;Hf<If;++Hf)Gf[Hf]=5;var wf=qf(Gf);function uf(a,b){for(var c=a.xd,e=a.nb,d=a.input,f=a.M,g;e<b;)g=d[f++],g===p&&n(Error("input buffer is broken")),c|=g<<e,e+=8;g=c&(1<<b)-1;a.xd=c>>>b;a.nb=e-b;a.M=f;return g}
function Jf(a,b){for(var c=a.xd,e=a.nb,d=a.input,f=a.M,g=b[0],h=b[1],l;e<h;)l=d[f++],l===p&&n(Error("input buffer is broken")),c|=l<<e,e+=8;d=g[c&(1<<h)-1];g=d>>>16;a.xd=c>>g;a.nb=e-g;a.M=f;return d&65535}
function xf(a){function b(a,b,c){var d,e,f;for(f=0;f<a;)switch(d=Jf(this,b),d){case 16:for(d=3+uf(this,2);d--;)c[f++]=e;break;case 17:for(d=3+uf(this,3);d--;)c[f++]=0;e=0;break;case 18:for(d=11+uf(this,7);d--;)c[f++]=0;e=0;break;default:e=c[f++]=d}return c}var c=uf(a,5)+257,e=uf(a,5)+1,d=uf(a,4)+4,f=new Uint8Array(yf.length),g;for(g=0;g<d;++g)f[yf[g]]=uf(a,3);d=qf(f);f=new Uint8Array(c);g=new Uint8Array(e);a.qf(qf(b.call(a,c,d,f)),qf(b.call(a,e,d,g)))}w=rf.prototype;
w.qf=function(a,b){var c=this.Sa,e=this.ma;this.Ug=a;for(var d=c.length-258,f,g,h;256!==(f=Jf(this,a));)if(256>f)e>=d&&(this.ma=e,c=this.nc(),e=this.ma),c[e++]=f;else{f-=257;h=zf[f];0<Af[f]&&(h+=uf(this,Af[f]));f=Jf(this,b);g=Bf[f];0<Cf[f]&&(g+=uf(this,Cf[f]));e>=d&&(this.ma=e,c=this.nc(),e=this.ma);for(;h--;)c[e]=c[e++-g]}for(;8<=this.nb;)this.nb-=8,this.M--;this.ma=e};
w.Li=function(a,b){var c=this.Sa,e=this.ma;this.Ug=a;for(var d=c.length,f,g,h;256!==(f=Jf(this,a));)if(256>f)e>=d&&(c=this.nc(),d=c.length),c[e++]=f;else{f-=257;h=zf[f];0<Af[f]&&(h+=uf(this,Af[f]));f=Jf(this,b);g=Bf[f];0<Cf[f]&&(g+=uf(this,Cf[f]));e+h>d&&(c=this.nc(),d=c.length);for(;h--;)c[e]=c[e++-g]}for(;8<=this.nb;)this.nb-=8,this.M--;this.ma=e};
w.nc=function(){var a=new Uint8Array(this.ma-32768),b=this.ma-32768,c=this.Sa;a.set(c.subarray(32768,a.length));this.hf.push(a);this.eg+=a.length;c.set(c.subarray(b,b+32768));this.ma=32768;return c};w.Pi=function(a){var b=this.input.length/this.M+1|0,c=this.input,e=this.Sa;a&&("number"===typeof a.ah&&(b=a.ah),"number"===typeof a.Fi&&(b+=a.Fi));2>b?(a=(c.length-this.M)/this.Ug[2],a=258*(a/2)|0,a=a<e.length?e.length+a:e.length<<1):a=e.length*b;a=new Uint8Array(a);a.set(e);return this.Sa=a};
w.Rg=function(){var a=0,b=this.Sa,c=this.hf,e,d=new Uint8Array(this.eg+(this.ma-32768)),f,g,h,l;if(0===c.length)return this.Sa.subarray(32768,this.ma);f=0;for(g=c.length;f<g;++f){e=c[f];h=0;for(l=e.length;h<l;++h)d[a++]=e[h]}f=32768;for(g=this.ma;f<g;++f)d[a++]=b[f];this.hf=[];return this.buffer=d};w.Ii=function(){var a,b=this.ma;this.Ib?(a=new Uint8Array(b),a.set(this.Sa.subarray(0,b))):a=this.Sa.subarray(0,b);return this.buffer=a};new Uint8Array(256);var Kf;for(Kf=0;256>Kf;++Kf)for(var Lf=Kf,Mf=7,Lf=Lf>>>1;Lf;Lf>>>=1)--Mf;var Nf=[],Of;for(Of=0;288>Of;Of++)switch(q){case 143>=Of:Nf.push([Of+48,8]);break;case 255>=Of:Nf.push([Of-144+400,9]);break;case 279>=Of:Nf.push([Of-256+0,7]);break;case 287>=Of:Nf.push([Of-280+192,8]);break;default:n("invalid literal: "+Of)}
function Pf(){var a=Qf;switch(q){case 3===a:return[257,a-3,0];case 4===a:return[258,a-4,0];case 5===a:return[259,a-5,0];case 6===a:return[260,a-6,0];case 7===a:return[261,a-7,0];case 8===a:return[262,a-8,0];case 9===a:return[263,a-9,0];case 10===a:return[264,a-10,0];case 12>=a:return[265,a-11,1];case 14>=a:return[266,a-13,1];case 16>=a:return[267,a-15,1];case 18>=a:return[268,a-17,1];case 22>=a:return[269,a-19,2];case 26>=a:return[270,a-23,2];case 30>=a:return[271,a-27,2];case 34>=a:return[272,a-
31,2];case 42>=a:return[273,a-35,3];case 50>=a:return[274,a-43,3];case 58>=a:return[275,a-51,3];case 66>=a:return[276,a-59,3];case 82>=a:return[277,a-67,4];case 98>=a:return[278,a-83,4];case 114>=a:return[279,a-99,4];case 130>=a:return[280,a-115,4];case 162>=a:return[281,a-131,5];case 194>=a:return[282,a-163,5];case 226>=a:return[283,a-195,5];case 257>=a:return[284,a-227,5];case 258===a:return[285,a-258,0];default:n("invalid length: "+a)}}var Rf=[],Qf,Sf;
for(Qf=3;258>=Qf;Qf++)Sf=Pf(),Rf[Qf]=Sf[2]<<24|Sf[1]<<16|Sf[0];new Uint32Array(Rf);function Tf(){};function Uf(a){this.input=a;this.M=0;this.member=[]}
Uf.prototype.Zb=function(){for(var a=this.input.length;this.M<a;){var b=new Tf,c=p,e=p,d=p,f=c=d=p,g=p,c=c=p,h=this.input,e=this.M;b.jh=h[e++];b.kh=h[e++];(31!==b.jh||139!==b.kh)&&n(Error("invalid file signature:",b.jh,b.kh));b.Qg=h[e++];switch(b.Qg){case 8:break;default:n(Error("unknown compression method: "+b.Qg))}b.le=h[e++];c=h[e++]|h[e++]<<8|h[e++]<<16|h[e++]<<24;b.Kl=new Date(1E3*c);b.Vl=h[e++];b.Pl=h[e++];0<(b.le&4)&&(b.Ge=h[e++]|h[e++]<<8,e+=b.Ge);if(0<(b.le&8)){g=[];for(f=0;0<(c=h[e++]);)g[f++]=
String.fromCharCode(c);b.name=g.join("")}if(0<(b.le&16)){g=[];for(f=0;0<(c=h[e++]);)g[f++]=String.fromCharCode(c);b.comment=g.join("")}0<(b.le&2)&&(b.Ji=pf.lf(h,0,e)&65535,b.Ji!==(h[e++]|h[e++]<<8)&&n(Error("invalid header crc16")));c=h[h.length-4]|h[h.length-3]<<8|h[h.length-2]<<16|h[h.length-1]<<24;h.length-e-4-4<512*c&&(d=c);e=new rf(h,{index:e,bufferSize:d});b.data=d=e.Zb();e=e.M;b.vl=c=(h[e++]|h[e++]<<8|h[e++]<<16|h[e++]<<24)>>>0;pf.lf(d)!==c&&n(Error("invalid CRC-32 checksum: 0x"+pf.lf(d).toString(16)+
" / 0x"+c.toString(16)));b.Dl=c=(h[e++]|h[e++]<<8|h[e++]<<16|h[e++]<<24)>>>0;(d.length&4294967295)!==c&&n(Error("invalid input size: "+(d.length&4294967295)+" / "+c));this.member.push(b);this.M=e}a=this.member;b=d=e=0;for(h=a.length;b<h;++b)d+=a[b].data.length;d=new Uint8Array(d);for(b=0;b<h;++b)d.set(a[b].data,e),e+=a[b].data.length;return d};function Vf(){Qe.call(this);this.f="parserMGZ";this.Ic=u}C(Vf,Qe);
Vf.prototype.parse=function(a,b,c,e){D.Ha(this.f+".parse");e&&(c=(new Uf(new Uint8Array(c))).Zb(),c=c.buffer);e=this.pc(c);var d=[e.Af,e.Bf,e.Cf];b.ba=d;var f=e.fi;b.Yb=f;c=e.min;var g=e.max;b.Ja=b.fa=c;b.ja=b.ea=g;-Infinity==b.V&&(b.V=c);Infinity==b.W&&(b.W=g);c=Sc();S(c,0,e.bb[0][0],e.bb[1][0],e.bb[2][0],0);S(c,1,e.bb[0][1],e.bb[1][1],e.bb[2][1],0);S(c,2,e.bb[0][2],e.bb[1][2],e.bb[2][2],0);S(c,3,0,0,0,1);for(var g=d[0]/2,h=d[1]/2,l=d[2]/2,d=[0,0,0],j=0;3>j;++j)d[j]=e.bb[3][j]-(c[j+0]*f[0]*g+c[j+
4]*f[1]*h+c[j+8]*f[2]*l);f=d[1];g=d[2];c[12]=d[0];c[13]=f;c[14]=g;c[15]=1;e.ab=c;e.cb=Sc();$c(e.ab,e.cb);d=Rc(0,0,0,1);f=Qc();cd(c,d,f);g=Rc(1,1,1,1);d=Qc();cd(c,g,d);c=Te(c,b.ba);e.vc=[d[0]-f[0],d[1]-f[1],d[2]-f[2]];e.tc=[c[1]-c[0]+1,c[3]-c[2]+1,c[5]-c[4]+1];e.uc=[c[0],c[2],c[4]];b.Fb(e);D.Ba(this.f+".parse");b.rb=Ye(this,b);e=new ld;e.F=b;e.u=a;this.dispatchEvent(e)};
Vf.prototype.pc=function(a){this.O=a;a={version:0,oi:0,mi:0,Vi:0,ni:0,Af:0,Bf:0,Cf:0,wj:0,type:0,Ni:0,Ph:0,Ak:t,bb:t,fi:t,data:t,min:Infinity,max:-Infinity};a.version=W(this,"uint");a.Af=W(this,"uint");a.Bf=W(this,"uint");a.Cf=W(this,"uint");a.wj=W(this,"uint");a.type=W(this,"uint");a.Ni=W(this,"uint");a.Ph=W(this,"ushort");if(0<a.Ph){a.fi=W(this,"float",3);var b=[];b.push(W(this,"float",3));b.push(W(this,"float",3));b.push(W(this,"float",3));b.push(W(this,"float",3));a.bb=b}this.D=284;b=a.Af*a.Bf*
a.Cf;switch(a.type){case 0:a.data=W(this,"uchar",b);break;case 1:a.data=W(this,"uint",b);break;case 3:a.data=W(this,"float",b);break;case 4:a.data=W(this,"ushort",b);break;default:n(Error("Unsupported MGH/MGZ data type: "+a.type))}b=Re(a.data);a.min=b[0];a.max=b[1];this.D+16<this.O.byteLength&&(a.oi=W(this,"float"),a.Vi=W(this,"float"),a.mi=W(this,"float"),a.ni=W(this,"float"));return a};B("X.parserMGZ",Vf);B("X.parserMGZ.prototype.parse",Vf.prototype.parse);function Wf(){Qe.call(this);this.f="parserLBL"}C(Wf,Qe);
Wf.prototype.parse=function(a,b,c){D.Ha(this.f+".parse");var e=b.Jc,d=e.length;0==d&&n(Error("No _pointIndices defined on the X.object."));this.O=c;var f=[],g=W(this,"uchar",c.byteLength),h=g.length,l=u,j=0;for(c=1;c<h;c++)10==g[c-1]?(j=c,l=q):l&&32==g[c]&&(f.push(parseInt(Se(g,j,c),10)),l=u);g=b.K.J?b.K.J:new Float32Array(d);h=f.length;for(c=0;c<h;c++)g[f[c]]=1;f=new Float32Array(3*d);for(c=h=0;c<d;c++)l=e[c],l>d&&n(Error("Could not find scalar for vertex.")),l=g[l],f[h++]=l,f[h++]=l,f[h++]=l;b.K.J=
g;b.K.$c=f;b.K.j=q;D.Ba(this.f+".parse");e=new ld;e.F=b;e.u=a;this.dispatchEvent(e)};B("X.parserLBL",Wf);B("X.parserLBL.prototype.parse",Wf.prototype.parse);function Xf(){Qe.call(this);this.f="parserCRV";this.Ic=u}C(Xf,Qe);
Xf.prototype.parse=function(a,b,c){D.Ha(this.f+".parse");var e=b.Jc;0==e.length&&n(Error("No _pointIndices defined on the X.object."));this.O=c;this.D=3;var d=W(this,"uint");W(this,"uint");W(this,"uint");var f=0,g=0,h=0,l=0,j=0,k=0,m=0,r=0,s=0,y=0,z=0;c=Array(2);var F=Array(2),G=W(this,"float",d),J;for(J=0;J<d;J++){var A=G[J];0==J&&(c[0]=F[0]=A);0<=A?(f++,l+=A):(g++,h+=A);s+=A;z++;F[0]=Math.max(A,F[0]);c[0]=Math.min(A,c[0]);G[J]=A}0!=f&&(j=l/f);0!=g&&(k=h/g);0!=z&&(y=s/z);for(z=s=h=l=0;z<d;z++)A=
G[z],J=0,0<=A?(J=Math.pow(A-j,2),l+=J):(J=Math.pow(A-k,2),h+=J),J=Math.pow(A-y,2),s+=J;1<f&&(m=Math.sqrt(l/(f-1)));1<g&&(r=Math.sqrt(h/(g-1)));c[1]=k-2.5*r;F[1]=j+2.5*m;d=e.length;f=new Float32Array(3*d);for(z=0;z<d;z++)g=G[e[z]],h=3*z,f[h]=g,f[h+1]=g,f[h+2]=g;b.K.Ja=c[1];b.K.ja=F[1];-Infinity==b.K.V&&(b.K.V=c[1]);Infinity==b.K.W&&(b.K.W=F[1]);b.K.J=G;b.K.$c=f;b.K.j=q;D.Ba(this.f+".parse");e=new ld;e.F=b;e.u=a;this.dispatchEvent(e)};B("X.parserCRV",Xf);B("X.parserCRV.prototype.parse",Xf.prototype.parse);function Yf(a,b){var c,e;this.input=a;this.M=0;if(b||!(b={}))b.index&&(this.M=b.index),b.verify&&(this.sk=b.verify);c=a[this.M++];e=a[this.M++];switch(c&15){case 8:this.method=8;break;default:n(Error("unsupported compression method"))}0!==((c<<8)+e)%31&&n(Error("invalid fcheck flag:"+((c<<8)+e)%31));e&32&&n(Error("fdict flag is not supported"));this.Qh=new rf(a,{index:this.M,bufferSize:b.bufferSize,bufferType:b.bufferType,resize:b.resize})}
Yf.prototype.Zb=function(){var a=this.input,b;b=this.Qh.Zb();this.M=this.Qh.M;if(this.sk){var a=(a[this.M++]<<24|a[this.M++]<<16|a[this.M++]<<8|a[this.M++])>>>0,c=b;if("string"===typeof c){var c=c.split(""),e,d;e=0;for(d=c.length;e<d;e++)c[e]=(c[e].charCodeAt(0)&255)>>>0}e=1;d=0;for(var f=c.length,g,h=0;0<f;){g=1024<f?1024:f;f-=g;do e+=c[h++],d+=e;while(--g);e%=65521;d%=65521}a!==(d<<16|e)>>>0&&n(Error("invalid adler-32 checksum"))}return b};function Zf(){Qe.call(this);this.f="parserRAW"}C(Zf,Qe);
Zf.prototype.parse=function(a,b,c,e){D.Ha(this.f+".parse");e&&(c=(new Yf(new Uint8Array(c))).Zb(),c=c.buffer);e={};e.data=new Uint8Array(c);var d=Re(e.data);c=d[0];d=d[1];e.min=b.Ja=b.fa=c;e.max=b.ja=b.ea=d;-Infinity==b.V&&(b.V=c);Infinity==b.W&&(b.W=d);d=Tc();e.ab=d;e.cb=Tc();var f=Rc(0,0,0,1);c=Qc();cd(d,f,c);var g=Rc(1,1,1,1),f=Qc();cd(d,g,f);d=Te(d,b.ba);e.vc=[f[0]-c[0],f[1]-c[1],f[2]-c[2]];e.tc=[d[1]-d[0]+1,d[3]-d[2]+1,d[5]-d[4]+1];e.uc=[d[0],d[2],d[4]];b.Fb(e);D.Ba(this.f+".parse");b.rb=Ye(this,
b);e=new ld;e.F=b;e.u=a;this.dispatchEvent(e)};B("X.parserRAW",Zf);B("X.parserRAW.prototype.parse",Zf.prototype.parse);function $f(){Qe.call(this);this.f="parserLUT"}C($f,Qe);
$f.prototype.parse=function(a,b,c){D.Ha(this.f+".parse");this.O=c;c=W(this,"uchar",c.byteLength);var e=c.length,d=0,f;for(f=0;f<e;f++)if(10==c[f]){var g=Se(c,d,f),d=f+1,g=g.replace(/^\s+|\s+$/g,"");"#"!=g[0]&&(g=g.split(" "),g=g.filter(function(a){return""!=a}),6==g.length&&(g[2]=parseInt(g[2],10)/255,g[3]=parseInt(g[3],10)/255,g[4]=parseInt(g[4],10)/255,g[5]=parseInt(g[5],10)/255,a.add(parseInt(g[0],10),g[1],g[2],g[3],g[4],g[5],10)))}D.Ba(this.f+".parse");c=new ld;c.F=b;c.u=a;this.dispatchEvent(c)};
B("X.parserLUT",$f);B("X.parserLUT.prototype.parse",$f.prototype.parse);function ag(){Qe.call(this);this.f="parserMRC"}C(ag,Qe);
ag.prototype.parse=function(a,b,c){D.Ha(this.f+".parse");c=this.pc(c);var e=c.min,d=c.max;b.ba=[c.Ed,c.Fd,c.Gd];b.Yb=[c.Ge/c.Ch,c.ii/c.Dh,c.ji/c.Eh];b.Ja=b.fa=e;b.ja=b.ea=d;-Infinity==b.V&&(b.V=e);Infinity==b.W&&(b.W=d);d=Sc();S(d,3,0,0,0,1);S(d,0,-1,0,0,c.Ed);S(d,1,0,0,-1,c.Fd);S(d,2,0,-1,0,c.Gd);c.ab=d;c.cb=Sc();$c(c.ab,c.cb);var f=Rc(0,0,0,1),e=Qc();cd(d,f,e);var g=Rc(1,1,1,1),f=Qc();cd(d,g,f);g=[c.Ed,c.Fd,c.Gd];d=Te(d,g);c.vc=[f[0]-e[0],f[1]-e[1],f[2]-e[2]];c.tc=[d[1]+d[0]+1,d[3]-d[2]+1,d[5]-
d[4]+1];c.uc=[d[0],d[2],d[4]];b.ba=g;b.Fb(c);b.rb=Ye(this,b);D.Ba(this.f+".parse");c=new ld;c.F=b;c.u=a;this.dispatchEvent(c)};
ag.prototype.pc=function(a){this.O=a;a={Ed:0,Fd:0,Gd:0,mode:0,Ml:0,Nl:0,Ol:0,Ch:0,Dh:0,Eh:0,Ge:0,ii:0,ji:0,alpha:0,Hi:0,Wi:0,oj:0,pj:0,qj:0,ef:0,fe:0,kc:0,Fl:0,next:0,Ki:0,Qi:t,xj:0,zj:0,Qi:t,hj:0,Cl:0,fj:0,lj:0,tj:0,uj:0,qk:0,rk:0,ok:t,tk:0,uk:0,vk:0,ul:0,Ul:0,ik:0,yj:0,data:t,min:Infinity,max:-Infinity,Jl:0,ai:t,Tl:t,Rl:t,orientation:t,Ll:t};this.D=0;a.Ed=W(this,"sint");a.Fd=W(this,"sint");a.Gd=W(this,"sint");a.mode=W(this,"sint");var b=a.Ed*a.Fd*a.Gd;this.D=1024;switch(a.mode){case 0:a.data=W(this,
"schar",b);break;case 1:a.data=W(this,"sshort",b);break;case 2:a.data=W(this,"float",b);break;case 3:a.data=W(this,"uint",b);break;case 4:a.data=W(this,"double",b);break;case 6:a.data=W(this,"ushort",b);break;case 16:a.data=W(this,"uchar",b);break;default:n(Error("Unsupported MRC data type: "+a.mode))}this.D=28;a.Ch=W(this,"sint");a.Dh=W(this,"sint");a.Eh=W(this,"sint");a.Ge=W(this,"float");a.ii=W(this,"float");a.ji=W(this,"float");a.alpha=W(this,"float");a.Hi=W(this,"float");a.Wi=W(this,"float");
a.oj=W(this,"sint");a.pj=W(this,"sint");a.qj=W(this,"sint");a.ef=W(this,"float");a.fe=W(this,"float");a.kc=W(this,"float");a.El=W(this,"sint");a.next=W(this,"sint");a.Ki=W(this,"short");a.xj=W(this,"short");a.zj=W(this,"short");a.hj=W(this,"sint");a.Bl=W(this,"sint");a.fj=W(this,"short");a.lj=W(this,"short");a.tj=W(this,"short");a.uj=W(this,"short");a.qk=W(this,"short");a.rk=W(this,"short");a.ok=W(this,"float",6);this.D=196;a.tk=W(this,"float");a.uk=W(this,"float");a.vk=W(this,"float");this.D=216;
a.ik=W(this,"float");a.yj=W(this,"sint");a.Gl=W(this,"schar",10);if(0!=a.next)switch(this.D=parseInt(a.next+1024,10),a.mode){case 0:a.data=W(this,"schar",b);break;case 1:a.data=W(this,"sshort",b);break;case 2:a.data=W(this,"float",b);break;case 3:a.data=W(this,"uint",b);break;case 4:a.data=W(this,"double",b);break;case 6:a.data=W(this,"ushort",b);break;case 16:a.data=W(this,"uchar",b);break;default:n(Error("Unsupported MRC data type: "+a.mode))}0>a.kc-(a.fe-a.kc)?(a.min=a.ef,a.max=a.kc+(a.kc-a.ef)):
(a.min=a.kc-(a.fe-a.kc),a.max=a.fe);return a};B("X.parserMRC",ag);B("X.parserMRC.prototype.parse",ag.prototype.parse);function bg(){Qe.call(this);this.f="parserNRRD"}C(bg,Qe);
bg.prototype.parse=function(a,b,c){D.Ha(this.f+".parse");this.O=c;c=W(this,"uchar",c.byteLength);var e=c.length,d=t,f=0,g;for(g=1;g<e;g++)if(10==c[g-1]&&10==c[g]){d=Se(c,0,g-2);f=g+1;break}var h,l,j,k,e=d.split(/\r?\n/),d=0;for(g=e.length;d<g;d++)if(h=e[d],h.match(/NRRD\d+/))this.jj=q;else if(!h.match(/^#/)&&(k=h.match(/(.*):(.*)/)))l=k[1].trim(),h=k[2].trim(),(j=this.Ri[l])?j.call(this,h):this[l]=h;this.jj||n(Error("Not an NRRD file"));"raw"!==this.encoding&&("gzip"!==this.encoding&&"gz"!==this.encoding)&&
n(Error("Only raw or gz/gzip encoding is allowed"));if(!this.ha&&(this.ha=[new Q(1,0,0),new Q(0,1,0),new Q(0,0,1)],this.$f)){e=[];for(k=0;2>=k;k++)e.push(!isNaN(this.$f[k])?this.ha[k].scale(this.$f[k]):p)}f=c.subarray(f);if("gzip"==this.encoding||"gz"==this.encoding)f=(new Uf(new Uint8Array(f))).Zb();f=f.buffer;c={data:t,min:Infinity,max:-Infinity};c.data=new this.Lb(f);k=Re(c.data);f=c.min=k[0];k=c.max=k[1];b.Ja=b.fa=f;b.ja=b.ea=k;b.ba=[this.Yf[0],this.Yf[1],this.Yf[2]];e=(new Q(this.ha[0][0],this.ha[0][1],
this.ha[0][2])).Hb();d=(new Q(this.ha[1][0],this.ha[1][1],this.ha[1][2])).Hb();g=(new Q(this.ha[2][0],this.ha[2][1],this.ha[2][2])).Hb();b.Yb=[e,d,g];-Infinity==b.V&&(b.V=f);Infinity==b.W&&(b.W=k);e=k=1;"left-posterior-superior"==this.ai&&(e=k=-1);f=Tc();S(f,0,k*this.ha[0][0],k*this.ha[1][0],k*this.ha[2][0],k*this.Zf[0]);S(f,1,e*this.ha[0][1],e*this.ha[1][1],e*this.ha[2][1],e*this.Zf[1]);S(f,2,1*this.ha[0][2],1*this.ha[1][2],1*this.ha[2][2],1*this.Zf[2]);S(f,3,0,0,0,1);c.ab=f;c.cb=Sc();$c(c.ab,c.cb);
e=Rc(0,0,0,1);k=Qc();cd(f,e,k);d=Rc(1,1,1,1);e=Qc();cd(f,d,e);f=Te(f,b.ba);c.vc=[e[0]-k[0],e[1]-k[1],e[2]-k[2]];c.tc=[f[1]-f[0]+1,f[3]-f[2]+1,f[5]-f[4]+1];c.uc=[f[0],f[2],f[4]];b.Fb(c);D.Ba(this.f+".parse");b.rb=Ye(this,b);c=new ld;c.F=b;c.u=a;this.dispatchEvent(c)};
bg.prototype.Ri={type:function(a){switch(a){case "uchar":case "unsigned char":case "uint8":case "uint8_t":this.Lb=Uint8Array;break;case "signed char":case "int8":case "int8_t":this.Lb=Int8Array;break;case "short":case "short int":case "signed short":case "signed short int":case "int16":case "int16_t":this.Lb=Int16Array;break;case "ushort":case "unsigned short":case "unsigned short int":case "uint16":case "uint16_t":this.Lb=Uint16Array;break;case "int":case "signed int":case "int32":case "int32_t":this.Lb=
Int32Array;break;case "uint":case "unsigned int":case "uint32":case "uint32_t":this.Lb=Uint32Array;break;case "float":this.Lb=Float32Array;break;case "double":this.Lb=Float64Array;break;default:n(Error("Unsupported NRRD data type: "+a))}return this.type=a},endian:function(a){return this.zl=a},encoding:function(a){return this.encoding=a},dimension:function(a){return this.$a=parseInt(a,10)},sizes:function(a){var b,c,e,d;e=a.split(/\s+/);d=[];b=0;for(c=e.length;b<c;b++)a=e[b],d.push(parseInt(a,10));
return this.Yf=d},space:function(a){return this.ai=a},"space origin":function(a){return this.Zf=a.split("(")[1].split(")")[0].split(",")},"space directions":function(a){var b,c;a=a.match(/\(.*?\)/g);var e,d,f;f=[];e=0;for(d=a.length;e<d;e++)c=a[e],f.push(function(){var a,d,e,f;e=c.slice(1,-1).split(/,/);f=[];a=0;for(d=e.length;a<d;a++)b=e[a],f.push(parseFloat(b));return f}());return this.ha=f},spacings:function(a){var b;b=a.split(/\s+/);var c,e,d;d=[];c=0;for(e=b.length;c<e;c++)a=b[c],d.push(parseFloat(a));
return this.$f=d}};B("X.parserNRRD",bg);B("X.parserNRRD.prototype.parse",bg.prototype.parse);function cg(){Qe.call(this);this.f="parserSTL"}C(cg,Qe);
cg.prototype.parse=function(a,b,c){D.Ha(this.f+".parse");this.O=c;var e=b.h,d=b.n;if("solid"==Se(W(this,"uchar",5))){b.h=e=new T(c.byteLength);b.n=d=new T(c.byteLength);var f=e,e=d,d=W(this,"uchar",c.byteLength-5);c=d.length;var g=u,h=u,l=0,j;for(j=0;j<c;j++)if(10==d[j]){if(g||h){var k=Se(d,l,j).split(" "),h=parseFloat(k[0]),m=parseFloat(k[1]),k=parseFloat(k[2]);g?(e.add(h,m,k),e.add(h,m,k),e.add(h,m,k)):f.add(h,m,k);h=g=u}}else 32==d[j-1]&&(102==d[j]?(l=j+=13,g=q):118==d[j]&&(l=j+=7,h=q))}else{this.D=
80;f=W(this,"uint");b.h=e=new T(9*f);b.n=d=new T(9*f);for(c=c=0;c<f;c++)g=W(this,"float",12),l=g[0],j=g[1],h=g[2],d.add(l,j,h),d.add(l,j,h),d.add(l,j,h),e.add(g[3],g[4],g[5]),e.add(g[6],g[7],g[8]),e.add(g[9],g[10],g[11]),this.D+=2}D.Ba(this.f+".parse");f=new ld;f.F=b;f.u=a;this.dispatchEvent(f)};B("X.parserSTL",cg);B("X.parserSTL.prototype.parse",cg.prototype.parse);D.debug={};var dg=1,eg;function fg(){var a=window.open("","myDebugWin","left=0, top=0, width=300, height=200, titlebar=yes,  scrollbars=yes,status=yes, resizable=yes");a.document.open();a.document.write("<html><head><title>myDebugWin</title></head><body><pre>\n");return a}function Y(a){var b=eg;b&&!b.closed&&b.document.write(a+"\n")}function gg(a){if(eg==p||eg.closed)eg=fg();Y(a)};function hg(){Qe.call(this);this.f="parserNII"}C(hg,Qe);
hg.prototype.parse=function(a,b,c){if(!ig(c))try{c=(new Uf(new Uint8Array(c))).Zb(),c=c.buffer,ig(c)||(this.Ic=u)}catch(e){this.Ic=u}c=this.pc(c);if(eg==p||eg.closed)eg=fg();Y("mri.sizeof_hdr=>"+c.Wh);var d="";for(i=0;10>i;i++)d+=c.Vg[i];Y("mri.data_type=>"+d);d="";for(i=0;18>i;i++)d+=c.Wg[i];Y("mri.db_name=>"+d);Y("mri.extents=>"+c.Zg);Y("mri.session_error=>"+c.Uh);Y("mri.regular=>"+c.Rh);Y("mri.dim_info=>"+c.Xg);for(i=0;8>i;i++)d="mri.dim["+i+"]",Y(d+c.$a[i]);Y("mri.intent_p1=>"+c.ph);Y("mri.intent_p2=>"+
c.qh);Y("mri.intent_p3=>"+c.rh);Y("mri.intent_code=>"+c.nh);d="";for(i=0;80>i;i++)d+=c.rf[i];Y("mri.descrip=>"+d);Y("mri.bitpix=>"+c.Mg);Y("mri.slice_start=>"+c.$h);for(i=0;8>i;i++)d="mri.pixdim["+i+"]",Y(d+c.A[i]);Y("mri.vox_offset=>"+c.jg);Y("mri.scl_slope=>"+c.Th);Y("mri.scl_inter=>"+c.Sh);Y("mri.slice_end=>"+c.Zh);Y("mri.slice_code=>"+c.Xh);Y("mri.xyzt_units=>"+c.hi);Y("mri.cal_max=>"+c.Ng);Y("mri.cal_min=>"+c.Og);Y("mri.slice_duration=>"+c.Yh);Y("mri.toffset=>"+c.bi);Y("mri.glmax=>"+c.dh);Y("mri.glmin=>"+
c.eh);d="";for(i=0;80>i;i++)d+=c.rf[i];Y("mri.descrip=>"+d);d="";for(i=0;24>i;i++)d+=c.ff[i];Y("mri.aux_file=>"+d);Y("mri.aux_file=>"+c.ff);Y("mri.qform_code=>"+c.we);Y("mri.sform_code=>"+c.Xf);Y("mri.quatern_b=>"+c.Rf);Y("mri.quatern_c=>"+c.Sf);Y("mri.quatern_d=>"+c.Tf);Y("mri.qoffset_x=>"+c.Of);Y("mri.qoffset_y=>"+c.Pf);Y("mri.qoffset_z=>"+c.Qf);for(i=0;4>i;i++)d="mri.srow_x["+i+"]",Y(d+c.ag[i]);for(i=0;4>i;i++)d="mri.srow_y["+i+"]",Y(d+c.bg[i]);for(i=0;4>i;i++)d="mri.srow_z["+i+"]",Y(d+c.cg[i]);
d="";for(i=0;16>i;i++)d+=c.oh[i];Y("mri.intent_name =>"+d);for(i=0;4>i;i++)d="mri.magic["+i+"]",Y(d+c.wh[i]);Y("volsize is=>"+c.$a[1]*c.$a[2]*c.$a[3]);switch(c.zd){case 2:Y("mri.data=> unsigned char");break;case 4:Y("mri.data=> signed short");break;case 8:Y("mri.data=> signed int");break;case 16:Y("mri.data=> float");break;case 32:Y("mri.data=> complex");break;case 64:Y("mri.data=> double");break;case 256:Y("mri.data=> signed char");break;case 512:Y("mri.data=> unsigned short");break;case 768:Y("mri.data=> unsigned int");
break;default:n(Error("Unsupported NII data type: "+c.zd))}Y("mri.min=>"+c.min);Y("mri.max=>"+c.max);var d=c.min,f=c.max;b.Ja=b.fa=d;b.ja=b.ea=f;-Infinity==b.V&&(b.V=d);Infinity==b.W&&(b.W=f);d=Sc();S(d,3,0,0,0,1);if(0<c.we){var f=0,g=c.Rf,h=c.Sf,l=c.Tf,j=1,k=1,m=1,r=c.Of,s=c.Pf,y=c.Qf,f=1-(g*g+h*h+l*l);1E-7>f?(f=1/Math.sqrt(g*g+h*h+l*l),g*=f,h*=f,l*=f,f=0):f=Math.sqrt(f);0<c.A[1]&&(j=c.A[1]);0<c.A[2]&&(k=c.A[2]);0<c.A[2]&&(m=c.A[3]);0>c.A[0]&&(m=-m);S(d,0,(f*f+g*g-h*h-l*l)*j,2*(g*h-f*l)*k,2*(g*l+
f*h)*m,r);S(d,1,2*(g*h+f*l)*j,(f*f+h*h-g*g-l*l)*k,2*(h*l-f*g)*m,s);S(d,2,2*(g*l-f*h)*j,2*(h*l+f*g)*k,(f*f+l*l-h*h-g*g)*m,y)}else 0<c.Xf?(f=c.ag,g=c.bg,h=c.cg,S(d,0,f[0],f[1],f[2],f[3]),S(d,1,g[0],g[1],g[2],g[3]),S(d,2,h[0],h[1],h[2],h[3])):0==c.we?(S(d,0,c.A[1],0,0,0),S(d,1,0,c.A[2],0,0),S(d,2,0,0,c.A[3],0)):window.console.log("UNKNOWN METHOD IN PARSER NII");c.ab=d;c.cb=Sc();$c(c.ab,c.cb);g=Rc(0,0,0,1);f=Qc();cd(d,g,f);h=Rc(1,1,1,1);g=Qc();cd(d,h,g);h=[c.$a[1],c.$a[2],c.$a[3]];d=Te(d,h);c.vc=[g[0]-
f[0],g[1]-f[1],g[2]-f[2]];c.tc=[d[1]-d[0]+1,d[3]-d[2]+1,d[5]-d[4]+1];c.uc=[d[0],d[2],d[4]];b.ba=h;b.Fb(c);b.rb=Ye(this,b);c=new ld;c.F=b;c.u=a;this.dispatchEvent(c)};
hg.prototype.pc=function(a){this.O=a;a={Wh:0,Vg:t,Wg:t,Zg:0,Uh:0,Rh:0,Xg:t,$a:t,ph:0,qh:0,rh:0,nh:0,zd:0,Mg:0,$h:0,A:t,jg:0,Th:0,Sh:0,Zh:0,Xh:t,hi:t,Ng:0,Og:0,Yh:0,bi:0,dh:0,eh:0,rf:t,ff:t,we:0,Xf:0,Rf:0,Sf:0,Tf:0,Of:0,Pf:0,Qf:0,ag:t,bg:t,cg:t,oh:t,wh:t,data:t,min:Infinity,max:-Infinity};a.Wh=W(this,"uint");a.Vg=W(this,"uchar",10);a.Wg=W(this,"uchar",18);a.Zg=W(this,"uint");a.Uh=W(this,"ushort");a.Rh=W(this,"uchar");a.Xg=W(this,"uchar");a.$a=W(this,"ushort",8);a.ph=W(this,"float");a.qh=W(this,"float");
a.rh=W(this,"float");a.nh=W(this,"ushort");a.zd=W(this,"ushort");a.Mg=W(this,"ushort");a.$h=W(this,"ushort");a.A=W(this,"float",8);if(0.5>a.A[1]||0.5>a.A[1]||0.5>a.A[1]){var b=Math.min(a.A[1],a.A[2],a.A[3]);gg("NII, need to rescale pixdim -> "+0.5/b);gg("NII, old values are.."+a.A[1]+", "+a.A[2]+", "+a.A[3]);a.A[1]*=0.5/b;a.A[2]*=0.5/b;a.A[3]*=0.5/b;gg("NII, new values are.."+a.A[1]+", "+a.A[2]+", "+a.A[3]);dg=0.5/b}a.jg=W(this,"float");a.Th=W(this,"float");a.Sh=W(this,"float");a.Zh=W(this,"ushort");
a.Xh=W(this,"uchar");a.hi=W(this,"uchar");a.Ng=W(this,"float");a.Og=W(this,"float");a.Yh=W(this,"float");a.bi=W(this,"float");a.dh=W(this,"uint",1);a.eh=W(this,"uint",1);a.rf=W(this,"uchar",80);a.ff=W(this,"uchar",24);a.we=W(this,"ushort");a.Xf=W(this,"ushort");a.Rf=W(this,"float");a.Sf=W(this,"float");a.Tf=W(this,"float");a.Of=W(this,"float");a.Pf=W(this,"float");a.Qf=W(this,"float");a.ag=W(this,"float",4);a.bg=W(this,"float",4);a.cg=W(this,"float",4);a.oh=W(this,"uchar",16);a.wh=W(this,"uchar",
4);this.D=parseInt(a.jg,10);b=a.$a[1]*a.$a[2]*a.$a[3];switch(a.zd){case 2:a.data=W(this,"uchar",b);break;case 4:a.data=W(this,"sshort",b);break;case 8:a.data=W(this,"sint",b);break;case 16:a.data=W(this,"float",b);break;case 32:a.data=W(this,"complex",b);break;case 64:a.data=W(this,"double",b);break;case 256:a.data=W(this,"schar",b);break;case 512:a.data=W(this,"ushort",b);break;case 768:a.data=W(this,"uint",b);break;default:n(Error("Unsupported NII data type: "+a.zd))}b=Re(a.data);a.min=b[0];a.max=
b[1];return a};function ig(a){var b=-1,b="undefined"==typeof DataView?(new Int32Array(a,0,1))[0]:(new DataView(a,0)).getInt32(0,q);return 348==b?q:u}B("X.parserNII",hg);B("X.parserNII.prototype.parse",hg.prototype.parse);function jg(){Qe.call(this);this.f="parserTRK"}C(jg,Qe);
jg.prototype.parse=function(a,b,c){D.Ha(this.f+".parse");var e=b.h,d=b.n,f=b.pa;this.O=c;W(this,"uchar",6);W(this,"ushort",3);var g=W(this,"float",3);W(this,"float",3);var h=W(this,"ushort");W(this,"uchar",200);W(this,"ushort");W(this,"uchar",200);c=W(this,"float",16);W(this,"uchar",444);W(this,"uchar",4);W(this,"uchar",4);W(this,"float",6);W(this,"uchar",2);W(this,"uchar");W(this,"uchar");W(this,"uchar");W(this,"uchar");W(this,"uchar");W(this,"uchar");var l=W(this,"uint");W(this,"uint");var j=W(this,
"uint"),k=0===l?Infinity:l,m=[],r=[],l=Infinity,s=-Infinity,y=t,z=t,F=t,G=t,d=e=t,J=W(this,"uint",(this.O.byteLength-1E3)/4);this.D=j;for(var A=W(this,"float",(this.O.byteLength-1E3)/4),E=0,j=f=0;j<k;j++){if("undefined"===typeof J[E]){k=j;break}for(var L=J[E],O=new T(3*L),R=0,P=0;P<L;P++){var U=A[E+3*P+P*h+1],ca=A[E+3*P+P*h+2],da=A[E+3*P+P*h+3],U=U/g[0],ca=ca/g[1],da=da/g[2];O.add(U,ca,da);if(0<P)var M=O.get(P-1),R=R+Math.sqrt(Math.pow(U-M[0],2)+Math.pow(ca-M[1],2)+Math.pow(da-M[2],2));P<L-1&&(f+=
6)}E+=3*L+L*h+1;P=O.ib;L=O.fb;U=O.jb;ca=O.gb;da=O.kb;M=O.hb;if(!y||P<y)y=P;if(!z||L>z)z=L;if(!F||U<F)F=U;if(!G||ca>G)G=ca;if(!e||da<e)e=da;if(!d||M>d)d=M;m.push(O);r.push(R)}g=(y+z)/2;h=(F+G)/2;G=(e+d)/2;F=new Float32Array(f);b.h=e=new T(f);b.n=d=new T(f);b.pa=f=new T(f);for(j=y=0;j<k;j++){z=m[j];J=z.count;R=r[j];l=Math.min(l,R);s=Math.max(s,R);for(P=0;P<J-1;P++){E=z.get(P);A=z.get(P+1);e.add(E[0],E[1],E[2]);e.add(A[0],A[1],A[2]);var O=E[0]-g,L=E[1]-h,U=E[2]-G,ca=Math.sqrt(O*O+L*L+U*U),da=A[0]-g,
M=A[1]-h,oa=A[2]-G,H=Math.sqrt(da*da+M*M+oa*oa);d.add(O/ca,L/ca,U/ca);d.add(da/H,M/H,oa/H);A=[Math.abs(A[0]-E[0]),Math.abs(A[1]-E[1]),Math.abs(A[2]-E[2])];E=Math.sqrt(A[0]*A[0]+A[1]*A[1]+A[2]*A[2]);A[0]/=E;A[1]/=E;A[2]/=E;f.add(A[0],A[1],A[2]);f.add(A[0],A[1],A[2]);F[y++]=R;F[y++]=R;F[y++]=R;F[y++]=R;F[y++]=R;F[y++]=R}}b.Ga="LINES";k=new kd;k.Ja=l;k.ja=s;k.V=l;k.W=s;k.$c=F;k.Fg=u;k.j=q;b.K=k;l=u;for(j=0;16>j;j++)if(0!=c[j]){l=q;break}l==u&&(c[0]=c[5]=c[10]=c[15]=1);D.Ba(this.f+".parse");D.g.fg(c,
b.ka.R);c=new ld;c.F=b;c.u=a;this.dispatchEvent(c)};B("X.parserTRK",jg);B("X.parserTRK.prototype.parse",jg.prototype.parse);function kg(){Qe.call(this);this.f="parserOBJ"}C(kg,Qe);
kg.prototype.parse=function(a,b,c){D.Ha(this.f+".parse");this.O=c;c=c.byteLength;var e=W(this,"uchar",c);gg("OBJ, length is "+c);var d=[];b.h=new T(c);b.n=new T(c);var f=b.h,g=b.n,h=0,l=0,j;for(j=0;j<c;++j)if(10==e[j]){var k=Se(e,h,j);l++;5>l&&gg("OBJ, range ("+l+")=> "+h+" to "+j);h=k.replace(/\s{2,}/g," ").split(" ");5>l&&gg("OBJ, _d ("+h+")");if("v"==h[0]){var m=dg,k=parseFloat(h[1])*m,r=parseFloat(h[2])*m,h=parseFloat(h[3])*m;5>l&&gg("OBJ, in v, x="+k+" y="+r+" z="+h);d.push([k,r,h])}else"f"==
h[0]&&(r=d[parseInt(h[1],10)-1],k=d[parseInt(h[2],10)-1],h=d[parseInt(h[3],10)-1],f.add(r[0],r[1],r[2]),f.add(k[0],k[1],k[2]),f.add(h[0],h[1],h[2]),5>l&&(gg("OBJ, in f, p1[0]="+r[0]+" p1[1]="+r[1]+" p1[2]="+r[2]),gg("OBJ, in f, p2[0]="+k[0]+" p2[1]="+k[1]+" p2[2]="+k[2]),gg("OBJ, in f, p3[0]="+h[0]+" p3[1]="+h[1]+" p3[2]="+h[2])),r=new Q(r[0],r[1],r[2]),h=new Q(h[0],h[1],h[2]),h=Jc((new Q(k[0],k[1],k[2])).va(r),h.va(r)),h.normalize(),g.add(h.x,h.y,h.d),g.add(h.x,h.y,h.d),g.add(h.x,h.y,h.d),5>l&&gg("OBJ, in f, norm.x="+
h.x+" norm.y="+h.y+" norm.z="+h.d));h=j+1}D.Ba(this.f+".parse");c=new ld;c.F=b;c.u=a;this.dispatchEvent(c)};B("X.parserOBJ",kg);B("X.parserOBJ.prototype.parse",kg.prototype.parse);function lg(){K.call(this);this.f="loader";this.Gc=new Ac;this.nd=0}C(lg,K);function mg(a,b){a.nd+=b/a.Gc.me()/3;a.nd=Math.min(1,a.nd);var c=new Od;c.wd=a.nd;a.dispatchEvent(c)}function ng(a){a=a.r.Yd;var b=a.split(".").pop().toUpperCase();b==a.toUpperCase()&&(b="");b in og||n(Error("The "+b+" file format is not supported."));return[a,b,og[b][0],og[b][1],og[b][2]]}
lg.prototype.load=function(a,b){(!a||!b)&&n(Error("No container or object to load."));if(!Dc(this.Gc.ga,a.xa)||this.Gc.get(a.xa)){this.Gc.set(a.xa,u);var c=ng(a)[0];if(a.qb!=t)this.parse(t,a,b);else{var e=new XMLHttpRequest;I(e,"abort",this.$g.bind(this,e,a,b));I(e,"error",this.$g.bind(this,e,a,b));I(e,"load",this.parse.bind(this,e,a,b));e.open("GET",c,q);e.responseType="arraybuffer";e.send(t)}}};
lg.prototype.parse=function(a,b,c){mg(this,1);setTimeout(function(){var e=ng(b),d=e[3],e=new e[2];bc(e,yd,this.complete.bind(this));var f=b.qb;f==t&&(f=a.response,b.qb=f);e.parse(b,c,f,d)}.bind(this),100)};lg.prototype.complete=function(a){mg(this,1);setTimeout(function(){var b=a.u,c=a.F;b.r.j=u;b.j=q;c.q();this.Gc.set(b.xa,q)}.bind(this),100)};lg.prototype.$g=function(a,b,c){n(Error("Loading failed: ",b,c))};
var og={OBJ:[kg,t],OFF:[jf,t],STL:[cg,t],VTK:[mf,t],TRK:[jg,t],MRC:[ag,t],ST:[ag,t],FSM:[of,t],INFLATED:[of,t],SMOOTHWM:[of,t],SPHERE:[of,t],PIAL:[of,t],ORIG:[of,t],NRRD:[bg,t],NII:[hg,t],GZ:[hg,t],DCM:[kf,t],DICOM:[kf,t],"":[kf,t],CRV:[Xf,t],LABEL:[Wf,t],MGH:[Vf,u],MGZ:[Vf,q],RAW:[Zf,u],RZ:[Zf,q],TXT:[$f,t],LUT:[$f,t],PNG:[af,"png"],JPG:[af,"jpeg"],JPEG:[af,"jpeg"],GIF:[af,"gif"]};function pg(a){function b(a,b,e){b=2*b*Math.PI;b=za(Ba(l,Math.cos(b)),Ba(j,Math.sin(b)));a=za(za(c,Ba(d,a)),Ba(b,f));e=za(Ba(b,1-Math.abs(e)),Ba(g,e));return new lc(a,e)}this.Z=[];a=a||{};var c=new ya(a.start||[0,-1,0]),e=new ya(a.end||[0,1,0]),d=Ca(e,c),f=a.vb||1;a=a.qa||16;for(var g=Da(d),h=0.5<Math.abs(g.y()),l=Da((new ya(h,!h,0)).mc(g)),j=Da(l.mc(g)),h=new lc(c,Ea(g)),e=new lc(e,Da(g)),k=[],m=0;m<a;m++){var r=m/a,s=(m+1)/a;k.push(new nc([h,b(0,r,-1),b(0,s,-1)]));k.push(new nc([b(0,s,0),b(0,r,
0),b(1,r,0),b(1,s,0)]));k.push(new nc([e,b(1,s,1),b(1,r,1)]))}return vc(k)}C(pg,uc);function qg(){V.call(this);this.f="cylinder";this.af=[-10,-10,-10];this.Ke=[10,10,10];this.hc=10;this.Za=32;Ga(this,new od)}C(qg,V);qg.prototype.__defineGetter__("start",v("af"));qg.prototype.__defineSetter__("start",function(a){(a==t||!ka(a)||3!=a.length)&&n(Error("Invalid start"));this.af=a});qg.prototype.__defineGetter__("end",v("Ke"));qg.prototype.__defineSetter__("end",function(a){(a==t||!ka(a)||3!=a.length)&&n(Error("Invalid end"));this.Ke=a});qg.prototype.__defineGetter__("radius",v("hc"));
qg.prototype.__defineSetter__("radius",function(a){x(a)||n(Error("Invalid radius."));this.hc=a});qg.prototype.q=function(){qd(this,new pg({start:this.af,end:this.Ke,vb:this.hc,qa:this.Za}));qg.B.q.call(this)};B("X.cylinder",qg);B("X.cylinder.prototype.modified",qg.prototype.q);function rg(a){function b(a,b){a*=2*Math.PI;b*=Math.PI;var d=new ya(Math.cos(a)*Math.sin(b),Math.cos(b),Math.sin(a)*Math.sin(b));g.push(new lc(za(c,Ba(d,e)),d))}this.Z=[];a=a||{};var c=new ya(a.mf||[0,0,0]),e=a.vb||1,d=a.qa||16;a=a.lk||8;for(var f=[],g=[],h=0;h<d;h++)for(var l=0;l<a;l++)g=[],b(h/d,l/a),0<l&&b((h+1)/d,l/a),l<a-1&&b((h+1)/d,(l+1)/a),b(h/d,(l+1)/a),f.push(new nc(g));return vc(f)}C(rg,uc);function sg(){V.call(this);this.f="sphere";this.C=[0,0,0];this.hc=5;this.Za=32;this.zi=16;Ga(this,new od)}C(sg,V);sg.prototype.__defineGetter__("center",v("C"));sg.prototype.__defineSetter__("center",function(a){(a==t||!ka(a)||3!=a.length)&&n(Error("Invalid center"));this.C=a});sg.prototype.__defineGetter__("radius",v("hc"));sg.prototype.__defineSetter__("radius",function(a){x(a)||n(Error("Invalid radius."));this.hc=a});
sg.prototype.q=function(){qd(this,new rg({mf:this.C,vb:this.hc,qa:this.Za,lk:this.zi}));sg.B.q.call(this)};B("X.sphere",sg);B("X.sphere.prototype.modified",sg.prototype.q);function gf(a){N.call(this);this.f="labelmap";this.Eb=a;this.$e=new Float32Array([-255,-255,-255,-255])}C(gf,N);gf.prototype.q=function(){var a=new ld;a.F=this;this.dispatchEvent(a);this.Eb.q()};gf.prototype.__defineSetter__("showOnly",function(a){var b=[-1,-1,-1,-1];a!=t&&(ka(a)&&4==a.length?b=a:(this.Da||n(Error("No colortable assigned.")),b=this.Da.Ia.get(a).slice(1,5)));this.$e=new Float32Array([Math.floor(255*b[0]),Math.floor(255*b[1]),Math.floor(255*b[2]),Math.floor(255*b[3])])});
B("X.labelmap",gf);function tg(a){this.Z=[];a=a||{};var b=new ya(a.mf||[0,0,0]),c=!a.vb?[1,1,1]:a.vb.length?a.vb:[a.vb,a.vb,a.vb];return vc([[[0,4,6,2],[-1,0,0]],[[1,3,7,5],[1,0,0]],[[0,1,5,4],[0,-1,0]],[[2,6,7,3],[0,1,0]],[[0,2,3,1],[0,0,-1]],[[4,5,7,6],[0,0,1]]].map(function(a){return new nc(a[0].map(function(d){d=new ya(b.x()+c[0]*(2*!!(d&1)-1),b.y()+c[1]*(2*!!(d&2)-1),b.d()+c[2]*(2*!!(d&4)-1));return new lc(d,new ya(a[1]))}))}))}C(tg,uc);function ug(){V.call(this);this.f="cube";this.C=[0,0,0];this.Pe=this.Oe=this.Ne=20;this.Qc=[0,1,1,1,1,0,0,1,1,0,0,0,1,1,1,0,0,0,1,1,0,0,0,1,0,1,1,1,1,0,0,1,1,0,0,0,0,0,0,1,1,1,0,0,1,1,1,0,1,1,1,0,0,0,1,1,0,0,0,1,0,1,1,1,1,0,0,1,1,0,0,0];Ga(this,new od)}C(ug,V);ug.prototype.__defineGetter__("center",v("C"));ug.prototype.__defineSetter__("center",function(a){(a==t||!ka(a)||3!=a.length)&&n(Error("Invalid center"));this.C=a});ug.prototype.__defineGetter__("lengthX",v("Ne"));
ug.prototype.__defineSetter__("lengthX",function(a){x(a)||n(Error("Invalid lengthX."));this.Ne=a});ug.prototype.__defineGetter__("lengthY",v("Oe"));ug.prototype.__defineSetter__("lengthY",function(a){x(a)||n(Error("Invalid lengthY."));this.Oe=a});ug.prototype.__defineGetter__("lengthZ",v("Pe"));ug.prototype.__defineSetter__("lengthZ",function(a){x(a)||n(Error("Invalid lengthZ."));this.Pe=a});ug.prototype.q=function(){qd(this,new tg({mf:this.C,vb:[this.Ne/2,this.Oe/2,this.Pe/2]}));ug.B.q.call(this)};
B("X.cube",ug);B("X.cube.prototype.modified",ug.prototype.q);function Ke(a){Ie.call(this,a);this.f="interactor3D";this.ll=u}C(Ke,Ie);Ke.prototype.Hd=function(a){Ke.B.Hd.call(this,a);var b=new Jd;a.Uc==t&&(a.Uc=0);b.sb=0>a.Uc;b.eb=q;this.dispatchEvent(b)};function vg(a){K.call(this);this.f="array";this.J=[];this.mg=a}C(vg,K);function wg(a,b,c){for(var e=0;4>e;e++)if(a[e+0]!==b[e+c])return u;return q}vg.prototype.add=function(a){this.J.push(a);return q};vg.prototype.remove=function(a){a=this.J.indexOf(a);-1<a&&this.J.splice(a,1);return q};vg.prototype.clear=function(){this.J.length=0};
function xg(a,b,c){var e=c-b;if(!(2>e)){e=b+Math.floor(e/2);xg(a,b,e);for(xg(a,e,c);b<e;++b)if(0<a.mg(a.J[b],a.J[e])){var d=a.J[b];a.J[b]=a.J[e];for(var f=a,g=e,h=c;g+1<h&&0>f.mg(f.J[g+1],d);){var l=f,j=g+1,k=l.J[g];l.J[g]=l.J[j];l.J[j]=k;++g}f.J[g]=d}}}vg.prototype.sort=function(){xg(this,0,this.J.length)};function yg(a){Rb.call(this);this.Gb=a;this.T=[]}C(yg,Rb);var zg=[];function Ag(a,b,c,e,d){ka(c)||(zg[0]=c,c=zg);for(var f=0;f<c.length;f++){var g=I(b,c[f],e||a,d||u,a.Gb||a);a.T.push(g)}}yg.prototype.Uf=function(){Lb(this.T,dc);this.T.length=0};yg.prototype.handleEvent=function(){n(Error("EventHandler.handleEvent not implemented"))};function Bg(){}Bg.bh=function(){return Bg.mh?Bg.mh:Bg.mh=new Bg};Bg.prototype.vj=0;Bg.bh();function Cg(a){kc.call(this);this.$b=a||Zd();this.hk=Eg}C(Cg,kc);Cg.prototype.ej=Bg.bh();var Eg=t;w=Cg.prototype;w.lh=t;w.Wc=u;w.I=t;w.hk=t;w.Id=t;w.yd=t;w.nf=t;w.s=v("I");w.Wf=function(a){this.Id&&this.Id!=a&&n(Error("Method not supported"));Cg.B.Wf.call(this,a)};w.ne=v("$b");w.Tc=function(){this.I=this.$b.createElement("div")};w.cc=function(a){this.dc(a)};
w.dc=function(a,b){this.Wc&&n(Error("Component already rendered"));this.I||this.Tc();a?a.insertBefore(this.I,b||t):this.$b.la.body.appendChild(this.I);(!this.Id||this.Id.Wc)&&this.je()};w.je=function(){function a(a){!a.Wc&&a.s()&&a.je()}this.Wc=q;this.yd&&Lb(this.yd,a,p)};w.ke=function(){function a(a){a.Wc&&a.ke()}this.yd&&Lb(this.yd,a,p);this.Yi&&this.Yi.Uf();this.Wc=u};
w.removeChild=function(a,b){if(a){var c=ma(a)?a:a.lh||(a.lh=":"+(a.ej.vj++).toString(36)),e;this.nf&&c?(e=this.nf,e=(c in e?e[c]:p)||t):e=t;a=e;c&&a&&(e=this.nf,c in e&&delete e[c],Pb(this.yd,a),b&&(a.ke(),a.I&&fe(a.I)),c=a,c==t&&n(Error("Unable to set parent component")),c.Id=t,Cg.B.Wf.call(c,t))}a||n(Error("Child is not in parent component"));return a};function Fg(){kc.call(this)}C(Fg,kc);w=Fg.prototype;w.hg=0;w.Dd=0;w.zf=100;w.Yg=0;w.dg=1;w.ij=u;w.sj=u;w.Ld=function(a){a=Gg(this,a);this.hg!=a&&(this.hg=a+this.Yg>this.zf?this.zf-this.Yg:a<this.Dd?this.Dd:a,!this.ij&&!this.sj&&this.dispatchEvent("change"))};w.qe=function(){return Gg(this,this.hg)};w.pe=function(){return Gg(this,this.Dd)};w.oe=function(){return Gg(this,this.zf)};function Gg(a,b){return a.dg==t?b:a.Dd+Math.round((b-a.Dd)/a.dg)*a.dg};function Hg(a){Cg.call(this,a);this.Jd=new Fg;I(this.Jd,"change",this.Zi,u,this)}C(Hg,Cg);var Ig={vertical:"progress-bar-vertical",horizontal:"progress-bar-horizontal"};w=Hg.prototype;w.Tc=function(){this.wb=this.ne().Tc("div","progress-bar-thumb");var a=Ig[this.Mh];this.I=this.ne().Tc("div",a,this.wb);Jg(this);a=this.pe();this.s().setAttribute("aria-valuemin",a);a=this.oe();this.s().setAttribute("aria-valuemax",a)};
w.je=function(){Hg.B.je.call(this);lb&&7>ub&&I(this.s(),"resize",this.Fe,u,this);this.Fe();var a=this.s();a.setAttribute("role","progressbar");a.setAttribute("aria-live","polite")};w.ke=function(){Hg.B.ke.call(this);lb&&7>ub&&cc(this.s(),"resize",this.Fe,u,this)};w.qe=function(){return this.Jd.qe()};w.Ld=function(a){this.Jd.Ld(a);this.s()&&Jg(this)};function Jg(a){var b=a.qe();a.s().setAttribute("aria-valuenow",b)}w.pe=function(){return this.Jd.pe()};w.oe=function(){return this.Jd.oe()};w.Mh="horizontal";
w.Zi=function(){this.Fe();this.dispatchEvent("change")};w.Fe=function(){if(this.wb){var a=this.pe(),b=this.oe(),a=(this.qe()-a)/(b-a),b=Math.round(100*a);"vertical"==this.Mh?lb&&7>ub?(this.wb.style.top=0,this.wb.style.height="100%",b=this.wb.offsetHeight,a=Math.round(a*b),this.wb.style.top=b-a+"px",this.wb.style.height=a+"px"):(this.wb.style.top=100-b+"%",this.wb.style.height=b+"%"):this.wb.style.width=b+"%"}};function Kg(a,b){a==t&&n(Error("No valid parent element."));b==t&&n(Error("Invalid initial value."));Hg.call(this);this.f="progressbar";this.Ya=a;this.Ue="";this.Qd=this.Db=t;this.ec=[];var c;c=".progress-bar-horizontal {\n  position: relative;\n  border: 1px solid #949dad;\n";c+="  background: white;\n";c+="  padding: 1px;\n";c+="  overflow: hidden;\n";c+="  margin: 2px;\n";c+="  width: 100px;\n";c+="  height: 5px;\n";c+="}";var e;e=".progress-bar-thumb {\n  position: relative;\n  background: #F62217;\n";
e+="  overflow: hidden;\n";e+="  width: 0%;\n";e+="  height: 100%;\n";e+="}";var d;d=".progress-bar-thumb-done {\n  background: #57E964;\n}";this.ec=[c,e,d];this.Ld(b);this.uf()}C(Kg,Hg);
Kg.prototype.uf=function(){var a=ne(this.Ya,"position");if("static"==a||""==a)this.Ue=this.Ya.style.position,this.Ya.style.position="relative";var a=document.getElementsByTagName("head")[0],b=de("style");b.type="text/css";b.media="screen";var c=document.createTextNode(String(this.ec[0])),e=document.createTextNode(String(this.ec[1])),d=document.createTextNode(String(this.ec[2]));a.appendChild(b);b.appendChild(c);b.appendChild(e);b.appendChild(d);this.Db=b;this.cc(this.Ya);a=this.s();a.style.position=
"absolute";a.style.top=(this.Ya.clientHeight-5)/2+"px";a.style.left=(this.Ya.clientWidth-100)/2+"px";a.classList.add("xtk-progress-bar")};function Lg(a){var b=a.s().style.top,c=a.s().style.left;fe(a.s());var e=new Kg(a.Ya,100),d=e.s();d.style.position="absolute";d.style.top=b;d.style.left=c;d.classList.add("xtk-progress-bar");(d.firstElementChild!=p?d.firstElementChild:ge(d.firstChild)).classList.add("progress-bar-thumb-done");a.Qd=e}
Kg.prototype.Cd=function(){this.Db&&fe(this.Db);this.s()&&fe(this.s());this.Qd&&fe(this.Qd.s());this.Qd=this.Db=t;this.Ue&&(this.Ya.style.position=this.Ue)};function Mg(a,b,c){na(a)?c&&(a=va(a,c)):a&&"function"==typeof a.handleEvent?a=va(a.handleEvent,a):n(Error("Invalid listener argument"));return 2147483647<b?-1:fa.setTimeout(a,b||0)};function Ng(){K.call(this);this.f="renderer";this.u=window.document.body;this.G=this.u.clientWidth;this.v=this.u.clientHeight;this.U=this.N=this.ra=t;this.ub=new vg(nd);this.mb=[];this.$=t;this.Xd=this.bd=this.Vd=u;this.a=this.Vb=this.Ka=t;this.S={PROGRESSBAR_ENABLED:q,INTERMEDIATE_RENDERING:u,SLICENAVIGATORS:q};this.He=-1;window.console.log("XTK release 10 -- 2014-11-26 11:34:41 -- http://www.goXTK.com -- @goXTK")}C(Ng,K);w=Ng.prototype;
w.Ef=function(){window.cancelAnimationFrame(this.He);this.S.PROGRESSBAR_ENABLED&&(this.Vb=new Kg(this.u,3))};w.Ff=function(){this.S.PROGRESSBAR_ENABLED&&this.Vb&&(Lg(this.Vb),this.Nd=Mg(function(){this.Nd=t;this.Vb&&(this.Vb.Cd(),this.Vb=t);this.bd=this.Xd=q;this.cc()}.bind(this),700))};w.Gf=function(a){this.Vb&&this.Vb.Ld(100*a.wd)};w.Mj=function(a){this.Ka&&this.Ka.Ld(100*a.wd)};w.Cj=function(a){a!=t&&a instanceof ld&&a.F&&this.xb(a.F)};w.Nj=function(a){a!=t&&a instanceof md&&a.F&&this.remove(a.F)};
w.If=function(a){(a==t||!(a instanceof Ld))&&n(Error("Invalid hover event."))};w.Jf=function(){var a=be(this.u);this.G=a.clientWidth;this.v=a.clientHeight;a=be(this.ra);a.width=this.G;a.height=this.v;"renderer3D"==this.f&&(this.a.viewport(0,0,this.G,this.v),this.N.Ve=D.g.yf(D.g.Bd(),this.N.pg,this.ra.width/this.ra.height,1,1E4))};w.Kf=function(a){(a==t||!(a instanceof Kd))&&n(Error("Invalid scroll event."))};Ng.prototype.__defineGetter__("config",v("S"));
Ng.prototype.__defineGetter__("interactor",v("U"));Ng.prototype.__defineGetter__("camera",v("N"));Ng.prototype.__defineGetter__("loadingCompleted",v("bd"));Ng.prototype.__defineGetter__("container",v("u"));Ng.prototype.__defineSetter__("container",function(a){a==t&&n(Error("An ID to a valid container (<div>..) is required."));var b=a;ma(b)&&(b=be(a));pa(b)&&1==b.nodeType||n(Error("Could not find the given container."));this.u=b});w=Ng.prototype;w.Kd=function(){this.N.reset()};
w.Aa=function(a){var b=de("canvas");this.u.appendChild(b);this.G=this.u.clientWidth;this.v=this.u.clientHeight;b.width=this.G;b.height=this.v;window.console.log("-RRR  renderer init:"+a+"(width/"+this.G+")(height/"+this.v+")");try{var c=b.getContext(a);c||n(Error())}catch(e){var d="Sorry, "+a+' context is <strong>not supported</strong> on this machine! See <a href="http://crash.goXTK.com" target="_blank">http://crash.goXTK.com</a> for requirements..';this.u.innerHTML='<h3 style="color:red;font-family:sans-serif;">Oooops..</h3><p style="color:red;font-family:sans-serif;">'+
d+"</p>";n(Error(d))}this.$=new lg;I(this.$,Ad,this.Mj.bind(this));this.ra=b;this.a=c;b=new Ke(this.ra);"2d"==a&&(b=new Me(this.ra));b.Aa();I(b,wd,this.Kd.bind(this));I(b,Bd,this.If.bind(this));I(b,vd,this.Kf.bind(this));this.U=b;b=new Oe(this.G,this.v);"2d"==a&&(b=new bf(this.G,this.v));b.observe(this.U);this.N=b;I(window,"resize",this.Jf,u,this)};w.add=function(a){(a instanceof ug||a instanceof sg||a instanceof qg)&&a.q();this.mb.push(a);this.xb(a)};
w.remove=function(a){(!this.ra||!this.a)&&n(Error("The renderer was not initialized properly."));if(a!=t){var b=0;if(a!=t){if(a=qa(a),Yb[a]){a=Yb[a];for(var c=a.length-1;0<=c;c--)dc(a[c].key),b++}}else Na(Wb,function(a,c){dc(c);b++})}return u};
w.xb=function(a){(!this.ra||!this.a)&&n(Error("The renderer was not initialized properly."));a!=t&&(fc(a,yd)||I(a,yd,this.Cj.bind(this)),fc(a,zd)||I(a,zd,this.Nj.bind(this)),fc(a,Dd)||I(a,Dd,this.Ef.bind(this)),fc(a,Fd)||I(a,Fd,this.Gf.bind(this)),fc(a,Ed)||I(a,Ed,this.Ff.bind(this)))};w.get=function(a){a==t&&n(Error("Invalid object id."));for(var b=this.ub.J,c=b.length,e=0,e=0;e<c;e++)if(b[e].xa==a)return b[e];return t};
w.cc=function(){(!this.ra||!this.a)&&n(Error("The renderer was not initialized properly."));if(this.Eg==t){if(Cc(this.$.Gc)){if(this.S.PROGRESSBAR_ENABLED&&!this.Ka&&(this.Ka=new Kg(this.u,3)),this.Xd=this.bd=u,this.Eg=Mg(function(){this.Eg=t;this.cc()}.bind(this),100),!this.S.INTERMEDIATE_RENDERING)return}else if(!this.bd&&!this.Xd&&(this.Xd=q,eval("this.onShowtime()"),this.bd=q),this.Ka){this.S.PROGRESSBAR_ENABLED&&(this.Ka&&!this.Nd)&&(Lg(this.Ka),this.Nd=Mg(function(){this.Nd=t;this.Ka&&(this.Ka.Cd(),
this.Ka=t);this.cc()}.bind(this),700));return}this.He=window.requestAnimationFrame(this.cc.bind(this));eval("this.onRender()");this.dc(u,q);eval("this.afterRender()")}};w.Lh=aa();w.Jh=aa();w.Jg=aa();w.dc=aa();
w.he=function(){window.cancelAnimationFrame(this.He);this.$&&(delete this.$,this.$=t);this.Ka&&(this.Ka.Cd(),delete this.Ka,this.Ka=t);this.ub.clear();delete this.ub;this.mb.length=0;delete this.mb;delete this.$;this.$=t;delete this.N;this.N=t;delete this.U;this.U=t;delete this.a;this.a=t;fe(this.ra);delete this.ra;this.ra=t};function Og(a,b,c,e,d,f,g,h){var l,j;if(l=c.offsetParent){var k="HTML"==l.tagName||"BODY"==l.tagName;if(!k||"static"!=oe(l,"position"))j=te(l),k||(k=(k=ue(l))&&mb?-l.scrollLeft:k&&(!lb||!Eb("8"))&&"visible"!=oe(l,"overflowX")?l.scrollWidth-l.clientWidth-l.scrollLeft:l.scrollLeft,j=Yd(j,new Xd(k,l.scrollTop)))}l=j||new Xd;j=te(a);k=ye(a);j=new le(j.x,j.y,k.width,k.height);(k=se(a))&&j.sh(new le(k.left,k.top,k.right-k.left,k.bottom-k.top));var k=Zd(a),m=Zd(c);if(k.la!=m.la){var r=k.la.body,m=m.la.parentWindow||
m.la.defaultView,s=new Xd(0,0),y=ae(r)?ae(r).parentWindow||ae(r).defaultView:window,z=r;do{var F=y==m?te(z):ve(z);s.x+=F.x;s.y+=F.y}while(y&&y!=m&&(z=y.frameElement)&&(y=y.parent));r=Yd(s,te(r));lb&&!ie(k)&&(r=Yd(r,je(k)));j.left+=r.x;j.top+=r.y}a=(b&4&&ue(a)?b^2:b)&-5;b=new Xd(a&2?j.left+j.width:j.left,a&1?j.top+j.height:j.top);b=Yd(b,l);d&&(b.x+=(a&2?-1:1)*d.x,b.y+=(a&1?-1:1)*d.y);var G;if(g&&(G=se(c)))G.top-=l.y,G.right-=l.x,G.bottom-=l.y,G.left-=l.x;return Pg(b,c,e,f,G,g,h)}
function Pg(a,b,c,e,d,f,g){a=a.l();var h=0,l=(c&4&&ue(b)?c^2:c)&-5;c=ye(b);g=g?g.l():c.l();if(e||0!=l)l&2?a.x-=g.width+(e?e.right:0):e&&(a.x+=e.left),l&1?a.y-=g.height+(e?e.bottom:0):e&&(a.y+=e.top);if(f){if(d){h=a;e=0;if(65==(f&65)&&(h.x<d.left||h.x>=d.right))f&=-2;if(132==(f&132)&&(h.y<d.top||h.y>=d.bottom))f&=-5;h.x<d.left&&f&1&&(h.x=d.left,e|=1);h.x<d.left&&(h.x+g.width>d.right&&f&16)&&(g.width=Math.max(g.width-(h.x+g.width-d.right),0),e|=4);h.x+g.width>d.right&&f&1&&(h.x=Math.max(d.right-g.width,
d.left),e|=1);f&2&&(e|=(h.x<d.left?16:0)|(h.x+g.width>d.right?32:0));h.y<d.top&&f&4&&(h.y=d.top,e|=2);h.y<=d.top&&(h.y+g.height<d.bottom&&f&32)&&(g.height=Math.max(g.height-(d.top-h.y),0),h.y=0,e|=8);h.y>=d.top&&(h.y+g.height>d.bottom&&f&32)&&(g.height=Math.max(g.height-(h.y+g.height-d.bottom),0),e|=8);h.y+g.height>d.bottom&&f&4&&(h.y=Math.max(d.bottom-g.height,d.top),e|=2);f&8&&(e|=(h.y<d.top?64:0)|(h.y+g.height>d.bottom?128:0));h=e}else h=256;if(h&496)return h}f=a;d=mb&&(cb||sb)&&Eb("1.9");f instanceof
Xd?(a=f.x,f=f.y):(a=f,f=p);b.style.left=xe(a,d);b.style.top=xe(f,d);if(!(c==g||(!c||!g?0:c.width==g.width&&c.height==g.height)))a=ie(Zd(ae(b))),lb&&(!a||!Eb("8"))?(c=b.style,a?(lb?(a=Ce(b,"paddingLeft"),d=Ce(b,"paddingRight"),f=Ce(b,"paddingTop"),e=Ce(b,"paddingBottom"),a=new ke(f,d,e,a)):(a=ne(b,"paddingLeft"),d=ne(b,"paddingRight"),f=ne(b,"paddingTop"),e=ne(b,"paddingBottom"),a=new ke(parseFloat(f),parseFloat(d),parseFloat(e),parseFloat(a))),lb?(d=Ee(b,"borderLeft"),f=Ee(b,"borderRight"),e=Ee(b,
"borderTop"),b=Ee(b,"borderBottom"),b=new ke(e,f,b,d)):(d=ne(b,"borderLeftWidth"),f=ne(b,"borderRightWidth"),e=ne(b,"borderTopWidth"),b=ne(b,"borderBottomWidth"),b=new ke(parseFloat(e),parseFloat(f),parseFloat(b),parseFloat(d))),c.pixelWidth=g.width-b.left-a.left-a.right-b.right,c.pixelHeight=g.height-b.top-a.top-a.bottom-b.bottom):(c.pixelWidth=g.width,c.pixelHeight=g.height)):(b=b.style,mb?b.MozBoxSizing="border-box":ob?b.WebkitBoxSizing="border-box":b.boxSizing="border-box",b.width=Math.max(g.width,
0)+"px",b.height=Math.max(g.height,0)+"px");return h};function Qg(){}Qg.prototype.pb=aa();function Rg(a,b){this.of=a instanceof Xd?a:new Xd(a,b)}C(Rg,Qg);Rg.prototype.pb=function(a,b,c,e){Og(pe(a),0,a,b,this.of,c,t,e)};function Sg(a,b,c){this.element=a;this.Tg=b;this.bk=c}C(Sg,Qg);Sg.prototype.pb=function(a,b,c){Og(this.element,this.Tg,a,b,p,c,this.bk)};function Tg(a,b){kc.call(this);this.Gb=new yg(this);this.Vf(a||t);b&&(this.Xc=b)}C(Tg,kc);w=Tg.prototype;w.I=t;w.Gi=q;w.Kg=t;w.La=u;w.jk=u;w.wf=-1;w.vh=-1;w.dj=u;w.Oi=q;w.Xc="toggle_display";w.s=v("I");w.Vf=function(a){this.La&&n(Error("Can not change this state of the popup while showing."));this.I=a};
function Ug(a,b){a.Ee&&a.Ee.stop();a.re&&a.re.stop();if(b){if(!a.La&&a.Df()){a.I||n(Error("Caller must call setElement before trying to show the popup"));a.pb();var c=ae(a.I);a.dj&&Ag(a.Gb,c,"keydown",a.Aj,q);if(a.Gi)if(Ag(a.Gb,c,"mousedown",a.Hh,q),lb){var e;try{e=c.activeElement}catch(d){}for(;e&&"IFRAME"==e.nodeName;){try{var f=e.contentDocument||e.contentWindow.document}catch(g){break}c=f;e=c.activeElement}Ag(a.Gb,c,"mousedown",a.Hh,q);Ag(a.Gb,c,"deactivate",a.Gh)}else Ag(a.Gb,c,"blur",a.Gh);
"toggle_display"==a.Xc?(a.I.style.visibility="visible",Ae(a.I,q)):"move_offscreen"==a.Xc&&a.pb();a.La=q;a.Ee?(bc(a.Ee,"end",a.Kh,u,a),a.Ee.play()):a.Kh()}}else Vg(a)}w.pb=ga;function Vg(a,b){if(!a.La||!a.dispatchEvent({type:"beforehide",target:b}))return u;a.Gb&&a.Gb.Uf();a.La=u;a.vh=xa();a.re?(bc(a.re,"end",wa(a.Sg,b),u,a),a.re.play()):a.Sg(b);return q}w.Sg=function(a){"toggle_display"==this.Xc?this.jk?Mg(this.ih,0,this):this.ih():"move_offscreen"==this.Xc&&(this.I.style.top="-10000px");this.Hf(a)};
w.ih=function(){this.I.style.visibility="hidden";Ae(this.I,u)};w.Df=function(){return this.dispatchEvent("beforeshow")};w.Kh=function(){this.wf=xa();this.vh=-1;this.dispatchEvent("show")};w.Hf=function(a){this.dispatchEvent({type:"hide",target:a})};w.Hh=function(a){a=a.target;!he(this.I,a)&&((!this.Kg||he(this.Kg,a))&&!(150>xa()-this.wf))&&Vg(this,a)};w.Aj=function(a){27==a.keyCode&&Vg(this,a.target)&&(a.preventDefault(),a.stopPropagation())};
w.Gh=function(a){if(this.Oi){var b=ae(this.I);if(lb||kb){if(a=b.activeElement,!a||he(this.I,a)||"BODY"==a.tagName)return}else if(a.target!=b)return;150>xa()-this.wf||Vg(this)}};function Wg(a,b){this.fk=4;this.ve=b||p;Tg.call(this,a)}C(Wg,Tg);Wg.prototype.pb=function(){if(this.ve){var a=!this.La&&"move_offscreen"!=this.Xc,b=this.s();a&&(b.style.visibility="hidden",Ae(b,q));this.ve.pb(b,this.fk,this.Il);a&&Ae(b,u)}};function Xg(a){this.ga=new Ac;a&&this.df(a)}function Yg(a){var b=typeof a;return"object"==b&&a||"function"==b?"o"+qa(a):b.substr(0,1)+a}w=Xg.prototype;w.me=function(){return this.ga.me()};w.add=function(a){this.ga.set(Yg(a),a)};w.df=function(a){a=zc(a);for(var b=a.length,c=0;c<b;c++)this.add(a[c])};w.Uf=function(a){a=zc(a);for(var b=a.length,c=0;c<b;c++)this.remove(a[c])};w.remove=function(a){return this.ga.remove(Yg(a))};w.clear=function(){this.ga.clear()};
w.contains=function(a){a=Yg(a);return Dc(this.ga.ga,a)};w.sh=function(a){var b=new Xg;a=zc(a);for(var c=0;c<a.length;c++){var e=a[c];this.contains(e)&&b.add(e)}return b};w.Ad=function(){return this.ga.Ad()};w.l=function(){return new Xg(this)};function Zg(a,b,c){this.$b=c||(a?Zd(be(a)):Zd());Wg.call(this,this.$b.Tc("div",{style:"position:absolute;display:none;"}));this.pf=new Xd(1,1);this.ie=new Xg;a&&$g(this,a);if(b!=t)if(a=this.s(),"textContent"in a)a.textContent=b;else if(a.firstChild&&3==a.firstChild.nodeType){for(;a.lastChild!=a.firstChild;)a.removeChild(a.lastChild);a.firstChild.data=b}else{for(;c=a.firstChild;)a.removeChild(c);a.appendChild(ae(a).createTextNode(String(b)))}}C(Zg,Wg);var ah=[];w=Zg.prototype;w.Ra=t;w.className="goog-tooltip";
w.Vh=500;w.cj=0;w.ne=v("$b");function $g(a,b){b=be(b);a.ie.add(b);I(b,"mouseover",a.bj,u,a);I(b,"mouseout",a.fh,u,a);I(b,"mousemove",a.aj,u,a);I(b,"focus",a.$i,u,a);I(b,"blur",a.fh,u,a)}w.Vf=function(a){var b=this.s();b&&fe(b);Zg.B.Vf.call(this,a);a&&(b=this.$b.la.body,b.insertBefore(a,b.lastChild))};
w.Df=function(){if(!Tg.prototype.Df.call(this))return u;if(this.anchor)for(var a,b=0;a=ah[b];b++)he(a.s(),this.anchor)||Ug(a,u);0<=Kb(ah,this)||ah.push(this);a=this.s();a.className=this.className;bh(this);I(a,"mouseover",this.hh,u,this);I(a,"mouseout",this.gh,u,this);ch(this);return q};
w.Hf=function(){Pb(ah,this);for(var a=this.s(),b,c=0;b=ah[c];c++)b.anchor&&he(a,b.anchor)&&Ug(b,u);this.Nh&&dh(this.Nh);cc(a,"mouseover",this.hh,u,this);cc(a,"mouseout",this.gh,u,this);this.anchor=p;if(0==(this.Jb?this.La?4:1:this.Vc?3:this.La?2:0))this.Be=u;Tg.prototype.Hf.call(this)};w.Ah=function(a,b){this.anchor==a&&this.ie.contains(this.anchor)&&(this.Be||!this.Sl?(Ug(this,u),this.La||(this.anchor=a,this.ve=b||eh(this,0)||p,this.La&&this.pb(),Ug(this,q))):this.anchor=p);this.Jb=p};
w.rj=function(a){this.Vc=p;a==this.anchor&&(this.Ra==t||this.Ra!=this.s()&&!this.ie.contains(this.Ra))&&(!this.Pg||!this.Pg.Ra)&&Ug(this,u)};function fh(a,b){var c=je(a.$b);a.pf.x=b.clientX+c.x;a.pf.y=b.clientY+c.y}w.bj=function(a){var b=gh(this,a.target);this.Ra=b;bh(this);b!=this.anchor&&(this.anchor=b,this.Jb||(this.Jb=Mg(va(this.Ah,this,b,p),this.Vh)),hh(this),fh(this,a))};function gh(a,b){try{for(;b&&!a.ie.contains(b);)b=b.parentNode;return b}catch(c){return t}}
w.aj=function(a){fh(this,a);this.Be=q};w.$i=function(a){this.Ra=a=gh(this,a.target);this.Be=q;if(this.anchor!=a){this.anchor=a;var b=eh(this,1);bh(this);this.Jb||(this.Jb=Mg(va(this.Ah,this,a,b),this.Vh));hh(this)}};function eh(a,b){if(0==b){var c=a.pf.l();return new ih(c)}return new jh(a.Ra)}function hh(a){if(a.anchor)for(var b,c=0;b=ah[c];c++)he(b.s(),a.anchor)&&(b.Pg=a,a.Nh=b)}
w.fh=function(a){var b=gh(this,a.target),c=gh(this,a.relatedTarget);b!=c&&(b==this.Ra&&(this.Ra=t),ch(this),this.Be=u,this.La&&(!a.relatedTarget||!he(this.s(),a.relatedTarget))?dh(this):this.anchor=p)};w.hh=function(){var a=this.s();this.Ra!=a&&(bh(this),this.Ra=a)};w.gh=function(a){var b=this.s();if(this.Ra==b&&(!a.relatedTarget||!he(b,a.relatedTarget)))this.Ra=t,dh(this)};function ch(a){a.Jb&&(fa.clearTimeout(a.Jb),a.Jb=p)}
function dh(a){if(2==(a.Jb?a.La?4:1:a.Vc?3:a.La?2:0))a.Vc=Mg(va(a.rj,a,a.anchor),a.cj)}function bh(a){a.Vc&&(fa.clearTimeout(a.Vc),a.Vc=p)}function ih(a,b){Rg.call(this,a,b)}C(ih,Rg);ih.prototype.pb=function(a,b,c){b=pe(a);b=se(b);c=c?new ke(c.top+10,c.right,c.bottom,c.left+10):new ke(10,0,0,10);Pg(this.of,a,4,c,b,9)&496&&Pg(this.of,a,4,c,b,5)};function jh(a){Sg.call(this,a,3)}C(jh,Sg);
jh.prototype.pb=function(a,b,c){var e=new Xd(10,0);Og(this.element,this.Tg,a,b,e,c,9)&496&&Og(this.element,2,a,1,e,c,5)};function kh(a,b,c,e){a==t&&n(Error("No valid parent element."));(!x(b)||!x(c))&&n(Error("Invalid coordinates."));(e==t||!(e instanceof Ie))&&n(Error("Invalid interactor."));Zg.call(this);this.f="caption";this.Ya=a;this.de=b;this.ee=c;this.U=e;this.Db=t;this.ec=[];a=".x-tooltip {\n  background: #C0C0FF;\n  color: #000000;\n";a+="  border: 1px solid infotext;\n";a+="  padding: 1px;\n";a+="  font-family: sans-serif;\n";a+="}";this.ec=[a];bc(e,Cd,this.Cd.bind(this));this.uf()}C(kh,Zg);
kh.prototype.uf=function(){var a=ne(this.Ya,"position");if("static"==a||""==a)this.Ya.style.position="relative";var a=document.getElementsByTagName("head")[0],b=de("style");b.type="text/css";b.media="screen";var c=document.createTextNode(String(this.ec[0]));a.appendChild(b);b.appendChild(c);this.Db=b;this.ve=new Rg(this.de,this.ee)||p;this.La&&this.pb();Ug(this,q);$g(this,this.Ya);this.s().classList.add("x-tooltip")};
kh.prototype.Cd=function(){Ug(this,u);this.Db&&fe(this.Db);this.s()&&fe(this.s());this.Db=t};function lh(){Ng.call(this);this.f="renderer3D";this.fd=this.jd=this.ed=this.hd=this.dd=this.gd=this.Ye=this.Ze=t;this.C=[0,0,0];this.Yc=[0,0,0];this.Cg=t;this.Je=new Ac;this.td=new Ac;this.jc=new Ac;this.kd=new Ac;this.zc=new Ac;this.Kc=new Ac;this.ic=new Ac;this.Rc=new Ac;this.S={PROGRESSBAR_ENABLED:q,PICKING_ENABLED:q,ORDERING_ENABLED:q,STATISTICS_ENABLED:u,INTERMEDIATE_RENDERING:u}}C(lh,Ng);lh.prototype.__defineGetter__("config",v("S"));w=lh.prototype;
w.gk=function(){this.fd=this.jd=this.ed=this.hd=this.dd=this.gd=t;this.C=[0,0,0]};w.If=function(a){lh.B.If.call(this,a);var b=a.de;a=a.ee;var c=this.Nf(b,a);if(c=this.get(c))if(c=c.yc){var e=ve(this.u);(new kh(this.u,e.x+b+10,e.y+a+10,this.U)).s().innerHTML=c}};
w.Aa=function(){lh.B.Aa.call(this,"experimental-webgl");try{if(this.a.viewport(0,0,this.G,this.v),this.a.clearColor(this.Yc[0],this.Yc[1],this.Yc[2],0),this.a.enable(this.a.BLEND),this.a.blendEquation(this.a.FUNC_ADD),this.a.blendFunc(this.a.SRC_ALPHA,this.a.ONE_MINUS_SRC_ALPHA),this.a.enable(this.a.DEPTH_TEST),this.a.depthFunc(this.a.LEQUAL),this.a.clear(this.a.COLOR_BUFFER_BIT|this.a.DEPTH_BUFFER_BIT),this.S.PICKING_ENABLED){var a=this.a.createFramebuffer(),b=this.a.createRenderbuffer(),c=this.a.createTexture();
this.a.bindTexture(this.a.TEXTURE_2D,c);this.a.texImage2D(this.a.TEXTURE_2D,0,this.a.RGB,this.G,this.v,0,this.a.RGB,this.a.UNSIGNED_BYTE,t);this.a.texParameteri(this.a.TEXTURE_2D,this.a.TEXTURE_WRAP_S,this.a.CLAMP_TO_EDGE);this.a.texParameteri(this.a.TEXTURE_2D,this.a.TEXTURE_WRAP_T,this.a.CLAMP_TO_EDGE);this.a.texParameteri(this.a.TEXTURE_2D,this.a.TEXTURE_MAG_FILTER,this.a.NEAREST);this.a.texParameteri(this.a.TEXTURE_2D,this.a.TEXTURE_MIN_FILTER,this.a.NEAREST);this.a.bindFramebuffer(this.a.FRAMEBUFFER,
a);this.a.bindRenderbuffer(this.a.RENDERBUFFER,b);this.a.renderbufferStorage(this.a.RENDERBUFFER,this.a.DEPTH_COMPONENT16,this.G,this.v);this.a.bindRenderbuffer(this.a.RENDERBUFFER,t);this.a.framebufferTexture2D(this.a.FRAMEBUFFER,this.a.COLOR_ATTACHMENT0,this.a.TEXTURE_2D,c,0);this.a.framebufferRenderbuffer(this.a.FRAMEBUFFER,this.a.DEPTH_ATTACHMENT,this.a.RENDERBUFFER,b);this.a.bindFramebuffer(this.a.FRAMEBUFFER,t);this.Cg=a}}catch(e){n(Error("Exception while accessing GL Context!\n"+e))}a=new cf;
(this.ra==t||this.a==t||this.N==t)&&n(Error("Renderer was not initialized properly."));(a==t||!(a instanceof cf))&&n(Error("Could not add shaders."));b=Object.keys(ef);Object.keys(df).every(function(a){a=df[a];return-1!=this.ae.search(a)||-1!=this.Rd.search(a)}.bind(a))||n(Error("Could not find all attributes in the shader sources."));b.every(function(a){a=ef[a];return-1!=this.ae.search(a)||-1!=this.Rd.search(a)}.bind(a))||n(Error("Could not find all uniforms in the shader sources."));b=this.a.createShader(this.a.FRAGMENT_SHADER);
c=this.a.createShader(this.a.VERTEX_SHADER);this.a.shaderSource(b,a.Rd);this.a.shaderSource(c,a.ae);this.a.compileShader(b);this.a.compileShader(c);this.a.getShaderParameter(b,this.a.COMPILE_STATUS)||n(Error("Fragement Shader compilation failed!\n"+this.a.getShaderInfoLog(b)));this.a.getShaderParameter(c,this.a.COMPILE_STATUS)||n(Error("Vertex Shader compilation failed!\n"+this.a.getShaderInfoLog(c)));var d=this.a.createProgram();this.a.attachShader(d,c);this.a.attachShader(d,b);this.a.linkProgram(d);
this.a.getProgramParameter(d,this.a.LINK_STATUS)||n(Error("Could not create shader program!\n"+this.a.getShaderInfoLog(b)+"\n"+this.a.getShaderInfoLog(c)+"\n"+this.a.getProgramInfoLog(d)));this.a.useProgram(d);this.Ye=d;Object.keys(df).forEach(function(a){a=df[a];this.Je.set(a,this.a.getAttribLocation(this.Ye,a));this.a.enableVertexAttribArray(this.Je.get(a))}.bind(this));Object.keys(ef).forEach(function(a){a=ef[a];this.td.set(a,this.a.getUniformLocation(this.Ye,a))}.bind(this));this.Ze=a};
w.xb=function(a){lh.B.xb.call(this,a);var b=u;if(a!=t){this.get(a.xa)&&(b=q);var c=a.xa,e=a.h,d=a.n,f=a.pa,g=a.H,h=a.r,l=a.ka,j=a.Da,k=a.e,m=a.K;if(k!=t&&k.r!=t&&k.r.j)this.xb(k);else if(k!=t&&k.j&&this.xb(k),j!=t&&j.r!=t&&j.r.j)this.$.load(j,a);else if(g!=t&&g.r!=t&&g.r.j)this.$.load(g,a);else{if(h!=t&&ka(h))if(a.sc!=t){if(a.sc.xf!=h.length||!a.j)return}else{b=0;c=h.length;for(b=0;b<c;b++)this.$.load(h[b],a);return}else{if(h!=t&&h.j){this.$.load(a,a);return}if(m!=t&&m.r!=t&&m.r.j){this.$.load(m,
a);return}}if(0<a.c.length){h=a.c;j=h.length;for(k=k=0;k<j;k++)this.xb(h[k])}if(e){for(h=0;this.Vd;)h++,window.console.log("Possible thread lock avoided: "+h);this.Vd=q;j=a instanceof We&&a.Eb instanceof gf;b&&(g!=t&&g.j)&&(h=this.ic.get(c),h!=t&&this.a.isBuffer(h.Q)&&this.a.deleteBuffer(h.Q));h=t;g!=t&&(!b||g.j?(h=a.Qc,h==t&&n(Error("Can not add an object and texture without valid coordinate mapping! Set the textureCoordinateMap!")),k=u,g.Wb&&(k=q),this.a.pixelStorei(this.a.UNPACK_FLIP_Y_WEBGL,k),
k=this.a.createTexture(),k.gj=g.rb,this.Rc.set(g.xa,k),this.a.bindTexture(this.a.TEXTURE_2D,k),g.Wb?(k=this.a.RGBA,g.sg&&(k=this.a.LUMINANCE,this.a.pixelStorei(this.a.UNPACK_ALIGNMENT,1)),this.a.texImage2D(this.a.TEXTURE_2D,0,k,g.Xe,g.We,0,k,this.a.UNSIGNED_BYTE,g.Wb)):this.a.texImage2D(this.a.TEXTURE_2D,0,this.a.RGBA,this.a.RGBA,this.a.UNSIGNED_BYTE,k.gj),this.a.texParameteri(this.a.TEXTURE_2D,this.a.TEXTURE_WRAP_S,this.a.CLAMP_TO_EDGE),this.a.texParameteri(this.a.TEXTURE_2D,this.a.TEXTURE_WRAP_T,
this.a.CLAMP_TO_EDGE),j?(this.a.texParameteri(this.a.TEXTURE_2D,this.a.TEXTURE_MAG_FILTER,this.a.NEAREST),this.a.texParameteri(this.a.TEXTURE_2D,this.a.TEXTURE_MIN_FILTER,this.a.NEAREST)):(this.a.texParameteri(this.a.TEXTURE_2D,this.a.TEXTURE_MAG_FILTER,this.a.LINEAR),this.a.texParameteri(this.a.TEXTURE_2D,this.a.TEXTURE_MIN_FILTER,this.a.LINEAR)),this.a.bindTexture(this.a.TEXTURE_2D,t),k=this.a.createBuffer(),this.a.bindBuffer(this.a.ARRAY_BUFFER,k),this.a.bufferData(this.a.ARRAY_BUFFER,new Float32Array(h),
this.a.STATIC_DRAW),h=new Sd(k,h.length,2),this.ic.set(c,h),g.j=u):h=this.ic.get(c));mg(this.$,0.1);if(j)this.Vd=u,D.Ba(this.f+".update"),mg(this.$,0.9);else{if(!b||e.j||l.j){j=l.R;g=D.g.aa(j,e.ib,e.jb,e.kb);j=D.g.aa(j,e.fb,e.gb,e.hb);if(this.gd===t||g.x<this.gd)this.gd=g.x;if(this.dd===t||j.x>this.dd)this.dd=j.x;if(this.hd===t||g.y<this.hd)this.hd=g.y;if(this.ed===t||j.y>this.ed)this.ed=j.y;if(this.jd===t||g.d<this.jd)this.jd=g.d;if(this.fd===t||j.d>this.fd)this.fd=j.d;this.C=[(this.gd+this.dd)/
2,(this.hd+this.ed)/2,(this.jd+this.fd)/2];l.j=u}b&&e.j&&(l=this.jc.get(c),l!=t&&this.a.isBuffer(l.Q)&&this.a.deleteBuffer(l.Q));l=t;!b||e.j?(l=this.a.createBuffer(),e.Ib(),this.a.bindBuffer(this.a.ARRAY_BUFFER,l),this.a.bufferData(this.a.ARRAY_BUFFER,e.ca,this.a.STATIC_DRAW),l=new Sd(l,e.count,3),e.j=u):l=this.jc.get(c);mg(this.$,0.3);b&&d.j&&(g=this.jc.get(c),g!=t&&this.a.isBuffer(g.Q)&&this.a.deleteBuffer(g.Q));g=t;!b||d.j?(g=this.a.createBuffer(),d.Ib(),this.a.bindBuffer(this.a.ARRAY_BUFFER,g),
this.a.bufferData(this.a.ARRAY_BUFFER,d.ca,this.a.STATIC_DRAW),g=new Sd(g,d.count,3),d.j=u):g=this.kd.get(c);mg(this.$,0.3);b&&(f&&f.j)&&(d=this.zc.get(c),d!=t&&this.a.isBuffer(d.Q)&&this.a.deleteBuffer(d.Q));d=t;f&&(!b||f.j?(f.length!=e.length&&n(Error("Mismatch between points and point colors.")),d=this.a.createBuffer(),f.Ib(),this.a.bindBuffer(this.a.ARRAY_BUFFER,d),this.a.bufferData(this.a.ARRAY_BUFFER,f.ca,this.a.STATIC_DRAW),d=new Sd(d,f.count,3),f.j=u):d=this.zc.get(c));mg(this.$,0.2);b&&(m&&
m.j)&&(f=this.Kc.get(c),f!=t&&this.a.isBuffer(f.Q)&&this.a.deleteBuffer(f.Q));f=t;m&&(f=m.$c,!b||m.j?(f.length!=e.length&&n(Error("Mismatch between points and scalars.")),e=this.a.createBuffer(),this.a.bindBuffer(this.a.ARRAY_BUFFER,e),this.a.bufferData(this.a.ARRAY_BUFFER,f,this.a.STATIC_DRAW),f=new Sd(e,f.length,3),m.j=u):f=this.Kc.get(c));mg(this.$,0.1);b||this.ub.add(a);this.jc.set(c,l);this.kd.set(c,g);this.zc.set(c,d);this.ic.set(c,h);this.Kc.set(c,f);this.Vd=a.j=u}}else a.j=u}}};
w.Nf=function(a,b){if(this.S.PICKING_ENABLED){this.dc(q,u);var c=new Uint8Array(4);this.a.readPixels(a,this.v-b,1,1,this.a.RGBA,this.a.UNSIGNED_BYTE,c);return c[0]+255*c[1]+65025*c[2]}return-1};
w.dc=function(a,b){lh.B.dc.call(this,a,b);window.console.log("calling rendering3d with "+this.G+" "+this.v);this.a.viewport(0,0,this.G,this.v);this.a.clear(this.a.COLOR_BUFFER_BIT|this.a.DEPTH_BUFFER_BIT);var c=this.ub.J,e=c.length;if(0!=e){a?this.a.bindFramebuffer(this.a.FRAMEBUFFER,this.Cg):this.a.bindFramebuffer(this.a.FRAMEBUFFER,t);var d=this.N.Ve,f=this.N.o;this.a.uniformMatrix4fv(this.td.get("perspective"),u,d);this.a.uniformMatrix4fv(this.td.get("view"),u,f);d=this.C;this.a.uniform3f(this.td.get("center"),
parseFloat(d[0]),parseFloat(d[1]),parseFloat(d[2]));f=this.mb.length;for(d=0;d<f;++d){var g=this.mb[d];if(g instanceof N){var h=D.g.aa(this.N.o,g.t[0]+g.b[0].i[0],g.t[1]+g.b[0].i[1],g.t[2]+g.b[0].i[2]),l=D.g.aa(this.N.o,g.t[0]-g.b[0].i[0],g.t[1]-g.b[0].i[1],g.t[2]-g.b[0].i[2]),j=Math.abs(h.d-l.d),h=D.g.aa(this.N.o,g.t[0]+g.b[1].i[0],g.t[1]+g.b[1].i[1],g.t[2]+g.b[1].i[2]),l=D.g.aa(this.N.o,g.t[0]-g.b[1].i[0],g.t[1]-g.b[1].i[1],g.t[2]+-g.b[1].i[2]),k=Math.abs(h.d-l.d),h=D.g.aa(this.N.o,g.t[0]+g.b[2].i[0],
g.t[1]+g.b[2].i[1],g.t[2]+g.b[2].i[2]),l=D.g.aa(this.N.o,g.t[0]-g.b[2].i[0],g.t[1]-g.b[2].i[1],g.t[2]-g.b[2].i[2]),h=Math.max(j,k,Math.abs(h.d-l.d));h==j?ff(g,0):h==k?ff(g,1):ff(g,2)}}if(this.S.ORDERING_ENABLED){j=u;f=this.mb;g=f.length-1;do if(d=f[g],d instanceof N&&d.Qa&&-1!=d.X){var j=d.c[d.X].c,k=d.X,h=D.g.aa(this.N.o,d.t[0]+d.b[k].z[0],d.t[1]+d.b[k].z[1],d.t[2]+d.b[k].z[2]),l=D.g.aa(this.N.o,d.t[0]-d.b[k].z[0],d.t[1]-d.b[k].z[1],d.t[2]-d.b[k].z[2]),h=h.d-l.d,l=Math.max(d.wc[d.X],Math.max(d.wc[d.X+
4],d.wc[d.X+8])),m=Math.min(d.wc[d.X],Math.min(d.wc[d.X+4],d.wc[d.X+8]));if(0>h*(l+m))for(h=h=0;h<d.od[k]-1;h++)j[h]&&(j[h].ta=d.ta,j[h].wa=d.b[k].Nc*h);else for(h=d.od[k]-1;0<=h;h--)j[h]&&(j[h].ta=d.ta,j[h].wa=(d.od[k]-1)*d.b[k].Nc-d.b[k].Nc*h);j=q}while(g--);f=this.ub.J;g=f.length-1;do if(d=f[g],d.P&&!(1==d.ta||d instanceof We))j=d,k=d.h.Od,d=D.g.aa(d.ka.R,k[0],k[1],k[2]),d=D.g.aa(this.N.o,d.x,d.y,d.d),d=D.m.sf(this.N.gc,d),d=Math.round(1E3*d)/1E3,j.wa=d,j=q;while(g--);j&&this.ub.sort()}if(f=!a&&
b!=t&&b&&this.S.STATISTICS_ENABLED)var r=0,s=0,y=0,z=0;var d=this.Je,g=d.get("vertexPosition"),j=d.get("vertexNormal"),k=d.get("vertexColor"),h=d.get("vertexTexturePos"),l=d.get("vertexScalar"),d=this.td,m=d.get("usePicking"),F=d.get("useObjectColor"),G=d.get("objectColor"),J=d.get("useScalars"),A=d.get("scalarsReplaceMode"),E=d.get("scalarsMin"),L=d.get("scalarsMax"),O=d.get("scalarsMinColor"),R=d.get("scalarsMaxColor"),P=d.get("scalarsInterpolation"),U=d.get("scalarsMinThreshold"),ca=d.get("scalarsMaxThreshold"),
da=d.get("objectOpacity"),M=d.get("labelmapOpacity"),oa=d.get("labelmapColor"),H=d.get("useTexture"),Oa=d.get("useLabelMapTexture"),Fa=d.get("textureSampler"),vb=d.get("textureSampler2"),wb=d.get("volumeLowerThreshold"),xb=d.get("volumeUpperThreshold"),nb=d.get("volumeScalarMin"),bd=d.get("volumeScalarMax"),oh=d.get("volumeWindowLow"),ph=d.get("volumeWindowHigh"),qh=d.get("volumeScalarMinColor"),rh=d.get("volumeScalarMaxColor"),Dg=d.get("volumeTexture"),sh=d.get("objectTransform"),th=d.get("pointSize"),
d=e;do{var ea=c[e-d];if(ea){var ja=t;ea instanceof We&&ea.Eb&&(ja=ea.Eb);if(ea.P&&(!ja||ja.P)&&(!a||ea.ld)){var Aa=ea.xa,fb=ea.cd,Ra=this.jc.get(Aa),qb=this.kd.get(Aa),Ze=this.zc.get(Aa),Mb=this.Kc.get(Aa),$e=this.ic.get(Aa);this.a.bindBuffer(this.a.ARRAY_BUFFER,Ra.Q);this.a.vertexAttribPointer(g,Ra.Ob,this.a.FLOAT,u,0,0);this.a.bindBuffer(this.a.ARRAY_BUFFER,qb.Q);this.a.vertexAttribPointer(j,qb.Ob,this.a.FLOAT,u,0,0);a?this.a.uniform1i(m,q):this.a.uniform1i(m,u);Ze&&!a&&!fb?(this.a.uniform1i(F,
u),this.a.bindBuffer(this.a.ARRAY_BUFFER,Ze.Q),this.a.vertexAttribPointer(k,Ze.Ob,this.a.FLOAT,u,0,0)):(qb=1,fb&&!a&&(qb=0),this.a.uniform1i(F,qb),qb=ea.w,a&&(qb=[Math.floor(Aa%65025%255)/255,Math.floor(Aa%65025/255)/255,Math.floor(Aa/65025)/255]),this.a.uniform3f(G,parseFloat(qb[0]),parseFloat(qb[1]),parseFloat(qb[2])),this.a.vertexAttribPointer(k,Ra.Ob,this.a.FLOAT,u,0,0));Mb&&!a&&!fb?(this.a.uniform1i(J,q),this.a.uniform1i(A,ea.K.Fg),Aa=ea.K.Rb,fb=ea.K.Pb,this.a.uniform3f(O,parseFloat(Aa[0]),parseFloat(Aa[1]),
parseFloat(Aa[2])),this.a.uniform3f(R,parseFloat(fb[0]),parseFloat(fb[1]),parseFloat(fb[2])),this.a.uniform1f(U,parseFloat(ea.K.V)),this.a.uniform1f(ca,parseFloat(ea.K.W)),this.a.uniform1f(E,parseFloat(ea.K.Ja)),this.a.uniform1f(L,parseFloat(ea.K.ja)),this.a.uniform1i(P,parseInt(ea.K.Le,10)),this.a.bindBuffer(this.a.ARRAY_BUFFER,Mb.Q),this.a.vertexAttribPointer(l,Mb.Ob,this.a.FLOAT,u,0,0)):(this.a.uniform1i(J,u),this.a.vertexAttribPointer(l,Ra.Ob,this.a.FLOAT,u,0,0));this.a.uniform1f(da,parseFloat(ea.ta));
ea.H&&$e&&!a?(this.a.uniform1i(H,q),this.a.activeTexture(this.a.TEXTURE0),this.a.bindTexture(this.a.TEXTURE_2D,this.Rc.get(ea.H.xa)),this.a.uniform1i(Fa,0),this.a.bindBuffer(this.a.ARRAY_BUFFER,$e.Q),this.a.vertexAttribPointer(h,$e.Ob,this.a.FLOAT,u,0,0),this.a.uniform1i(Dg,u)):(this.a.uniform1i(H,u),this.a.vertexAttribPointer(h,Ra.Ob,this.a.FLOAT,u,0,0));ja&&(this.a.uniform1i(Dg,q),this.a.uniform1f(wb,ja.V),this.a.uniform1f(xb,ja.W),this.a.uniform1f(nb,ja.Ja),this.a.uniform1f(bd,ja.ja),Aa=ja.Rb,
fb=ja.Pb,this.a.uniform3f(qh,parseFloat(Aa[0]),parseFloat(Aa[1]),parseFloat(Aa[2])),this.a.uniform3f(rh,parseFloat(fb[0]),parseFloat(fb[1]),parseFloat(fb[2])),this.a.uniform1f(oh,ja.fa),this.a.uniform1f(ph,ja.ea),Mb=ja.e,this.a.uniform1i(Oa,u),ja.Qa?this.a.uniform1f(da,parseFloat(ja.ta)):Mb&&Mb.P&&(ja=ea.e.xa,this.a.uniform1i(Oa,q),this.a.activeTexture(this.a.TEXTURE1),this.a.bindTexture(this.a.TEXTURE_2D,this.Rc.get(ja)),this.a.uniform1i(vb,1),this.a.uniform1f(M,Mb.ta),this.a.uniform4fv(oa,Mb.$e)));
this.a.uniformMatrix4fv(sh,u,ea.ka.R);ja=1;"POINTS"==ea.Ga&&(ja=ea.md);this.a.uniform1f(th,ja);ja=-1;ea.Ga==id?(ja=this.a.TRIANGLES,f&&(s+=Ra.Nb/3)):"LINES"==ea.Ga?(this.a.lineWidth(ea.Hc),ja=this.a.LINES,f&&(y+=Ra.Nb/2)):"POINTS"==ea.Ga?(ja=this.a.POINTS,f&&(z+=Ra.Nb)):"TRIANGLE_STRIPS"==ea.Ga?(ja=this.a.TRIANGLE_STRIP,f&&(s+=Ra.Nb/3)):"POLYGONS"==ea.Ga&&(ja=0==Ra.Nb%3?this.a.TRIANGLES:this.a.TRIANGLE_FAN,f&&(s+=Ra.Nb/3));f&&(r+=Ra.Nb);this.a.drawArrays(ja,0,Ra.Nb)}}}while(--d);f&&(c="Objects: "+
e+" | "+("Vertices: "+r+" | "),c+="Triangles: "+Math.round(s)+" | ",c+="Lines: "+y+" | ",c+="Points: "+z+" | ",c+="Textures: "+this.Rc.me(),window.console.log(c))}};
w.remove=function(a){lh.B.remove.call(this,a);if(0<a.c.length)for(var b=a.c,c=b.length,e=0,e=0;e<c;e++)this.remove(b[e]);b=a.xa;c=this.ic.get(b);c!=t&&this.a.isBuffer(c.Q)&&this.a.deleteBuffer(c.Q);if(a.H&&(c=this.Rc.get(a.H.xa)))this.a.deleteTexture(c),this.Rc.remove(a.H.xa);c=this.jc.get(b);c!=t&&this.a.isBuffer(c.Q)&&this.a.deleteBuffer(c.Q);c=this.kd.get(b);c!=t&&this.a.isBuffer(c.Q)&&this.a.deleteBuffer(c.Q);c=this.zc.get(b);c!=t&&this.a.isBuffer(c.Q)&&this.a.deleteBuffer(c.Q);c=this.Kc.get(b);
c!=t&&this.a.isBuffer(c.Q)&&this.a.deleteBuffer(c.Q);this.jc.remove(b);this.kd.remove(b);this.zc.remove(b);this.ic.remove(b);this.Kc.remove(b);this.ub.remove(a);return q};w.he=function(){this.Ze=t;delete this.Ze;this.a.clear(this.a.COLOR_BUFFER_BIT|this.a.DEPTH_BUFFER_BIT);lh.B.he.call(this)};lh.prototype.__defineGetter__("bgColor",v("Yc"));lh.prototype.__defineSetter__("bgColor",ba("Yc"));
lh.prototype.dk=function(a,b,c,e,d){c!=t||(c=4);e!=t||(e=2);if(d==t){d=this.Nf(a,b);if(-1==d)return t;d=this.get(d);if(!d)return t}var f=Pe(this.N,2*(a/this.G)-1,2*((this.v-b)/this.v)-1,0);a=Pe(this.N,2*(a/this.G)-1,2*((this.v-b)/this.v)-1,1);f[0]+=this.C[0];f[1]+=this.C[1];f[2]+=this.C[2];a[0]+=this.C[0];a[1]+=this.C[1];a[2]+=this.C[2];b=[d.h.ib,d.h.jb,d.h.kb];var g=[d.h.fb,d.h.jb,d.h.kb],h=[d.h.fb,d.h.gb,d.h.kb],l=[d.h.ib,d.h.gb,d.h.kb],j=[d.h.ib,d.h.gb,d.h.hb],k=[d.h.ib,d.h.jb,d.h.hb],m=[d.h.fb,
d.h.gb,d.h.hb],r=[d.h.fb,d.h.jb,d.h.hb];b=[D.g.aa(d.ka.R,b[0],b[1],b[2]),D.g.aa(d.ka.R,g[0],g[1],g[2]),D.g.aa(d.ka.R,h[0],h[1],h[2]),D.g.aa(d.ka.R,l[0],l[1],l[2]),D.g.aa(d.ka.R,j[0],j[1],j[2]),D.g.aa(d.ka.R,k[0],k[1],k[2]),D.g.aa(d.ka.R,m[0],m[1],m[2]),D.g.aa(d.ka.R,r[0],r[1],r[2])];var g=[Infinity,-Infinity,Infinity,-Infinity,Infinity,-Infinity],s;for(s in b)s=b[s],g=[Math.min(g[0],s.x),Math.max(g[1],s.x),Math.min(g[2],s.y),Math.max(g[3],s.y),Math.min(g[4],s.d),Math.max(g[5],s.d)];s=g;b=[];g=[];
for(h=0;6>h;h++){var l=Math.floor(h/2),j=(l+1)%3,k=(l+2)%3,r=(2+2*l)%6,y=(4+2*l)%6,z=(s[h]-f[l])*(1/a[l]);Infinity!=z&&-Infinity!=z&&(m=f[j]+a[j]*z,z=f[k]+a[k]*z,m>=s[r]&&m<=s[r+1]&&z>=s[y]&&z<=s[y+1]?(r=[],r[l]=s[h],r[j]=m,r[k]=z,b.push(r)):(r=[],r[l]=s[h],r[j]=m,r[k]=z,g.push(r)))}a=[b,g];a=a[0];if(0==a.length)return t;g=Array(2);for(s=0;2>s;s++)b=a[s],g[s]=Math.sqrt((b[0]-f[0])*(b[0]-f[0])+(b[1]-f[1])*(b[1]-f[1])+(b[2]-f[2])*(b[2]-f[2]));f=b=s=t;g[0]<g[1]?(s=a[0],b=a[1]):(s=a[1],b=a[0]);f=Math.sqrt((s[0]-
b[0])*(s[0]-b[0])+(s[1]-b[1])*(s[1]-b[1])+(s[2]-b[2])*(s[2]-b[2]));f/=c;a=s;s=[b[0]-s[0],b[1]-s[1],b[2]-s[2]];b=Math.sqrt(s[0]*s[0]+s[1]*s[1]+s[2]*s[2]);g=[s[0]/b,s[1]/b,s[2]/b];h=d.h.ca;l=h.length;for(s=0;s<f;s+=c){a=[a[0]+c*g[0],a[1]+c*g[1],a[2]+c*g[2]];for(b=0;b<l;b+=3)if(j=h[b],k=h[b+1],m=h[b+2],r=new D.m(j,k,m),r=D.g.aa(d.ka.R,j,k,m),Math.sqrt((a[0]-r.x)*(a[0]-r.x)+(a[1]-r.y)*(a[1]-r.y)+(a[2]-r.d)*(a[2]-r.d))<=e)return[r.x,r.y,r.d]}return t};B("X.renderer3D",lh);
B("X.renderer3D.prototype.init",lh.prototype.Aa);B("X.renderer3D.prototype.add",lh.prototype.add);B("X.renderer3D.prototype.onShowtime",lh.prototype.Lh);B("X.renderer3D.prototype.onRender",lh.prototype.Jh);B("X.renderer3D.prototype.get",lh.prototype.get);B("X.renderer3D.prototype.render",lh.prototype.cc);B("X.renderer3D.prototype.destroy",lh.prototype.he);B("X.renderer3D.prototype.remove",lh.prototype.remove);B("X.renderer3D.prototype.resetBoundingBox",lh.prototype.gk);
B("X.renderer3D.prototype.resetViewAndRender",lh.prototype.Kd);B("X.renderer3D.prototype.pick",lh.prototype.Nf);B("X.renderer3D.prototype.pick3d",lh.prototype.dk);B("X.renderer3D.prototype.afterRender",lh.prototype.Jg);function mh(){V.call(this);this.f="mesh";Ga(this,new yc)}C(mh,V);B("X.mesh",mh);function nh(){V.call(this);this.f="fibers";Ga(this,new yc)}C(nh,V);B("X.fibers",nh);function Z(){Ng.call(this);this.f="renderer2D";this.Pa=t;this.Ea=-1;this.Sb=[];this.vg=this.Ud=this.qg=this.Sd=t;this.Mc=this.Pc=this.Lc=this.Oc=0;this.ea=this.fa=this.W=this.V=this.ng=-1;this.wg=new Float32Array([-255,-255,-255,-255]);this.Dg=q;this.lb=1}C(Z,Ng);Z.prototype.Pj=aa();Z.prototype.Zj=aa();Z.prototype.Kf=function(a){Z.B.Kf.call(this,a);var b=this.mb[0];if(b){var c="",c=0==this.Ea?"indexX":1==this.Ea?"indexY":"indexZ";b[c]=a.da?b[c]+1:b[c]-1;eval("this.onScroll();")}};
Z.prototype.$j=function(a){var b=this.mb[0];if(b){var c=b.ea-b.fa,e=c/2,d=parseInt(c+c/15*-a.cf,10);a=parseInt(e+e/15*a.Qe,10);c==d&&d++;e==a&&a++;b.fa-=parseInt(e-a,10);b.fa-=parseInt(c-d,10);b.fa=Math.max(b.fa,b.Ja);b.ea-=parseInt(e-a,10);b.ea+=parseInt(c-d,10);b.ea=Math.min(b.ea,b.ja);eval("this.onWindowLevel();")}};Z.prototype.__defineGetter__("orientation",v("Pa"));
Z.prototype.__defineSetter__("orientation",function(a){a=a.toUpperCase();"AXIAL"==a?(a="Z",this.Ea=2):"SAGITTAL"==a?(a="X",this.Ea=0):"CORONAL"==a&&(a="Y",this.Ea=1);"X"!=a&&("Y"!=a&&"Z"!=a)&&n(Error("Invalid orientation."));this.Pa=a});Z.prototype.__defineGetter__("radiological",v("Dg"));Z.prototype.__defineGetter__("normalizedScale",v("lb"));Z.prototype.__defineGetter__("canvasWidth",function(){return this.ra.width});Z.prototype.__defineGetter__("canvasHeight",function(){return this.ra.height});
Z.prototype.__defineGetter__("sliceWidth",v("Oc"));Z.prototype.__defineGetter__("sliceHeight",v("Lc"));Z.prototype.__defineSetter__("radiological",ba("Dg"));w=Z.prototype;w.Aa=function(){this.Pa||n(Error("No 2D orientation set."));Z.B.Aa.call(this,"2d");this.a.fillStyle="rgba(50,50,50,0)";this.a.fillRect(0,0,this.ra.width,this.ra.height);this.Sd=de("canvas");this.Ud=de("canvas");I(this.N,xd,this.$j.bind(this))};w.Jf=function(){Z.B.Jf.call(this);uh(this)};
w.Kd=function(){Z.B.Kd.call(this);uh(this);var a=this.mb[0];a&&(a.ea=a.ja,a.fa=a.Ja)};
w.xb=function(a){Z.B.xb.call(this,a);var b=u;this.get(a.xa)&&(b=q);if(a instanceof N){var c=a.r,e=a.e,d=a.Da;if(e!=t&&e.r!=t&&e.r.j)this.xb(e);else if(d!=t&&d.r!=t&&d.r.j)this.$.load(d,a);else{if(c!=t&&ka(c))if(a.sc!=t){if(a.sc.xf!=c.length||b&&!a.j)return}else{b=0;e=c.length;for(b=0;b<e;b++)this.$.load(c[b],a);return}else if(c!=t&&c.j){this.$.load(a,a);return}this.Ea="X"==this.Pa?0:"Y"==this.Pa?1:2;this.Za=a.c[this.Ea].c;d=t;d=0==this.Ea?a.indexX:1==this.Ea?a.indexY:a.indexZ;c=a.c[this.Ea].c[d].ug;
e=a.c[this.Ea].c[d].tg;this.Pc=a.c[this.Ea].c[d].Sc;this.Mc=a.c[this.Ea].c[d].Cc;this.Oc=c;this.Lc=e;d=this.Sd;d.width=c;d.height=e;var f=this.Ud;f.width=c;f.height=e;this.qg=d.getContext("2d");this.vg=f.getContext("2d");b||(this.ub.add(a),uh(this))}}};function uh(a){var b=Math.min(a.G/(a.Oc*a.Pc),a.v/(a.Lc*a.Mc));a.N.o[14]=b}w.Qj=aa();
w.gi=function(a,b){var c=this.mb[0],e=this.N.o,d=t,f=this.Oc,g=this.Lc,h=t,l=t;if("Y"==this.Pa)d=this.Za[parseInt(c.indexY,10)],h=d.Sc,l=d.Cc,this.Sb[0]="red",this.Sb[1]="blue";else if("Z"==this.Pa)d=this.Za[parseInt(c.indexZ,10)],h=d.Sc,l=d.Cc,this.Sb[0]="red",this.Sb[1]="green";else{d=this.Za[parseInt(c.indexX,10)];h=d.Cc;l=d.Sc;this.Sb[0]="green";this.Sb[1]="blue";var j=f,f=g,g=j}var k=1*e[12],m=-1*e[13];this.lb=Math.max(e[14],0.6);j=[this.G/2,this.v/2];h=f*h*this.lb;l=g*l*this.lb;e=j[0]-h/2;j=
j[1]-l/2;e+=k*this.lb;j+=m*this.lb;return a>e&&a<e+h&&b>j&&b<j+l?(k=(a-e)/h*f,m=(b-j)/l*g,l=d.Ei[4],"X"==this.Pa?(j=f-k,k=m,m=j):"Y"==this.Pa?k=f-k:"Z"==this.Pa&&(k=f-k,m=g-m),k=d.Di+k*d.Sc,m=d.xi+m*d.Cc,k=Rc(k,m,l,1),f=Sc(),cd(d.qi,k,f),g=Sc(),cd(d.ri,k,g),d=Math.round((c.b[0].i[0]*g[0]+c.b[0].i[1]*g[1]+c.b[0].i[2]*g[2]+c.b[0].Te)/c.b[0].Nc),d>=c.b[0].p?d=c.b[0].p-1:0>d&&(d=0),k=Math.round((c.b[1].i[0]*g[0]+c.b[1].i[1]*g[1]+c.b[1].i[2]*g[2]+c.b[1].Te)/c.b[1].Nc),k>=c.b[1].p?k=c.b[1].p-1:0>k&&(k=
0),m=Math.round((c.b[2].i[0]*g[0]+c.b[2].i[1]*g[1]+c.b[2].i[2]*g[2]+c.b[2].Te)/c.b[2].Nc),m>=c.b[2].p?m=c.b[2].p-1:0>m&&(m=0),[[d,k,m],[f[0],f[1],f[2]],[g[0],g[1],g[2]]]):t};
w.dc=function(a,b){Z.B.dc.call(this,a,b);if(0!=this.ub.J.length){var c=this.mb[0],e=t,e=0==this.Ea?c.indexX:1==this.Ea?c.indexY:c.indexZ,d=this.Za[parseInt(e,10)].ug,f=this.Za[parseInt(e,10)].tg;this.Pc=this.Za[parseInt(e,10)].Sc;this.Mc=this.Za[parseInt(e,10)].Cc;this.Oc=d;this.Lc=f;var g=this.G,h=this.v,l=this.N.o;this.a.save();this.a.clearRect(-g,-h,2*g,2*h);this.a.restore();this.lb=Math.max(l[14],0.1);this.a.setTransform(this.lb,0,0,this.lb,0,0);var j=1*l[12],l=-1*l[13],k=t;c.e&&(k=c.e.$e);var m=
this.Za[parseInt(e,10)],r=m.H.Wb,m=m.e,s=t;m&&(s=m.Wb);var y=this.Oc,z=this.Lc,F=this.qg,G=this.vg,J=F.getImageData(0,0,y,z),A=G.getImageData(0,0,y,z),E=J.data,L=A.data,O=E.length,R=c.ja,P=c.V,U=c.W,ca=c.fa/R,da=c.ea/R;if(this.ng!=e||this.V!=P||this.W!=U||this.fa!=ca||this.ea!=da||k&&!wg(k,this.wg,0)){var M=this.Sd;M.width=d;M.height=f;M=this.Ud;M.width=d;M.height=f;d=0;do{var M=[0,0,0,0],f=[0,0,0,0],oa=r[d]/255*R,H=r[d],H=(H/255-ca)/(da-ca),H=255*H;oa>=P&&oa<=U&&(M=new Q(c.Rb[0],c.Rb[1],c.Rb[2]),
M=(new Q(c.Pb[0],c.Pb[1],c.Pb[2])).scale(H).add(M.scale(255-H)),M=[Math.floor(M.x),Math.floor(M.y),Math.floor(M.d),255],m&&(-255==k[3]?f=[s[d],s[d+1],s[d+2],s[d+3]]:wg(k,s,d)&&(f=[s[d],s[d+1],s[d+2],s[d+3]])));"X"==this.Pa?(E[d]=M[0],E[d+1]=M[1],E[d+2]=M[2],E[d+3]=M[3],L[d]=f[0],L[d+1]=f[1],L[d+2]=f[2],L[d+3]=f[3]):"Y"==this.Pa?(H=Math.floor(d/(4*y)),H=4*H*y+(4*(y-1)-(d-4*H*y)),E[H]=M[0],E[H+1]=M[1],E[H+2]=M[2],E[H+3]=M[3],L[H]=f[0],L[H+1]=f[1],L[H+2]=f[2],L[H+3]=f[3]):(H=O-1-d,E[H-3]=M[0],E[H-2]=
M[1],E[H-1]=M[2],E[H]=M[3],L[H-3]=f[0],L[H-2]=f[1],L[H-1]=f[2],L[H]=f[3]);d+=4}while(d<O);F.putImageData(J,0,0);G.putImageData(A,0,0);this.ng=e;this.V=P;this.W=U;this.fa=ca;this.ea=da;m&&(this.wg=k)}this.a.globalAlpha=1;this.a.translate(g/2/this.lb,h/2/this.lb);"X"==this.Pa&&(this.a.rotate(0.5*Math.PI),e=j,j=l,l=-e);j=-y*this.Pc/2+j;l=-z*this.Mc/2+l;this.a.drawImage(this.Sd,j,l,y*this.Pc,z*this.Mc);m&&c.e.P&&(this.a.globalAlpha=c.e.ta,this.a.drawImage(this.Ud,j,l,y*this.Pc,z*this.Mc));if(this.S.SLICENAVIGATORS&&
(this.U.Wd&&this.U.Hg&&!this.U.tb)&&(j=this.U.sa,j=this.gi(j[0],j[1])))c.Ab=j[0][0],c.Bb=j[0][1],c.Cb=j[0][2],c.q(u),this.onSliceNavigation(),this.a.setTransform(1,0,0,1,0,0),this.a.lineWidth=1,this.a.beginPath(),this.a.moveTo(this.U.sa[0],0),this.a.lineTo(this.U.sa[0],this.U.sa[1]-10),this.a.moveTo(this.U.sa[0],this.U.sa[1]+10),this.a.lineTo(this.U.sa[0],this.v),this.a.strokeStyle=this.Sb[0],this.a.stroke(),this.a.closePath(),this.a.beginPath(),this.a.moveTo(0,this.U.sa[1]),this.a.lineTo(this.U.sa[0]-
10,this.U.sa[1]),this.a.moveTo(this.U.sa[0]+10,this.U.sa[1]+0.5),this.a.lineTo(this.G,this.U.sa[1]),this.a.strokeStyle=this.Sb[1],this.a.stroke(),this.a.closePath(),this.a.font="10pt Arial",this.a.textAlign="left",this.a.textBaseline="top",this.a.fillStyle="white",this.a.fillText("RAS: "+j[2][0].toFixed(2)+", "+j[2][1].toFixed(2)+", "+j[2][2].toFixed(2),0,0),y=m=l="undefined","undefined"!=typeof c.ia[j[1][2].toFixed(0)]&&"undefined"!=typeof c.ia[j[1][2].toFixed(0)][j[1][1].toFixed(0)]&&(l=c.ia[j[1][2].toFixed(0)][j[1][1].toFixed(0)][j[1][0].toFixed(0)],
c.L&&(m=c.e.ia[j[1][2].toFixed(0)][j[1][1].toFixed(0)][j[1][0].toFixed(0)],c.e.Zc&&(y=c.e.Zc.get(m),"undefined"!=typeof y&&(y=y[0])))),this.a.fillText("Background:  "+l+" ("+j[1][0].toFixed(0)+", "+j[1][1].toFixed(0)+", "+j[1][2].toFixed(0)+")",0,15),c.L&&this.a.fillText("Labelmap:  "+y+" ("+m+")",0,30)}};B("X.renderer2D",Z);B("X.renderer2D.prototype.init",Z.prototype.Aa);B("X.renderer2D.prototype.add",Z.prototype.add);B("X.renderer2D.prototype.onShowtime",Z.prototype.Lh);
B("X.renderer2D.prototype.onRender",Z.prototype.Jh);B("X.renderer2D.prototype.onScroll",Z.prototype.Pj);B("X.renderer2D.prototype.onWindowLevel",Z.prototype.Zj);B("X.renderer2D.prototype.get",Z.prototype.get);B("X.renderer2D.prototype.resetViewAndRender",Z.prototype.Kd);B("X.renderer2D.prototype.xy2ijk",Z.prototype.gi);B("X.renderer2D.prototype.render",Z.prototype.cc);B("X.renderer2D.prototype.destroy",Z.prototype.he);B("X.renderer2D.prototype.onSliceNavigation",Z.prototype.Qj);
B("X.renderer2D.prototype.afterRender",Z.prototype.Jg);
